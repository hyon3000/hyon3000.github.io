<!DOCTYPE html>
<html>
<head>
  <meta name="google-site-verification" content="sVA6QJSCCEozZiu7jjWZHOHMoLK4c4JN6ecoNAuG4bg" />
  <title>Minesweeper</title>
  <meta charset="utf-8" />
  <link href="mine.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="win98.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="mine-win98.css" media="screen" rel="stylesheet" type="text/css" />
  <style>
/* ì˜¤ë²„ë ˆì´ ì• ë‹ˆë©”ì´ì…˜: 1ì´ˆ(1s) ë”œë ˆì´ í›„ opacity 1ë¡œ ë³€ê²½ */
  @keyframes delayedFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  #loading-overlay.delayed-show {
    opacity: 0; /* ì‹œì‘ì€ íˆ¬ëª… */
    /* duration:0.1s, delay:1s */
    animation: delayedFadeIn 0.1s linear 1s forwards; 
  }
    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
    html, body { overflow-x: auto; }

    .windows { position: relative; overflow: visible; width: max-content; min-width: 100%; }
    .mine-window { position: relative; display: inline-block; }

    /* ì´ì¤‘ ì¹´ìš´í„°ìš© ì»¨í…Œì´ë„ˆ(ì•„ì´ì½˜+ì„¸ê·¸ë¨¼íŠ¸ ë‘ ì¤„) */
    .mine-counters-dual { display: inline-flex; flex-direction: column; gap: 2px; }
    .counter-row { display: flex; align-items: center; gap: 4px; }

    /* ê¹ƒë°œ ì•„ì´ì½˜ (mine.pngëŠ” 160x256 ìŠ¤ì¼€ì¼ ê¸°ì¤€) */
    .counter-icon {
      width: 16px; height: 16px;
      background-image: url(mine.png);
      background-size: 160px 256px;
      image-rendering: pixelated;
      flex: 0 0 16px;
    }
    /* (ê²€ì€ì§€ë¢°ê¹ƒë°œ) ì›ë³¸(288,288~320,320) â†’ ì ˆë°˜ ì¢Œí‘œ(-144px,-144px) */
    .icon-flag-black { background-position: -144px -144px; }
    /* (í•˜ì–€ì§€ë¢°ê¹ƒë°œ) ì›ë³¸(0,288~32,320) â†’ ì ˆë°˜ ì¢Œí‘œ(0,-144px) */
    .icon-flag-white { background-position: 0px -144px; }
    .notice {
    margin: 10px 0 14px;
    padding: 10px 12px;
    border: 1px solid #b5b5b5;
    background: #fcfcfc;
    font-size: 13px;
    line-height: 1.55;
  }
  .notice h3 {
    margin: 0 0 6px;
    font-size: 14px;
  }
  .notice ul { margin: 6px 0 0 18px; padding: 0; }
  .notice li { margin: 2px 0; }
  .notice .warn {
    display: inline-block;
    padding: 0 6px;
    border-radius: 3px;
    background: #fff3cd;
    border: 1px solid #ffe69c;
  }

  /* --- Console ë¯¸ëŸ¬ íŒ¨ë„ --- */
  .console-panel {
    margin: 10px 0 18px;
    border: 1px solid #b5b5b5;
    background: #ffffff;
  }
  .console-panel .console-head {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    background: #f2f2f2;
    border-bottom: 1px solid #d0d0d0;
    font-size: 13px;
  }
  .console-panel .console-head .title { font-weight: 600; margin-right: auto; }
  .console-panel .console-head button,
  .console-panel .console-head label {
    font-size: 12px;
  }
  .console-panel .console-body {
    max-height: 220px;
    overflow: auto;
    background: #ffffff;
    font: 12px/1.5 monospace;
    padding: 8px;
    white-space: pre-wrap;
  }
  .console-line { padding: 1px 0; }
  .console-time { color: #888; }
  .console-lvl-log   { color: #222; }
  .console-lvl-info  { color: #146c94; }
  .console-lvl-warn  { color: #a46c00; }
  .console-lvl-error { color: #b00020; }
.ui-resizable-handle {
  display: none !important;
}
  </style>
</head>

<body>
 <div id="loading-overlay" style="display:none; opacity:0;position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:9999; background:silver; border:2px outset white; padding:2px; box-shadow:2px 2px 10px rgba(0,0,0,0.5);">
  <div style="border:2px inset white; padding:5px 5px; text-align:center; font-family:'êµ´ë¦¼', sans-serif; font-size:12px;">
    <strong>â³...</strong><br><br>
  </div>
</div>

  <div id="hscroll-guard" style="height:1px;width:0;overflow:hidden;"></div>
<script>

 (function() {
    console.log("â˜… Global Event Script Loaded");

    // 1. ë§ˆìš°ìŠ¤ ëˆ„ë¦„ ê°ì§€ (ìº¡ì²˜ë§ ëª¨ë“œ: true)
    window.addEventListener('mousedown', function(e) {
      
      // ì¢Œí´ë¦­(0)ë§Œ ì²˜ë¦¬
      if (e.button !== 0 && e.button !== 1) return;

      // í´ë¦­ëœ ìš”ì†Œê°€ ì§€ë¢°ì°¾ê¸° ìœˆë„ìš°(.mine-window) ë‚´ë¶€ì— ìˆëŠ”ì§€ í™•ì¸
      var targetWin = e.target.closest('.mine-window');
      if (!targetWin) return;

      // â˜… [ìˆ˜ì •] í´ë¦­ëœ ìš”ì†Œê°€ 'ì–¼êµ´ ë²„íŠ¼' ìì‹ ì´ë¼ë©´ ì—¬ê¸°ì„œ ì¤‘ë‹¨!
      // ì–¼êµ´ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•ŒëŠ” 'O' í‘œì •ì´ ì•„ë‹ˆë¼, CSSì˜ :active íš¨ê³¼(ë²„íŠ¼ ëˆŒë¦¼)ê°€ ë‚˜ì™€ì•¼ í•¨
      if (e.target.closest('.mine-reset-button')) {
        return; 
      }

      // ê²Œì„ ê°ì²´ê°€ ì—†ê±°ë‚˜, ê²Œì„ ì¢…ë£Œ ìƒíƒœ(-1:íŒ¨ë°°, -2:ìŠ¹ë¦¬)ë¼ë©´ ë°˜ì‘í•˜ì§€ ì•ŠìŒ (ì§„í–‰ì¤‘ 1, ëŒ€ê¸° 0)
      if (!window.minefield || window.minefield.game_status < 0) return;

      // ì–¼êµ´ ì•„ì´ì½˜ì„ ì°¾ì•„ ê°•ì œë¡œ 'O' í‘œì •(-42px) ì ìš©
      var faceIcon = document.querySelector(".mine-reset-button .mine-reset-button-inner");
      if (faceIcon) {
        // ê¸°ì¡´ CSS(:active)ë¥¼ ë®ì–´ì“°ê¸° ìœ„í•´ !important ì‚¬ìš©
        faceIcon.style.setProperty("background-position", "-42px 0", "important");
      }
    }, true); // true: ìº¡ì²˜ë§


    // 2. ë§ˆìš°ìŠ¤ ë—Œ ê°ì§€ (ìº¡ì²˜ë§ ëª¨ë“œ: true)
    window.addEventListener('mouseup', function(e) {
      if (!window.minefield) return;

      // A. ìƒì„± ì¤‘(ëª¨ë˜ì‹œê³„)ì¼ ë•ŒëŠ” ì–¼êµ´ì„ ë¦¬ì…‹í•˜ì§€ ì•Šê³  ìœ ì§€ (mine.js ë¡œì§ ì—°ë™)
      if (window.minefield._is_generating) return;

      // B. ê²Œì„ì´ ëë‚œ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ ì›ƒëŠ” ì–¼êµ´ë¡œ ë³µêµ¬
      if (window.minefield.game_status >= 0) {
        var faceIcon = document.querySelector(".mine-reset-button .mine-reset-button-inner");
        if (faceIcon) {
          // ê°•ì œ ìŠ¤íƒ€ì¼ ì œê±° -> CSS ê¸°ë³¸ê°’(ì›ƒëŠ” ì–¼êµ´ 0 0)ë¡œ ë³µê·€
          faceIcon.style.removeProperty("background-position");
          
          // ì•ˆì „ì¥ì¹˜: JSë¡œë„ ëª…ì‹œì  ì´ˆê¸°í™”
          faceIcon.style.backgroundPosition = "0 0";
        }
      }
    }, true); // true: ìº¡ì²˜ë§
  })();
</script>
  <script>
    function updateHScrollGuard() {
      const win = document.querySelector('.mine-window');
      const guard = document.getElementById('hscroll-guard');
      if (win && guard) guard.style.width = (win.offsetWidth + 32) + 'px';
    }
    window.addEventListener('resize', updateHScrollGuard);

    /* ===== ê³µí†µ ìœ í‹¸: ìˆ«ì/í´ë¨í”„/ìƒí•œ ê³„ì‚° ===== */
    function toInt(v, d=0){ v=parseInt(v); return isNaN(v)?d:v; }
    function clamp(v, lo, hi){ return Math.min(hi, Math.max(lo, v)); }

    // capBlackTotal = (cells-1)*maxBlackPerCell
    // capWhiteTotal = capBlackTotal - blackTotal(ìµœì¢…ê°’), ìŒìˆ˜ë©´ 0
function calcCaps(cols, rows, maxBlackPerCell, blackTotalNow, maxWhitePerCell = 0) {
  // 1) ì „ì²´ ì¹¸ìˆ˜ ë° ê²€ì€ì§€ë¢° ì´ ìˆ˜ìš©ëŸ‰
  const C = Math.max(3, cols | 0);
  const R = Math.max(1, rows | 0);
  const cells = C * R;

  const capBlackPerCell = Math.max(1, maxBlackPerCell | 0);
  const capBlackTotal   = Math.max(0, (cells - 1) * capBlackPerCell);

  // 2) ê²€ì€ì§€ë¢°ê°€ ìµœì†Œë¡œ ì ìœ í•´ì•¼ í•˜ëŠ” ì¹¸ ìˆ˜
  const blackUsed = Math.min(Math.max(0, blackTotalNow | 0), capBlackTotal);
  const minBlackCells = Math.ceil(blackUsed / capBlackPerCell);

  // 3) í°ì§€ë¢°ë¥¼ ë„£ì„ ìˆ˜ ìˆëŠ” ì¹¸ ìˆ˜
  const whitePlaceableCells = Math.max(0, (cells - 1) - minBlackCells);

  // 4) ì¹¸ë‹¹ í°ì§€ë¢° ìˆ˜ìš©ëŸ‰ì„ ê³±í•´ ìµœëŒ€ í°ì§€ë¢° ì´ëŸ‰
  const capWhitePerCell = Math.max(0, maxWhitePerCell | 0);
  const capWhiteTotal   = whitePlaceableCells * capWhitePerCell;

  return { capBlackTotal, capWhiteTotal };
}

    // í¼ ì…ë ¥ì— ì‹¤ì‹œê°„ ì ìš©: ìƒí˜¸ ì˜ì¡´ ìƒí•œ ë³´ì •
     function applyFormCaps(){
    const cols = toInt(x.value, 3);
    const rows = toInt(y.value, 1);

    // 1) ì¹¸ë‹¹ ìµœëŒ€ ê²€ì€ì§€ë¢°ìˆ˜ (1~6)
    let maxBlackPerCell = clamp(toInt(m.value, 1), 1, 6);
    if(toInt(m.value, 1)<0 || toInt(m.value, 1)>6) m.value = maxBlackPerCell;

    // 2) ì¹¸ë‹¹ ìµœëŒ€ í°ì§€ë¢°ìˆ˜ (0~6)  â† idëŠ” wm ì´ ë§ìŠµë‹ˆë‹¤.
    let maxWhitePerCell = clamp(toInt(wm.value, 0), 0, 6);
    if(toInt(wm.value, 0)<0 || toInt(wm.value, 0)>6) wm.value = maxWhitePerCell;

    // 3) ê²€ì€ ì´ìˆ˜ ë³´ì •
    let k = Math.max(1, toInt(t.value, 1));
    let caps = calcCaps(cols, rows, maxBlackPerCell, k, maxWhitePerCell);
    if (k > caps.capBlackTotal) k = caps.capBlackTotal;
    if(toInt(t.value, 1)<0 || toInt(t.value, 1)>k) t.value = k;

    // 4) í° ì´ìˆ˜ ë³´ì • (ê²€ì€ í™•ì •ì¹˜ ì‚¬ìš©)
    caps = calcCaps(cols, rows, maxBlackPerCell, k, maxWhitePerCell);
    let whiteTotal = Math.max(0, toInt(wt.value, 0));
    if (whiteTotal > caps.capWhiteTotal) whiteTotal = caps.capWhiteTotal;
    wt.value = whiteTotal;

    // 5) max íŒíŠ¸ ë™ê¸°í™”
    t.max  = String(caps.capBlackTotal);
    wt.max = String(caps.capWhiteTotal);
  }

    /* ---------- ì‹¤í–‰ í•¨ìˆ˜ (í°ìƒ‰ ì§€ë¢° ì§€ì›) ---------- */
var execute = function(i, j, k, l = 1, whiteTotal = 0, whiteMax = 0, aiLevel = null) {
  setActiveDifficulty(14);
  // 1) ì…ë ¥ ì •ê·œí™”
  i = Math.max(3,toInt(i, 3)); j = toInt(j, 1); k = toInt(k, 1); l = clamp(toInt(l, 1), 1, 6);
  whiteTotal = Math.max(0, toInt(whiteTotal, 0));
  whiteMax   = clamp(toInt(whiteMax, 0), 0, 6);

  // 1-1) ì§€ëŠ¥í˜• ìƒì„± ìˆ˜ì¤€ í™•ì • (ê¸°ë³¸ê°’ 0)
  if (aiLevel === null || typeof aiLevel === "undefined") {
    aiLevel = toInt(document.getElementById('ai')?.value, 0);
  } else {
    aiLevel = toInt(aiLevel, 0);
  }

      // 2) ìƒí•œ ë³´ì •(ëª¨ë“  ê²½ë¡œì—ì„œ ë™ì¼í•˜ê²Œ ê°•ì œ)
      //    2-1) ê²€ì€ì§€ë¢° ì´ìˆ˜ k ë³´ì •
      let caps = calcCaps(i, j, l, k,whiteMax);
      if (k > caps.capBlackTotal) k = caps.capBlackTotal;

      //    2-2) í°ì§€ë¢° ì´ìˆ˜ whiteTotal ë³´ì • (ê²€ì€ í™•ì •ì¹˜ ì‚¬ìš©)
      caps = calcCaps(i, j, l, k,whiteMax);
      if (whiteTotal > caps.capWhiteTotal) whiteTotal = caps.capWhiteTotal;
  // 3) í¼ ê°’ ë°˜ì˜ + í¼ max íŒíŠ¸ ë°˜ì˜
  x.value  = i; y.value  = j; m.value  = l; t.value  = k;
  wm.value = whiteMax; wt.value = whiteTotal;
  const aiSel = document.getElementById('ai');
  if (aiSel) aiSel.value = String(aiLevel);

      t.max  = String(caps.capBlackTotal);
      wt.max = String(caps.capWhiteTotal);


      /* ë³´ë“œ ìƒì„± (mine.jsê°€ 6ì¸ì ì§€ì› ì‹œ ê·¸ëŒ€ë¡œ ì „ë‹¬) */

  
    
    minefield.init_board(i, j, k, l, whiteTotal, whiteMax, aiLevel);
   
    
  
      // â–¼ ë…¸í”½ ëª¨ë“œì¼ ë•Œë§Œ ì½˜ì†” ë¯¸ëŸ¬ í‘œì‹œ
const cp = document.getElementById('console-panel');
if (cp) {
  if (aiLevel === 2) {
    cp.style.display = '';
  } else {
    cp.style.display = 'none';
    // ì„ íƒ: ìˆ¨ê¸¸ ë•Œ ë¡œê·¸ë„ ê¹”ë”í•˜ê²Œ ë¹„ìš°ê¸°
    const bodyEl = document.getElementById('console-body');
    if (bodyEl) bodyEl.textContent = '';
  }
}


      /* ë ˆì´ì•„ì›ƒ: ì´ì¤‘ ì¹´ìš´í„°ë©´ í—¤ë” ë†’ì´/ì°½ ë†’ì´ë¥¼ í‚¤ì›€ */
      const hasWhite = whiteTotal > 0;
      const head = document.querySelector('.window-content .mine-head-area');
      if (head) head.style.height = hasWhite ? '58px' : '38px';

      const extraHead = hasWhite ? 20 : 0; // 58-38
      // ë©”ì¸ ì§€ë¢°ì°¾ê¸° ì°½ë§Œ í¬ê¸° ì¡°ì • (ì‚¬ìš©ìì§€ì • ì°½, ìµœê³ ê¸°ë¡ ì°½, ì´ë¦„ì…ë ¥ ì°½ ì œì™¸)
      $(".mine-window").not("#custom-win, #besttimes-win, #nameinput-win").css({ "width": 22 + i*16, "height": (107 + extraHead) + j*16 });
      $(".mine-window").not("#custom-win, #besttimes-win, #nameinput-win").find(".window-content .mine-head-area").css({ "width": 2 + i*16 });
      $(".mine-window").not("#custom-win, #besttimes-win, #nameinput-win").find(".window-content .mine-area").css({ "width": i*16, "height": j*16 });
      $(".inner").css({ "width": i*16, "height": j*16 });
      if(hasWhite) $(".mine-window").not("#custom-win, #besttimes-win, #nameinput-win").find(".window-content .mine-head-area .mine-reset-button").css({ "left": -4 + 8*i });
      else $(".mine-window").not("#custom-win, #besttimes-win, #nameinput-win").find(".window-content .mine-head-area .mine-reset-button").css({ "left": -11 + 8*i });
      $(".windows").css({ "height": (112 + extraHead) + j*16 });

      renderCounters(hasWhite);
      update_all_mine_counters();
      updateHScrollGuard();
    };
  </script>

  <div class="windows windows-98" style="height:365px;">
    <div class="window has-menu mine-window">
      <div class="title-bar">
        <div class="title-icon"></div>
        <div class="title">Minesweeper</div>
        <div class="title-button-group">
          <div class="title-button minimize"></div>
          <div class="title-button maximize disabled"></div>
          <div class="title-button close"></div>
        </div>
      </div>
<ul class="menu-bar">
  <li>
    <a href="#" data-access-key="g" class="menu201">ê²Œì„</a>
    <ul class="menu">
      <li class="menu0" onclick="return runMenu(() => {pressreset();});"><a href="#">ã€€ìƒˆ ê²Œì„(N)ã€€ã€€ã€€ã€€ã€€F2</a></li>
      <li class="separator"></li>
      <li class="menu1" onclick="return runMenu(() => {execute(9, 9, 10, 1, 0, 0, 2);setActiveDifficulty(1);  });"><a href="#">ã€€ì´ˆê¸‰(B)</a></li>
      <li class="menu2" onclick="return runMenu(() => {execute(16, 16, 40, 1, 0, 0, 2);setActiveDifficulty(2);  });"><a href="#">ã€€ì¤‘ê¸‰(I)</a></li>
      <li class="menu3" onclick="return runMenu(() => {execute(30, 16, 99, 1, 0, 0, 2);setActiveDifficulty(3);  });"><a href="#">âœ“ ê³ ê¸‰(E)</a></li>
      <li class="menu_4" onclick="event.preventDefault(); event.stopPropagation(); return false;" style="cursor: default;">
        <a href="#" onclick="event.preventDefault(); event.stopPropagation(); return false;" style="cursor: default;">ã€€ê¸°íƒ€...</a>
    <ul class="menu">
      <li class="menu4" onclick="return runMenu(() => {execute(30, 16, 120, 2, 0, 0, 2);setActiveDifficulty(4);  });"><a href="#">ã€€ì´ˆê³ ê¸‰</a></li>
      <li class="menu5" onclick="return runMenu(() => {execute(30, 16, 160, 3, 0, 0, 2);setActiveDifficulty(5);  });"><a href="#">ã€€ğŸ˜±</a></li>
      <li class="menu6" onclick="return runMenu(() => {execute(30, 16, 220, 4, 0, 0, 2);setActiveDifficulty(6); });"><a href="#">ã€€ğŸ’€</a></li>
      <li class="menu7" onclick="return runMenu(() => {execute(30, 16, 420, 4, 0, 0, 0);setActiveDifficulty(7);  });"><a href="#">ã€€â˜ ï¸</a></li>
      <li class="menu8" onclick="return runMenu(() => {execute(30, 16, 530, 5, 0, 0, 0);setActiveDifficulty(8);  });"><a href="#">ã€€â˜ ï¸â˜ ï¸</a></li>
      <li class="menu9" onclick="return runMenu(() => {execute(30, 16, 680, 6, 0, 0, 0);setActiveDifficulty(9);  });"><a href="#">ã€€â˜ ï¸â˜ ï¸â˜ ï¸</a></li>
      <li class="menu10" onclick="return runMenu(() => {execute(30, 16, 40, 1, 20, 1, 2);setActiveDifficulty(10);  });"><a href="#">ã€€ìŒìˆ˜ì§€ë¢°</a></li>
      <li class="menu11" onclick="return runMenu(() => {execute(118, 58, 1412, 1, 0, 0, 0);setActiveDifficulty(11);  });"><a href="#">ã€€ëŒ€í˜•</a></li>
      <li class="menu12" onclick="return runMenu(() => {execute(640, 480, 63300, 1, 0, 0, 0);setActiveDifficulty(12);  });"><a href="#">ã€€ì´ˆëŒ€í˜•</a></li>
      <li class="menu13" onclick="return runMenu(() => {execute(1280, 720, 192000, 1, 0, 0, 0);setActiveDifficulty(13);  });"><a href="#">ã€€íŠ¹ëŒ€í˜•</a></li>
      </ul></li>
      <li class="menu14" onclick="return runMenu(() => { openCustomDialog();setActiveDifficulty(14);});"><a href="#">ã€€ì‚¬ìš©ì ì§€ì •(C)...</a></li>
      <li class="separator"></li>

      <!-- ?í‘œì‹œ(Question marks) í† ê¸€ -->
      <li id="opt-qmark" class="checkable" onclick="return runMenu(() => toggleQuestionMarks());"><a href="#">âœ“ ? í‘œì‹œ(M)</a></li>
      
      <!-- Color í† ê¸€ -->
      <li id="opt-color" class="checkable" onclick="return runMenu(() => toggleColorMode());"><a href="#">âœ“ ì»¬ëŸ¬ë¡œ í‘œì‹œ(L)</a></li>
      
      <!-- Sound í† ê¸€ -->
      <li id="opt-sound" class="checkable" onclick="return runMenu(() => toggleSound());"><a href="#">ã€€ì†Œë¦¬(S)</a></li>
      <!--onclickì‹œ runMenuì—ì„œ window has-menu mine-window ui-resizable ui-draggableì˜ visibleì„ noneìœ¼ë¡œí•œë‹¤-->
      <li class="separator"></li>
      <li class="besttimes" onclick="return runMenu(() => printBestTimes());"><a href="#">ã€€ìµœê³  ê¸°ë¡(T)...</a></li>
      <li class="separator"></li>
      <li class="menuclose" onclick="return runMenu(() => { $('.has-menu.mine-window.ui-resizable.ui-draggable').css('visibility', 'hidden'); });">
        <a href="#">ã€€ëë‚´ê¸°(X)</a>
      </li>
    </ul>
  </li>

  <li>
    <a href="#" data-access-key="h" class="menu202">ë„ì›€ë§</a>
    <ul class="menu">
      <li class="menu102" onclick="return runMenu(() =>  alert(isKorean() ? 'ë„ì›€ë§ì€ ì•„ë˜ì— ìˆìŠµë‹ˆë‹¤' : 'Help is below'))"><a href="#">ã€€ëª©ì°¨(C)ã€€ã€€ã€€ã€€ ã€€ã€€F1</a></li>
      <li class="menu100" onclick="return runMenu(() =>  alert(isKorean() ? 'ë„ì›€ë§ì€ ì•„ë˜ì— ìˆìŠµë‹ˆë‹¤' : 'Help is below'))"><a href="#">ã€€ë„ì›€ë§ ê²€ìƒ‰(S)...</a></li>
      <li class="menu103" onclick=""><a href="#">ã€€ë„ì›€ë§ ì‚¬ìš©(H)</a></li>
      <li class="separator"></li>
      <li class="menu_cheat" onclick="event.preventDefault(); event.stopPropagation(); return false;" style="cursor: default;">
        <a href="#" onclick="event.preventDefault(); event.stopPropagation(); return false;" style="cursor: default;">ã€€ì¹˜íŠ¸...</a>
      <ul class="menu">
      <li class="menu-autosolve" onclick="return runMenu(() => document.getElementById('console-play').click());"><a href="#">ã€€ì§€ë¢° ìë™ìœ¼ë¡œ í’€ê¸°</a></li>
      <li class="menu-hint" onclick="return runMenu(() => document.getElementById('console-hint').click());"><a href="#">ã€€íŒíŠ¸ ì œê³µ</a></li>
     </ul></li>
      <li class="menu101" onclick="return runMenu(() => alert('Minesweeper'));"><a href="#">ã€€ì§€ë¢° ì°¾ê¸° ì •ë³´(A)...</a></li>

    </ul>
  </li>
</ul>



      <div class="window-content">
        <div class="mine-head-area" style="height:38px;">
          <!-- ë‹¨ì¼ ì¹´ìš´í„°(ê¸°ë³¸) : ì ˆëŒ€ë°°ì¹˜ ê·¸ëŒ€ë¡œ ì‚¬ìš© -->
          <div id="counters-single" class="counters-single" style="">
            <div class="mine-counter" id="mine-counter-single">
              <div class="digit digit-0"></div>
              <div class="digit digit-0"></div>
              <div class="digit digit-0"></div>
            </div>
          </div>

          <!-- ì´ì¤‘ ì¹´ìš´í„°: ì»¨í…Œì´ë„ˆë§Œ ì ˆëŒ€ë°°ì¹˜, ë‚´ë¶€ ì¹´ìš´í„°ëŠ” flexë¡œ í­ ìë™ -->
          <div id="counters-dual" class="mine-counters-dual"
               style="display:none; position:absolute; top:4px; left:1px;">
            <div id="counter-row-black" class="counter-row" style="min-height:23px;">
              <div class="counter-icon icon-flag-black" title="ê²€ì€ ì§€ë¢°"></div>
              <div class="mine-counter" id="mine-counter-black"
                   style="position:static; width:auto; height:23px; display:flex;">
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
              </div>
            </div>
            <div id="counter-row-white" class="counter-row" style="min-height:23px;">
              <div class="counter-icon icon-flag-white" title="í•˜ì–€(ìŒìˆ˜) ì§€ë¢°"></div>
              <div class="mine-counter" id="mine-counter-white"
                   style="position:static; width:auto; height:23px; display:flex;">
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
              </div>
            </div>
          </div>

          <div class="mine-reset-button" onclick="minefield.reset_board()">
            <div class="mine-reset-button-inner"></div>
          </div>

          <div class="mine-timer">
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
          </div>
        </div>

        <div id="mine-area" class="mine-area"></div>
      </div>
    </div>
     <!-- Fake mswin Win98-style Custom Dialog -->
<div id="custom-win" class="window mine-window customdialog" >
  <div class="title-bar">
    <div class="title-icon"></div>
    <div class="title" id="custdialtitle">ì‚¬ìš©ì ì§€ì • ê²Œì„</div>
    <div class="title-button-group">
      <div class="title-button close" onclick="closeCustomDialog()"></div>
    </div>
  </div>
  <div class="window-content" style="padding:8px;">
    <form id="custom-form" onsubmit="submitCustomDialog(); return false;">
      <div id="customdial2" style="display:flex; flex-direction:column; gap:8px;">
        <!-- ìƒë‹¨: ì…ë ¥ì°½ë“¤ + ë²„íŠ¼ë“¤ -->
        <div style="display:flex; gap:8px;">
          <!-- ì™¼ìª½: ë†’ì´~ìµœëŒ€ìŒìˆ˜ì§€ë¢° ì…ë ¥ì°½ë“¤ -->
          <div style="display:grid; grid-template-columns: 100px 1fr; gap:6px 8px; align-items:center;">
            <label>ë†’ì´(H)</label>
            <input type="number" id="c-rows" min="1" max="9999" step="1" value="16" style="width:30px;">
            <label>ë„ˆë¹„(W)</label>
            <input type="number" id="c-cols" min="3" max="9999" step="1" value="30" style="width:30px;">
            <label>ì§€ë¢° ìˆ˜(M)</label>
            <input type="number" id="c-total" min="1" step="1" value="99" style="width:30px;">
            <label>ìµœëŒ€ì§€ë¢°/1ì¹¸</label>
            <input type="number" id="c-max"  min="1" max="6" step="1" value="1" style="width:30px;">
            <label>ìŒìˆ˜ì§€ë¢° ìˆ˜</label>
            <input type="number" id="c-wtotal" min="0" step="1" value="0" style="width:30px;">
            <label>ìµœëŒ€ìŒìˆ˜ì§€ë¢°/1ì¹¸</label>
            <input type="number" id="c-wmax" min="0" max="6" step="1" value="0" style="width:30px;">
          </div>
          
          <!-- ì˜¤ë¥¸ìª½: ë²„íŠ¼ë“¤ (ì„¸ë¡œ ë°°ì¹˜) -->
          <div style="display:flex; flex-direction:column; gap:8px; justify-content:center;">
            <button type="submit" class="title-button" style="padding:2px 10px;">í™•ì¸</button>
            <div style="height:10px"> </div>
            <button type="button" class="title-button" onclick="closeCustomDialog()" style="padding:2px 10px;">ì·¨ì†Œ</button>
          </div>
        </div>
        
        <!-- í•˜ë‹¨: ì§€ëŠ¥í˜• ìƒì„± -->
        <div style="display:grid; grid-template-columns: 100px 1fr; gap:6px 8px; align-items:center;">
          <label>ì§€ëŠ¥í˜• ìƒì„±</label>
          <select id="c-ai" style="width:90px;">
            <option value="0">0: ì°ê¸° í—ˆìš© + ìµœì†Œ êµ¬ì œ</option>
            <option value="1">1: ì°ê¸° í—ˆìš© + ì²«í´ë¦­ ì˜¤í”„ë‹ + ë¬´ì œí•œ êµ¬ì œ</option>
            <option value="2" selected>2: ì°ê¸° ì°¨ë‹¨ + ìë™ í’€ì´(ëŠë¦¼)</option>
          </select>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Best Times Dialog -->
<div id="besttimes-win" class="window mine-window customdialog" >
  <div class="title-bar">
    <div class="title-icon"></div>
    <div class="title" id="besttimestitle">ì§€ë¢° ì°¾ê¸° ìµœê³  ê¸°ë¡</div>
    <div class="title-button-group">
      <div class="title-button close" onclick="closeBestTimes()"></div>
    </div>
  </div>
  <div class="window-content" style="padding:12px;">
    <div id="besttimes-content" style="display:flex; flex-direction:column; gap:8px; margin-bottom:12px;">
      <!-- Best times will be populated here dynamically -->
    </div>
    <div style="display:flex; gap:8px; justify-content:center;">
      <button type="button" class="title-button" onclick="resetBestTimes()" style="padding:4px 16px;">ì›ë˜ëŒ€ë¡œ(R)</button>
      <button type="button" class="title-button" onclick="closeBestTimes()" style="padding:4px 16px;">í™•ì¸</button>
    </div>
  </div>
</div>

<!-- Name Input Dialog (No Title Bar) -->
<div id="nameinput-win" class="mine-window" style="display:none; position:absolute; z-index:1200; background:#c0c0c0; border:2px outset #c0c0c0; padding:4px; width:100px; height:70px; box-sizing:border-box;">
  <div style="text-align:center; align-items:center; height:100%; display:flex; flex-direction:column; justify-content:space-between;">
    <div id="nameinput-message" style="font-size:7px; line-height:1.1; margin:0; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; max-width:110px;"></div>
    <input type="text" id="nameinput-field" style="width:80px; padding:0; font-size:7px; margin:1px 0; border:1px solid #808080;" maxlength="20" />
    <button type="button" onclick="submitNameInput()" style="width:30px; padding:0; font-size:7px; margin:0; border:1px outset #c0c0c0;">OK</button>
  </div>
</div>
  </div>

  <div id="userctrl" class="userctrl" style="margin:0">
    <form oninput="applyFormCaps()">
      ì£¼ë¬¸ì œì‘:ê°€ë¡œ
      <input type="number" id="x"  min="3" max="9999" step="1" style="width:60px;" value="30">
      ì„¸ë¡œ
      <input type="number" id="y"  min="1" max="9999" step="1" style="width:60px;" value="16">
      1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜
      <input type="number" id="m"  min="1" max="6"    step="1" style="width:60px;" value="1">
      ì „ì²´ ì§€ë¢° ìˆ˜
      <input type="number" id="t"  min="1" step="1"   style="width:80px;" value="99">

      <!-- â–¼ ì¶”ê°€: í•˜ì–€ ì§€ë¢° ì…ë ¥(0 í—ˆìš©) -->
      1ì¹¸ë‹¹ ìµœëŒ€ ìŒìˆ˜ì§€ë¢° ìˆ˜
      <input type="number" id="wm" min="0" max="6" step="1" style="width:60px;" value="0">
      ì „ì²´ ìŒìˆ˜ì§€ë¢° ìˆ˜
      <input type="number" id="wt" min="0" step="1" style="width:80px;" value="0">
      ì§€ëŠ¥í˜• ìƒì„±
      <select id="ai" style="width:220px;" value="2">
        <option value="0">0: ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš© + ìµœì†Œ êµ¬ì œ</option>
        <option value="1">1: ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš© + ì²« í´ë¦­ ì˜¤í”„ë‹ ë³´ì¥ + ë¬´ì œí•œ êµ¬ì œ</option>
        <option value="2" selected>2: ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨ + ìë™ ì§€ë¢° í’€ì´(ë§¤ìš° ëŠë¦¼)</option>
      </select>
      <input type="button"
        onclick="execute(
          document.getElementById('x').value,
          document.getElementById('y').value,
          document.getElementById('t').value,
          document.getElementById('m').value,
          document.getElementById('wt').value,
          document.getElementById('wm').value,
          document.getElementById('ai').value
        )"
        value="ìƒì„±">
      <input type="button" onclick="hideViaURL()" value="ë¬¸êµ¬ ìˆ¨ê¸°ê¸°">
    </form>
  </div>
  <!-- Placeholder div to maintain draggable area height when text is hidden -->
  <div id="userctrl-placeholder" style="display:none; visibility:hidden; height:0; overflow:hidden;"></div>
<div id="heavy-notice" class="notice">
  <h3>ì•ˆë‚´ / ì„±ëŠ¥ ì£¼ì˜</h3>
  <ul>
    <li> ëª¨ë°”ì¼ì—ì„œ ì¡°ì‘:ì§§ê²Œ ëˆŒëŸ¬ ì¢Œí´ë¦­, ê¸¸ê²Œ ëˆŒëŸ¬ ìš°í´ë¦­, ì—´ë¦°ì¹¸ì„ ë”ë¸”í„°ì¹˜í•´ì„œ chording.</li>
    <li>ì²« í´ë¦­ ì§í›„ <span class="warn">íŒ ìƒì„±</span>ì— ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì§€ë¢° ìˆ˜â†‘, íŒ í¬ê¸°â†‘ì¼ìˆ˜ë¡ ì¦ê°€)</li>
    <ul>
      <li>ì´ˆëŒ€í˜•ê³¼ íŠ¹ëŒ€í˜• íŒì€ ì´ˆê¸°í™”ì— ì•½ 5~10ì´ˆê°€ ì†Œìš”ë©ë‹ˆë‹¤</li>
    </ul>
    <li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš©ì˜ êµ¬ì œ ê¸°ëŠ¥ ê´€ë ¨</strong>
      <ul>
        <li>ë³µìˆ˜í•´ê°€ ì¡´ì¬í•˜ì—¬ ì°ê¸° ìƒí™©ì´ ë°œìƒí•˜ì˜€ê³ , ì‚¬ìš©ìê°€ ì§€ë¢°ì¹¸ì„ ì„ íƒí–ˆë”ë¼ë„ ì‚¬ìš©ìì˜ ì…ë ¥ì´ ì´ë¯¸ ê³µê°œëœ ì •ë³´ì— ëª¨ìˆœì„ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤ë©´ ê·¸ ì¹¸ì— ì§€ë¢°ê°€ ì—†ë„ë¡ íŒì„ ìˆ˜ì •í•©ë‹ˆë‹¤</li>
        <li>í•˜ì§€ë§Œ ë¬´ì œí•œ êµ¬ì œëŠ” ë‚œì´ë„ë¥¼ ì‹¬ê°í•˜ê²Œ ë‚®ì¶¥ë‹ˆë‹¤</li>
      </ul>
    </li>
    <li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨</strong> ëª¨ë“œ ì„±ëŠ¥ ì£¼ì˜:
      <ul>
        <li>ìŒìˆ˜ì§€ë¢°ê°€ ìˆìœ¼ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤. (ì¤‘ê¸‰ í¬ê¸°ì˜ íŒ ì´ìƒì—ì„œ ë¹„ê¶Œì¥)</li>
        <li>1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜ê°€ 4 ì´ìƒì´ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤.</li>
        <li>ëŒ€í˜• ì´ìƒì˜ í° íŒì—ì„œëŠ” ë§¤ìš° ëŠë¦½ë‹ˆë‹¤.</li>
        <li>í•´ë‹¹ ëª¨ë“œëŠ” â€œì°ê¸° ì—†ëŠ” í’€ì´ ìˆœì„œâ€ë¥¼ í•­ìƒ ë³´ì¥í•˜ë©°, ìë™ í’€ê¸°ì™€ íŒíŠ¸ ì œê³µ ê¸°ëŠ¥ì€ ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      </ul>
    </li>
    
  </ul>
  <div id="console-panel" class="console-panel" style="display:none">
  <div class="console-head">
    <span class="title">ì‹¤ì‹œê°„ ë¡œê·¸ (Console mirror)</span>
    <label><input type="checkbox" id="console-autoscroll" checked> ìë™ ìŠ¤í¬ë¡¤</label>
    <button type="button" id="console-play">ì§€ë¢° ìë™ìœ¼ë¡œ í’€ê¸°</button>
    <button type="button" id="console-hint">íŒíŠ¸ ì œê³µ</button>
    <button type="button" id="console-pause">ì½˜ì†” ì¼ì‹œì •ì§€</button>
    <button type="button" id="console-clear">ì½˜ì†” ë¹„ìš°ê¸°</button>
    <button type="button" id="console-copy">ì½˜ì†” ë‚´ìš© ë³µì‚¬</button>

  </div>
  <div class="console-body" id="console-body" aria-live="polite"></div>
</div>
</div>

  <script src="vendor/jquery.min.js"></script>
  <script src="vendor/jquery-ui.min.js"></script>
  <script src="jquery.mswin.js"></script>
  <script src="jquery.mswin.listview.js"></script>
  <script src="jquery.mswin.menu.js"></script>
  <script src="mine.js"></script>
<script>
  // ë©”ë‰´ì˜ ì²´í¬ ëª¨ì–‘ì„ ë‹¨ìˆœ í…ìŠ¤íŠ¸(âœ“)ë¡œ í‘œí˜„
  function updateQuestionMenuVisual() {
  const li = document.getElementById('opt-qmark');
  if (!li) return;
  const a = li.querySelector('a') || li; // ì•ˆì „ê°€ë“œ
  const on = !!(window.minefield && window.minefield.question);
  //ì–¸ì–´ê°€ ì˜ì–´ì¼ë–„ì™€ í•œêµ­ì–´ì¼ë•Œê°€ ë‹¤ë¦„

  a.textContent = (on ? 'âœ“ ' : 'ã€€') + (isKorean() ? '? í‘œì‹œ(M)' : 'Marks (?)');
  li.setAttribute('aria-checked', String(on));
}

  // Color ë©”ë‰´ ë¹„ì£¼ì–¼ ì—…ë°ì´íŠ¸
  function updateColorMenuVisual() {
    const li = document.getElementById('opt-color');
    if (!li) return;
    const a = li.querySelector('a') || li;
    const on = !!(window.minefield && window.minefield.useColor);
    a.textContent = (on ? 'âœ“ ' : 'ã€€') + (isKorean() ? 'ì»¬ëŸ¬ë¡œ í‘œì‹œ(L)' : 'Color');
    li.setAttribute('aria-checked', String(on));
  }

  // Sound ë©”ë‰´ ë¹„ì£¼ì–¼ ì—…ë°ì´íŠ¸
  function updateSoundMenuVisual() {
    const li = document.getElementById('opt-sound');
    if (!li) return;
    const a = li.querySelector('a') || li;
    const on = !!(window.minefield && window.minefield.soundEnabled);
    a.textContent = (on ? 'âœ“ ' : 'ã€€') + (isKorean() ? 'ì†Œë¦¬(S)' : 'Sound');
    li.setAttribute('aria-checked', String(on));
  }




  // ?í‘œì‹œ í† ê¸€ â†’ minefield.question true/false
  function toggleQuestionMarks() {
    if (!window.minefield) return;
    // ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì†ì„± ì¶”ê°€, ìˆìœ¼ë©´ ë‹¨ìˆœ í† ê¸€
    if (typeof window.minefield.question === 'undefined') {
      window.minefield.question = true;
    } else {
      window.minefield.question = !window.minefield.question;
    }
    updateQuestionMenuVisual();
  }

  // Color í† ê¸€ â†’ ì´ë¯¸ì§€ íŒŒì¼ ì „í™˜
  function toggleColorMode() {
    // minefield ê°ì²´ê°€ ì—†ìœ¼ë©´ ìƒì„±
    if (!window.minefield) {
      window.minefield = {};
    }
    
    // ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì†ì„± ì¶”ê°€, ìˆìœ¼ë©´ ë‹¨ìˆœ í† ê¸€
    if (typeof window.minefield.useColor === 'undefined') {
      window.minefield.useColor = false; // í˜„ì¬ trueë¼ê³  ê°€ì •í•˜ê³  falseë¡œ í† ê¸€
    } else {
      window.minefield.useColor = !window.minefield.useColor;
    }
    
    // CSS ì´ë¯¸ì§€ ì°¸ì¡° ì „í™˜
    updateImageReferences(window.minefield.useColor);
    updateColorMenuVisual();
    
    console.log('Color mode toggled:', window.minefield.useColor);
  }

  // Sound í† ê¸€
  function toggleSound() {
    // minefield ê°ì²´ê°€ ì—†ìœ¼ë©´ ìƒì„±
    if (!window.minefield) {
      window.minefield = {};
    }
    
    // ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì†ì„± ì¶”ê°€, ìˆìœ¼ë©´ ë‹¨ìˆœ í† ê¸€
    if (typeof window.minefield.soundEnabled === 'undefined') {
      window.minefield.soundEnabled = true; // ì²˜ìŒ í´ë¦­ì‹œ trueë¡œ ì„¤ì •
    } else {
      window.minefield.soundEnabled = !window.minefield.soundEnabled;
    }
    
    updateSoundMenuVisual();
    console.log('Sound mode toggled:', window.minefield.soundEnabled);
  }

  // ì‚¬ìš´ë“œ ì¬ìƒ í•¨ìˆ˜
  function playSound(soundFile) {
    if (!window.minefield || !window.minefield.soundEnabled) return;
    
    try {
      const audio = new Audio(soundFile);
      audio.play().catch(err => console.warn('Sound playback failed:', err));
    } catch (err) {
      console.warn('Sound creation failed:', err);
    }
  }

  // ëª¨ë“  ì´ë¯¸ì§€ ì°¸ì¡°ë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ (CSS í´ë˜ìŠ¤ ì¶”ê°€ ë°©ì‹)
  function updateImageReferences(useColor) {
    const suffix = useColor ? '' : 'b'; // ì»¬ëŸ¬: mine.png, í‘ë°±: mineb.png
    
    // ê¸°ì¡´ ìŠ¤íƒ€ì¼ íƒœê·¸ê°€ ìˆìœ¼ë©´ ì œê±°
    const oldStyle = document.getElementById('color-mode-override');
    if (oldStyle) {
      oldStyle.remove();
    }
    
    // ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ íƒœê·¸ ìƒì„±
    const styleTag = document.createElement('style');
    styleTag.id = 'color-mode-override';
    
    // ëª¨ë“  CSS ê·œì¹™ì„ !importantë¡œ ë®ì–´ì“°ê¸°
    styleTag.textContent = `
      /* Dynamic color mode override - ${useColor ? 'COLOR' : 'BLACK & WHITE'} */
      
      /* ë³´ë” ìƒ‰ìƒ ì¡°ì • - í‘ë°± ëª¨ë“œì—ì„œ ë” ì§„í•˜ê²Œ (ë‘ê»˜ëŠ” ìœ ì§€, ìƒ‰ìƒë§Œ ë³€ê²½) */
      ${!useColor ? `
      /* í—¤ë” ì˜ì—­ - Win98 ìŠ¤íƒ€ì¼ ìœ ì§€, ìƒ‰ìƒë§Œ ì§„í•˜ê²Œ */
      .window-content .mine-head-area {
        border-top-color: #000000 !important;
        border-left-color: #000000 !important;

      }
      
      /* ì¹´ìš´í„°ì™€ íƒ€ì´ë¨¸ */
      .window-content .mine-head-area .mine-counter,
      .window-content .mine-head-area .mine-timer {
        border-top-color: #000000 !important;
        border-left-color: #000000 !important;

      }
      
      /* ë¦¬ì…‹ ë²„íŠ¼ - Win98 ì…ì²´ íš¨ê³¼ ìœ ì§€ */
      .window-content .mine-head-area .mine-reset-button {
        border-top-color: #000000 !important;
        border-left-color: #000000 !important;
        border-bottom: 1px solid #000000 !important;
        border-right: 1px solid #000000 !important;
      }
      .window-content .mine-head-area .mine-reset-button:active {
        border-top-color: #000000 !important;
        border-left-color: #000000 !important;

      }
      
      /* ì§€ë¢° ì˜ì—­ */
      .window-content .mine-area {
        border-top-color: #000000 !important;
        border-left-color: #000000 !important;

      }
      ` : ''}
      
      /* ì§€ë¢°íŒ í…Œì´ë¸” ì…€ */
      table.minetable td,
      table.minetable td:active,
      table.minetable td.mine-wrong1,
      table.minetable td.mine-wrong1:active,
      table.minetable td.mine-wrong2,
      table.minetable td.mine-wrong2:active,
      table.minetable td.mine-wrong3,
      table.minetable td.mine-wrong3:active,
      table.minetable td.mine-wrong4,
      table.minetable td.mine-wrong4:active,
      table.minetable td.mine-wrong5,
      table.minetable td.mine-wrong5:active,
      table.minetable td.mine-wrong6,
      table.minetable td.mine-wrong6:active,
      table.minetable td.mine-1,
      table.minetable td.mine-1:active,
      table.minetable td.mine-2,
      table.minetable td.mine-2:active,
      table.minetable td.mine-3,
      table.minetable td.mine-3:active,
      table.minetable td.mine-4,
      table.minetable td.mine-4:active,
      table.minetable td.mine-5,
      table.minetable td.mine-5:active,
      table.minetable td.mine-6,
      table.minetable td.mine-6:active,
      table.minetable td.flag-0,
      table.minetable td.flag-0:active,
      table.minetable td.flag-1,
      table.minetable td.flag-1:active,
      table.minetable td.flag-2,
      table.minetable td.flag-2:active,
      table.minetable td.flag-3,
      table.minetable td.flag-3:active,
      table.minetable td.flag-4,
      table.minetable td.flag-4:active,
      table.minetable td.flag-5,
      table.minetable td.flag-5:active,
      table.minetable td.flag-6,
      table.minetable td.flag-6:active,
      table.minetable td.flag-m1,
      table.minetable td.flag-m1:active,
      table.minetable td.flag-m2,
      table.minetable td.flag-m2:active,
      table.minetable td.flag-m3,
      table.minetable td.flag-m3:active,
      table.minetable td.flag-m4,
      table.minetable td.flag-m4:active,
      table.minetable td.flag-m5,
      table.minetable td.flag-m5:active,
      table.minetable td.flag-m6,
      table.minetable td.flag-m6:active,
      table.minetable td.mine-m1,
      table.minetable td.mine-m1:active,
      table.minetable td.mine-m2,
      table.minetable td.mine-m2:active,
      table.minetable td.mine-m3,
      table.minetable td.mine-m3:active,
      table.minetable td.mine-m4,
      table.minetable td.mine-m4:active,
      table.minetable td.mine-m5,
      table.minetable td.mine-m5:active,
      table.minetable td.mine-m6,
      table.minetable td.mine-m6:active,
      table.minetable td.mine-exploded1,
      table.minetable td.mine-exploded1:active,
      table.minetable td.mine-exploded2,
      table.minetable td.mine-exploded2:active,
      table.minetable td.mine-exploded3,
      table.minetable td.mine-exploded3:active,
      table.minetable td.mine-exploded4,
      table.minetable td.mine-exploded4:active,
      table.minetable td.mine-exploded5,
      table.minetable td.mine-exploded5:active,
      table.minetable td.mine-exploded6,
      table.minetable td.mine-exploded6:active,
      table.minetable td.mine-exploded-m1,
      table.minetable td.mine-exploded-m1:active,
      table.minetable td.mine-exploded-m2,
      table.minetable td.mine-exploded-m2:active,
      table.minetable td.mine-exploded-m3,
      table.minetable td.mine-exploded-m3:active,
      table.minetable td.mine-exploded-m4,
      table.minetable td.mine-exploded-m4:active,
      table.minetable td.mine-exploded-m5,
      table.minetable td.mine-exploded-m5:active,
      table.minetable td.mine-exploded-m6,
      table.minetable td.mine-exploded-m6:active,
      table.minetable td.mine-wrong-m1,
      table.minetable td.mine-wrong-m1:active,
      table.minetable td.mine-wrong-m2,
      table.minetable td.mine-wrong-m2:active,
      table.minetable td.mine-wrong-m3,
      table.minetable td.mine-wrong-m3:active,
      table.minetable td.mine-wrong-m4,
      table.minetable td.mine-wrong-m4:active,
      table.minetable td.mine-wrong-m5,
      table.minetable td.mine-wrong-m5:active,
      table.minetable td.mine-wrong-m6,
      table.minetable td.mine-wrong-m6:active,
      table.minetable td.empty,
      table.minetable td.empty:active,
      table.minetable td.near-0,
      table.minetable td.near-0:active,
      table.minetable td[class*="near-"],
      table.minetable td[class*="near-"]:active {
        background-image: url(mine${suffix}.png) !important;
      }
      
      /* ì¹´ìš´í„° ì•„ì´ì½˜ */
      .counter-icon {
        background-image: url(mine${suffix}.png) !important;
      }
      
      /* ìˆ«ì ë””ìŠ¤í”Œë ˆì´ (ì¹´ìš´í„°, íƒ€ì´ë¨¸) */
      .window-content .mine-head-area .mine-counter .digit,
      .window-content .mine-head-area .mine-timer .digit,
      .digit {
        background-image: url(digit${suffix}.png) !important;
      }
      
      /* ë¦¬ì…‹ ë²„íŠ¼ (ì–¼êµ´) - 105*21 í¬ê¸°ë¡œ ì—…ë°ì´íŠ¸ */
      .window-content .mine-head-area .mine-reset-button .mine-reset-button-inner {
        background-image: url(face${suffix}.png) !important;
        background-size: 105px 21px !important;
      }
      
      /* ì–¼êµ´ ë²„íŠ¼ ìì²´ê°€ ëˆŒë¦° ìƒíƒœ (active) - 5ë²ˆì§¸ ì–¼êµ´ (ë³´ë” ê°•í™”) */
      .window-content .mine-head-area .mine-reset-button:active .mine-reset-button-inner {
        background-position: -84px 0 !important;
      }
    `;
    
    // headì— ì¶”ê°€
    document.head.appendChild(styleTag);
    
    console.log(`âœ“ Color mode: ${useColor ? 'ON (color)' : 'OFF (black & white)'}`);
    console.log(`âœ“ Using images: mine${suffix}.png, digit${suffix}.png, face${suffix}.png`);
  }

  // ì´ˆê¸° ìƒíƒœ(ì›í•˜ë©´ ê¸°ë³¸ê°’ì„ trueë¡œ ì‹œì‘)
  document.addEventListener('DOMContentLoaded', function () {
    // minefield ê°ì²´ ì´ˆê¸°í™” (ì—†ìœ¼ë©´ ìƒì„±)
    if (!window.minefield) {
      window.minefield = {};
    }
    
    if (typeof window.minefield.question === 'undefined') {
      window.minefield.question = true;  // ê¸°ë³¸ ON (ì›í•˜ë©´ falseë¡œ ë°”ê¾¸ì„¸ìš”)
    }
    if (typeof window.minefield.useColor === 'undefined') {
      window.minefield.useColor = true;  // ê¸°ë³¸ ì»¬ëŸ¬ ëª¨ë“œ ON
    }
    if (typeof window.minefield.soundEnabled === 'undefined') {
      window.minefield.soundEnabled = false;  // ê¸°ë³¸ì ìœ¼ë¡œ í•´ì œ
    }
    
    updateQuestionMenuVisual();
    updateColorMenuVisual();
    updateSoundMenuVisual();
    updateImageReferences(window.minefield.useColor);
    updateWindowTitle(); // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
    // ê¸°ì¡´ ë©”ë‰´ ì‹œìŠ¤í…œ í™œì„±í™”(ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë©´ ë¬´ì‹œ)
    if ($('.menu-bar').length) $('.menu-bar').menubar();
  });
</script>

  <script>
    /* GET íŒŒì„œ */
    function getQueryParams() {
      const p = new URLSearchParams(window.location.search);
      return {
        rows: p.get('rows'),
        cols: p.get('cols'),
        minespercell: p.get('minespercell'),
        mines: p.get('mines'),
        whiteminespercell: p.get('whiteminespercell'),
        whitemines: p.get('whitemines'),
        logic: p.get('logic'),
        hide: p.get('hide'),
      };
    }
    function hasCoreParams(q) {
      return q.rows !== null && q.cols !== null && q.minespercell !== null && q.mines !== null;
    }
    function getQueryDefault0(v){ const n = parseInt(v); return isNaN(n)?0:n; }

    /* í•˜ë‹¨ ì…ë ¥ ìˆ¨ê¸°ê¸° */
    function hideUserInputs() {
      const u = document.getElementById('userctrl');
      const n = document.getElementById('heavy-notice');
      const placeholder = document.getElementById('userctrl-placeholder');
      
      // Calculate combined height before hiding
      let totalHeight = 0;
      if (u) {
        totalHeight += u.offsetHeight;
      }
      if (n) {
        totalHeight += n.offsetHeight;
      }
      
      // Hide the actual elements
      if (u) u.style.display = 'none';
      if (n) n.style.display = 'none';
      
      // Show placeholder with the same height to maintain draggable area
      if (placeholder && totalHeight > 0) {
        placeholder.style.display = 'block';
        placeholder.style.height = totalHeight + 'px';
      }
    }

    /* GET ë¦¬ë‹¤ì´ë ‰íŠ¸(ë³´ë‚´ê¸° ì „ì— ìƒí•œ ë³´ì •) */
    function hideViaURL() {
      let cols = clamp(toInt(x.value,3), 3, 999999);
      let rows = clamp(toInt(y.value,1), 1, 999999);
      let mpc  = clamp(toInt(m.value,1), 1, 6);
      let mines= Math.max(1, toInt(t.value,1));
      let wmpc = clamp(toInt(wm.value,0), 0, 6);
      let wmines = Math.max(0, toInt(wt.value,0));

      // ë³´ì • 1: ê²€ì€ ì´ìˆ˜
      let caps = calcCaps(cols, rows, mpc, mines,wmpc);
      if (mines > caps.capBlackTotal) mines = caps.capBlackTotal;

      // ë³´ì • 2: í° ì´ìˆ˜(ê²€ì€ í™•ì •ì¹˜ ë°˜ì˜)
      caps = calcCaps(cols, rows, mpc, mines,wmpc);
      if (wmines > caps.capWhiteTotal) wmines = caps.capWhiteTotal;

      // í¼ì—ë„ ë°˜ì˜(ì‹œê°ì  í”¼ë“œë°±)
      x.value=cols; y.value=rows; m.value=mpc; t.value=mines;
      wm.value=wmpc; wt.value=wmines;
      t.max  = String(caps.capBlackTotal);
      wt.max = String(caps.capWhiteTotal);

      const u = new URL(window.location.href);
      u.searchParams.set('cols', cols);
      u.searchParams.set('rows', rows);
      u.searchParams.set('minespercell', mpc);
      u.searchParams.set('mines', mines);
      u.searchParams.set('whiteminespercell', wmpc);
      u.searchParams.set('whitemines', wmines);
      // ì§€ëŠ¥í˜• ìƒì„± ìˆ˜ì¤€ í¬í•¨(ê¸°ë³¸ 0)
      let logic = toInt(document.getElementById('ai')?.value, 0);
      u.searchParams.set('logic', logic);
      // ìˆ¨ê¹€ í”Œë˜ê·¸ & ìºì‹œ ë°©ì§€ìš© íƒ€ì„ìŠ¤íƒ¬í”„
      u.searchParams.set('hide', '1');
      u.searchParams.set('ts', String(Date.now()));

      // ë’¤ë¡œê°€ê¸° íˆìŠ¤í† ë¦¬ë¥¼ ë‚¨ê¸°ì§€ ì•Šê³ , ê°•ì œ ìƒˆë¡œê³ ì¹¨ íš¨ê³¼
      window.location.replace(u.pathname + '?' + u.searchParams.toString());
    }

    /* ìœ í‹¸: digit DOM ìˆ˜ ë§ì¶”ê¸° */
    function ensure_digits(counter, count) {
      const cur = counter.children().length;
      if (cur < count) {
        for (let i = 0; i < count - cur; i++) counter.append('<div class="digit digit-0"></div>');
      } else if (cur > count) {
        for (let i = 0; i < cur - count; i++) $(counter.children()[0]).remove();
      }
    }
    /* íƒ€ì´ë¨¸(3ìë¦¬ ê³ ì •) */
    function update_counter_timer(val, counter) {
      if (val > 999) val = 999; if (val < 0) val = 0;
      ensure_digits(counter, 3);
      const digits = [ Math.floor(val/100), Math.floor(val/10)%10, val%10 ];
      for (let i=0;i<3;i++){
        const d = digits[i];
        const child = $(counter.children()[i]);
        child.removeClass(); child.addClass("digit digit-" + d);
      }
    }
    /* ìˆ«ì ì¹´ìš´í„°(ìë¦¿ìˆ˜ ê³ ì • ì§€ì›) */
    function update_counter_generic(val, counter, totalForWidth, fixedDigits) {
      let N = fixedDigits || Math.max(3, String(Math.abs(totalForWidth || val || 0)).length);
      ensure_digits(counter, N);
      const isNeg = val < 0;
      if (isNeg) {
        const slots = N - 1;
        const maxAbs = Math.pow(10, slots) - 1;
        let absVal = Math.abs(val);
        if (absVal > maxAbs) absVal = maxAbs;
        let child = $(counter.children()[0]);
        child.removeClass().addClass("digit digit-10");
        const padded = String(absVal).padStart(slots, "0");
        for (let i = 0; i < slots; i++) {
          const d = padded.charCodeAt(i) - 48;
          child = $(counter.children()[i + 1]);
          child.removeClass().addClass("digit digit-" + d);
        }
      } else {
        const padded = String(val).padStart(N, "0");
        for (let i = 0; i < N; i++) {
          const d = padded.charCodeAt(i) - 48;
          const child = $(counter.children()[i]);
          child.removeClass().addClass("digit digit-" + d);
        }
      }
      counter.css({ width: (N * 13) + "px", display: "flex", whiteSpace: "nowrap", height: "23px" });
    }

    /* ëª¨ë“ˆ ì „í™˜ */
    function renderCounters(hasWhite) {
      const single = document.getElementById('counters-single');
      const dual   = document.getElementById('counters-dual');
      if (!single || !dual) return;
      if (hasWhite) { 
        single.style.display = 'none'; dual.style.display = '';
        //div classê°€ mint-timerì¸ ê²ƒê³¼ mine-reset-buttonì¸ ê²ƒì˜ styleì˜ topì„ 16pxë¡œ ì„¤ì •
        const timer = document.querySelector('.mine-timer');
        if (timer) timer.style.top = '16px';
        const resetBtn = document.querySelector('.mine-reset-button');
        if (resetBtn) resetBtn.style.top = '16px';
       }
      else { 
        single.style.display = '';    dual.style.display   = 'none'; 
        //div classê°€ mint-timerì¸ ê²ƒê³¼ mine-reset-buttonì¸ ê²ƒì˜ styleì˜ topì„ 6pxë¡œ ì„¤ì •
        const timer = document.querySelector('.mine-timer');
        if (timer) timer.style.top = '6px';
        const resetBtn = document.querySelector('.mine-reset-button');
        if (resetBtn) resetBtn.style.top = '6px';
      }
    }

    /* ëª¨ë“  ì¹´ìš´í„° ê°±ì‹  */
    function update_all_mine_counters() {
      const hasWhite = (minefield.white_total || minefield.num_mines_white || 0) > 0;
      if (hasWhite) {
        const bTotal = (minefield.num_mines || 0);
        const wTotal = (minefield.white_total || minefield.num_mines_white || 0);
        const maxTotalAbs = Math.max(Math.abs(bTotal), Math.abs(wTotal));
        const N = Math.max(3, String(maxTotalAbs).length);
        const blackRemain = bTotal - (minefield.num_flags || 0);
        const whiteRemain = wTotal - (minefield.num_flags_white || 0);
        update_counter_generic(blackRemain, $("#mine-counter-black"), bTotal, N);
        update_counter_generic(whiteRemain, $("#mine-counter-white"), wTotal, N);
      } else {
        const remain = (minefield.num_mines || 0) - (minefield.num_flags || 0);
        update_counter_generic(remain, $("#mine-counter-single"), minefield.num_mines || 0);
      }
    }

    /* ìœˆë„ìš°/ë©”ë‰´ ì´ˆê¸°í™” â€” ìš”ì†Œê°€ ìˆì„ ë•Œë§Œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ */
    if ($('.window').length) $('.window').window();
    if ($('.listview').length) $('.listview').listview();
    if ($('.desktop-listview').length) $('.desktop-listview').listview();
    if ($('.menu-bar').length) $('.menu-bar').menubar();
    if ($('.taskbar ul.start').length) {
      $('.taskbar ul.start').menubar({ position_toplevel: { my: "left bottom", at: "left top" } });
    }

    /* íƒ€ì´ë¨¸ */
    var timer_val = 0, timer_id = null;
    var update_timer = function(){ 
      timer_val += 1; 
      update_counter_timer(timer_val, $(".mine-timer"));
      // íƒ€ì´ë¨¸ê°€ ì¦ê°€í•  ë•Œ ì†Œë¦¬ ì¬ìƒ
      playSound('timer.wav');
    };

    /* Minefield ì¸ìŠ¤í„´ìŠ¤ */
    var mine_area = document.getElementById("mine-area");
    var minefield = new window.Minefield(
      mine_area,
      function(status) {
        var smile = $(".mine-reset-button .mine-reset-button-inner");
        // ì–¼êµ´ ìœ„ì¹˜: 0=í‰ìƒì‹œ, -21px=ì£½ìŒ, -42px=ìƒê°ì¤‘, -63px=ìŠ¹ë¦¬, -84px=ëˆŒë¦¼(ê°•ì¡°)
        var bg = "0 0"; if (status === -1) bg = "-21px 0"; if (status === -2) bg = "-63px 0"; if (status === 2) bg = "-42px 0";
        smile.css({"background-position": bg});

        if (status === 0) timer_id = window.setInterval(update_timer, 1000);
        if (status < 0 || status === 1) {
          window.clearInterval(timer_id);
          if (status === 1) {
            const hasWhite = (minefield.white_total || minefield.num_mines_white || 0) > 0;
            renderCounters(hasWhite);
            const head = document.querySelector('.window-content .mine-head-area');
            if (head) head.style.height = hasWhite ? '58px' : '38px';
            update_all_mine_counters();
            timer_val = 0; timer_id = null; update_counter_timer(0, $(".mine-timer"));
          }
          if (status === -1) {
            // ê²Œì„ ì‹¤íŒ¨ ì‹œ (ì§€ë¢°ë¥¼ ë°Ÿì•˜ì„ ë•Œ) gameover.wav ì¬ìƒ
            playSound('gameover.wav');
          }
          if (status === -2) {
            update_all_mine_counters();
            // ê²Œì„ í´ë¦¬ì–´ ì‹œ clear.wav ì¬ìƒ
            playSound('clear.wav');
            // Save best time if this is a tracked difficulty level
            if (DIFFICULTY_LEVELS[currentDifficultyLevel]) {
              const level = DIFFICULTY_LEVELS[currentDifficultyLevel];
              const currentTime = timer_val;
              const bestTime = getBestTime(level);
              if (currentTime < bestTime) {
                // ìƒˆë¡œìš´ ê¸°ë¡ì´ë¯€ë¡œ ì´ë¦„ ì…ë ¥ ì°½ì„ ë„ì›€
                showNameInputDialog(level, currentTime);
              }
            }
          }
        }
      },
      function(status) {
  // â˜… ê²Œì„ì´ ëë‚œ ìƒíƒœ(-1: íŒ¨ë°°, -2: í´ë¦¬ì–´)ì—ì„œëŠ” ë®ì–´ì“°ì§€ ì•ŠìŒ
  if (minefield.game_status < 0) return;

  var smile = $(".mine-reset-button .mine-reset-button-inner");

        // status === 1: ì…€ ë²„íŠ¼ ëˆŒë¦¼ â†’ 3ë²ˆì§¸ ì–¼êµ´(-42px, thinking face)
        // status === 0: ì •ìƒ â†’ 1ë²ˆì§¸ ì–¼êµ´(0)
        // 5ë²ˆì§¸ ì–¼êµ´(-84px)ì€ CSS :activeë¡œ ì–¼êµ´ ë²„íŠ¼ ìì²´ê°€ ëˆŒë ¸ì„ ë•Œ í‘œì‹œ
        smile.css({"background-position": (status === 1) ? "-42px 0" : "0 0"});
      }
    );

    /* ê¹ƒë°œ ìš°í´ë¦­ ì‹œ ì¹´ìš´í„° ê°±ì‹  */
    minefield.on_rclick_func = function(){ update_all_mine_counters(); };



    /* GET ì¸ì ìë™ ì ìš© (ë¡œë“œ ì‹œì—ë„ ìƒí•œ ë³´ì • ê°•ì œ) */
    document.addEventListener('DOMContentLoaded', function() {
      const q = getQueryParams();
      if (hasCoreParams(q)) {
        let cols = Math.max(3, toInt(q.cols, 30));
        let rows = toInt(q.rows, 16);
        let mpc  = clamp(toInt(q.minespercell, 1), 1, 6);
        let mines= Math.max(1, toInt(q.mines, 99));
        let wmpc = clamp(getQueryDefault0(q.whiteminespercell), 0, 6);
        let wmines = Math.max(0, getQueryDefault0(q.whitemines));
        let logic = (q.logic !== null) ? clamp(toInt(q.logic, 0), 0, 2) : 0;
        // ë³´ì • 1: ê²€ì€ ì´ìˆ˜
        let caps = calcCaps(cols, rows, mpc, mines,wmpc);
        if (mines > caps.capBlackTotal) mines = caps.capBlackTotal;

        // ë³´ì • 2: í° ì´ìˆ˜
        caps = calcCaps(cols, rows, mpc, mines,wmpc);
        if (wmines > caps.capWhiteTotal) wmines = caps.capWhiteTotal;

        execute(cols, rows, mines, mpc, wmines, wmpc, logic);

        // í¼ê³¼ max íŒíŠ¸ë„ ë™ê¸°í™”
        x.value=cols; y.value=rows; m.value=mpc; t.value=mines;
        wm.value=wmpc; wt.value=wmines;
        t.max  = String(caps.capBlackTotal);
        wt.max = String(caps.capWhiteTotal);
        const aiSel = document.getElementById('ai');
        if (aiSel) aiSel.value = String(logic);
        hideUserInputs();
      }
      else if (q.hide === '1') {
        // í•µì‹¬ íŒŒë¼ë¯¸í„°ê°€ ì—†ë”ë¼ë„, hide=1ì´ë©´ ì„¤ëª…/í¼ì„ ë¬´ì¡°ê±´ ìˆ¨ê¹€
        hideUserInputs();
      }
else {
  // li class="menu1"ë¥¼ ëˆ„ë¥´ëŠ” ëª…ë ¹ì„ í•œë²ˆ ì¤€ë‹¤
  const menu1 = document.querySelector('li.menu1');
  if (menu1) menu1.click();
}
    });
/* ===== Console Mirror ===== */
(function setupConsoleMirror(){
  const bodyEl   = document.getElementById('console-body');
const btnPlay  = document.getElementById('console-play');
  const btnPause = document.getElementById('console-pause');
  const btnClear = document.getElementById('console-clear');
  const btnCopy  = document.getElementById('console-copy');
  const cbAuto   = document.getElementById('console-autoscroll');

  if (!bodyEl) return; // ì•ˆì „ê°€ë“œ

  let paused = false;
  function ts() {
    const d = new Date();
    const pad = (n)=> String(n).padStart(2,'0');
    return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}.${String(d.getMilliseconds()).padStart(3,'0')}`;
  }
  function print(level, args) {
    if (paused) return;
    const line = document.createElement('div');
    line.className = `console-line console-lvl-${level}`;
    const t = document.createElement('span');
    t.className = 'console-time';
    t.textContent = `[${ts()}] `;
    line.appendChild(t);

    const content = Array.from(args).map(v => {
      try {
        if (typeof v === 'string') return v;
        return JSON.stringify(v);
      } catch(_) {
        return String(v);
      }
    }).join(' ');
    line.appendChild(document.createTextNode(content));
    bodyEl.appendChild(line);

    if (cbAuto && cbAuto.checked) {
      bodyEl.scrollTop = bodyEl.scrollHeight;
    }
  }

  // ì›ë³¸ ë³´ì¡´
  const orig = {
    log:   console.log.bind(console),
    info:  console.info?.bind(console)  || function(){},
    warn:  console.warn?.bind(console)  || function(){},
    error: console.error?.bind(console) || function(){},
  };

  // í›„í‚¹
  console.log  = function(){ print('log', arguments);  orig.log.apply(console, arguments); };
  console.info = function(){ print('info', arguments); orig.info.apply(console, arguments); };
  console.warn = function(){ print('warn', arguments); orig.warn.apply(console, arguments); };
  console.error= function(){ print('error', arguments);orig.error.apply(console, arguments); };

  // ì»¨íŠ¸ë¡¤
  if (btnPause) {
    btnPause.addEventListener('click', function(){
      paused = !paused;
      btnPause.textContent = paused ? 'ì¬ê°œ' : 'ì¼ì‹œì •ì§€';
    });
  }
  if (btnClear) {
    btnClear.addEventListener('click', function(){
      bodyEl.textContent = '';
    });
  }
  if (btnCopy) {
    btnCopy.addEventListener('click', async function(){
      const text = Array.from(bodyEl.querySelectorAll('.console-line'))
        .map(el => el.textContent).join('\n');
      try { await navigator.clipboard.writeText(text); } catch(_) {}
    });
  }

  // ì‹œì‘ ë©”ì‹œì§€
  console.info('[Console mirror started]');
})();
function isKorean() {
    var lang = (navigator.language || navigator.userLanguage || "").toLowerCase();
    return lang.startsWith("ko");
  }

  // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  function updateWindowTitle() {
    const titleEl = document.querySelector('.mine-window .title-bar .title');
    if (titleEl) {
      titleEl.textContent = isKorean() ? 'ì§€ë¢° ì°¾ê¸°' : 'Minesweeper';
    }
  }
  //pressreset í•¨ìˆ˜ëŠ” minefield.reset_board();ë¥¼ ì‹¤í–‰
  function pressreset() {
    if (window.minefield) {
      minefield.reset_board();
    }
  }

  // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì²˜ë¦¬ (F2 + ë©”ë‰´ ë‹¨ì¶•í‚¤)
  document.addEventListener('keydown', function(e) {
    const key = e.key.toUpperCase();
    
    // F2 í‚¤: í•­ìƒ ìƒˆ ê²Œì„
    if (e.key === 'F2') {
      e.preventDefault();
      pressreset();
      return;
    }
    
    // ì„œë¸Œë©”ë‰´ê°€ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸
    const gameSubMenu = document.querySelector('.menu-bar > li:first-child > .menu');
    const helpSubMenu = document.querySelector('.menu-bar > li:nth-child(2) > .menu');
    
    const isGameMenuVisible = gameSubMenu && (
      gameSubMenu.style.display === 'block' || 
      window.getComputedStyle(gameSubMenu).display === 'block'
    );
    
    const isHelpMenuVisible = helpSubMenu && (
      helpSubMenu.style.display === 'block' || 
      window.getComputedStyle(helpSubMenu).display === 'block'
    );
    
    // ê²Œì„ ë©”ë‰´ê°€ ì—´ë ¤ìˆì„ ë•Œ
    if (isGameMenuVisible) {
      let handled = false;
      
      if (key === 'N') {
        e.preventDefault();
        pressreset();
        handled = true;
      } else if (key === 'B') {
        e.preventDefault();
        execute(9, 9, 10, 1, 0, 0, 2);
        setActiveDifficulty(1);
        handled = true;
      } else if (key === 'I') {
        e.preventDefault();
        execute(16, 16, 40, 1, 0, 0, 2);
        setActiveDifficulty(2);
        handled = true;
      } else if (key === 'E') {
        e.preventDefault();
        execute(30, 16, 99, 1, 0, 0, 2);
        setActiveDifficulty(3);
        handled = true;
      } else if (key === 'C') {
        e.preventDefault();
        openCustomDialog();
        setActiveDifficulty(14);
        handled = true;
      } else if (key === 'M') {
        e.preventDefault();
        toggleQuestionMarks();
        handled = true;
      } else if (key === 'L') {
        e.preventDefault();
        toggleColorMode();
        handled = true;
      } else if (key === 'S') {
        e.preventDefault();
        toggleSound();
        handled = true;
      } else if (key === 'T') {
        e.preventDefault();
        printBestTimes();
        handled = true;
      } else if (key === 'X') {
        e.preventDefault();
        $('.has-menu.mine-window.ui-resizable.ui-draggable').css('visibility', 'hidden');
        handled = true;
      }
      
      if (handled) {
        closeMenus();
      }
    }
    
    // Best Times ë‹¤ì´ì–¼ë¡œê·¸ê°€ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸
    const bestTimesDialog = document.getElementById('besttimes-win');
    const isBestTimesVisible = bestTimesDialog && (
      bestTimesDialog.style.display === 'block' || 
      (bestTimesDialog.style.display !== 'none' && window.getComputedStyle(bestTimesDialog).display === 'block')
    );
    
    // Best Times ë‹¤ì´ì–¼ë¡œê·¸ê°€ ì—´ë ¤ìˆì„ ë•Œ
    if (isBestTimesVisible) {
      if (key === 'R') {
        e.preventDefault();
        resetBestTimes();
        return;
      }
    }

    // ë„ì›€ë§ ë©”ë‰´ê°€ ì—´ë ¤ìˆì„ ë•Œ
    if (isHelpMenuVisible) {
      let handled = false;
      const alertMsg = isKorean() ? 'ë„ì›€ë§ì€ ì•„ë˜ì— ìˆìŠµë‹ˆë‹¤' : 'Help is below';
      
      if (key === 'C') {
        e.preventDefault();
        alert(alertMsg);
        handled = true;
      } else if (key === 'S') {
        e.preventDefault();
        alert(alertMsg);
        handled = true;
      } else if (key === 'H') {
        e.preventDefault();
        // ë„ì›€ë§ ì‚¬ìš© (ê¸°ëŠ¥ ì—†ìŒ)
        handled = true;
      } else if (key === 'A') {
        e.preventDefault();
        alert('Minesweeper');
        handled = true;
      }
      
      if (handled) {
        closeMenus();
      }
    }
  });
/* ===== Runtime i18n: if not Korean, switch UI texts to English ===== */
(function () {
  

  function setText(el, txt) { if (el) el.textContent = txt; }
  function setHTML(el, html){ if (el) el.innerHTML = html; }

  function localizeToEnglish() {
    document.documentElement.setAttribute("lang", "en");

    /* 1) Menu labels */
    const menuText = {
      ".menu0":  "ã€€Newã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€F2",
      ".menu1":  "ã€€Beginner",
      ".menu2":  "ã€€Intermediate",
      ".menu3":  "ã€€Expert",
      ".menu_4":  "ã€€Others...",
      ".menu4":  "ã€€Ultra",
      ".menu5":  "ã€€ğŸ˜±",
      ".menu6":  "ã€€ğŸ’€",
      ".menu7":  "ã€€â˜ ï¸",
      ".menu8":  "ã€€â˜ ï¸â˜ ï¸",
      ".menu9":  "ã€€â˜ ï¸â˜ ï¸â˜ ï¸",
      ".menu10": "ã€€AntiMine",
      ".menu11": "ã€€Large",
      ".menu12": "ã€€XLarge",
      ".menu13": "ã€€XXLarge",
      ".menu14": "ã€€Custom...",
      ".besttimes": "ã€€Best Times...",
      ".menuclose":"ã€€Exit",
      ".menu100": "ã€€Search for Help on...",
      ".menu101": "ã€€About Minesweeper...",
      ".menu102": "ã€€Contentsã€€ã€€ã€€ã€€ ã€€ã€€F1",
      ".menu103": "ã€€Using Help",
      ".menu_cheat":  "Cheat...",
      ".menu-autosolve": "ã€€Solve Automatically",
      ".menu-hint": "ã€€Hint",
      ".menu201":"Game",
      ".menu202":"Help",
    };
    Object.keys(menuText).forEach(sel => {
      const el = document.querySelector(sel);
      if (!el) return;

      // ìš”ì†Œ ì•ˆì— <a> íƒœê·¸ê°€ ìˆë‹¤ë©´ <a> íƒœê·¸ì˜ í…ìŠ¤íŠ¸ë§Œ ë³€ê²½ (ì„œë¸Œë©”ë‰´ <ul> ë³´ì¡´ì„ ìœ„í•´)
      const link = el.querySelector('a');
      if (link) {
        link.textContent = menuText[sel];
      } else {
        // <a> íƒœê·¸ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ ì²˜ë¦¬
        setText(el, menuText[sel]);
      }
    });

    /* 1-1) Update menu items that need special handling */
    // Question marks, Color and Sound menus are updated by their own functions
    updateQuestionMenuVisual();
    updateColorMenuVisual();
    updateSoundMenuVisual();

    /* 1-2) Title update */
    const titleEl = document.querySelector('.mine-window .title-bar .title');
    if (titleEl) titleEl.textContent = 'Minesweeper';

    /* 2) Counter icon tooltips */
    const blackIcon = document.querySelector(".icon-flag-black");
    if (blackIcon) blackIcon.setAttribute("title", "Black mine");
    const whiteIcon = document.querySelector(".icon-flag-white");
    if (whiteIcon) whiteIcon.setAttribute("title", "Anti-mine");

    /* 3) Form labels / buttons */
    const form = document.querySelector("#userctrl form");
    if (form) {
      // ë¼ë²¨ì€ ì •ì ì¸ í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì¹˜í™˜
      let html = form.innerHTML;
      html = html.replace("ì£¼ë¬¸ì œì‘:ê°€ë¡œ", "Custom: cols")
                 .replace("ì„¸ë¡œ", "rows")
                 .replace("1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜", "Max mines / cell")
                 .replace("ì „ì²´ ì§€ë¢° ìˆ˜", "Total mines")
                 .replace("1ì¹¸ë‹¹ ìµœëŒ€ ìŒìˆ˜ì§€ë¢° ìˆ˜", "Max anti-mines / cell")
                 .replace("ì „ì²´ ìŒìˆ˜ì§€ë¢° ìˆ˜", "Total anti-mines")
                 .replace("ì§€ëŠ¥í˜• ìƒì„±", "Generation mode")
                 .replace("ìƒì„±", "Create")
                 .replace("ë¬¸êµ¬ ìˆ¨ê¸°ê¸°", "Hide controls")
                 
      form.innerHTML = html;

      // ì…€ë ‰íŠ¸ ì˜µì…˜ë„ ì˜ë¬¸í™”
      const aiSel = document.getElementById('ai');
      if (aiSel) {
        const opt = aiSel.options;
        if (opt[0]) opt[0].text = "0: allow guesses + minimal rescue";
        if (opt[1]) opt[1].text = "1: allow guesses + guaranteed first click opening +unlimited rescue";
        if (opt[2]) opt[2].text = "2: strict no-guess + auto-solve (slow)";
      }
    }

    /* 4) Heavy notice(ì œëª©/ë¬¸êµ¬ë§Œ ë¶€ë¶„ ì¹˜í™˜, DOMì€ ë³´ì¡´) */
    const notice = document.getElementById("heavy-notice");
    if (notice) {
      const h3 = notice.querySelector("h3");
      setText(h3, "Notice / Performance Tips");

      // í•œêµ­ì–´ ë¦¬ìŠ¤íŠ¸ í•­ëª©ì„ ì•ˆì „í•˜ê²Œ êµì²´ (ìˆëŠ” ê²½ìš°ì—ë§Œ)
      // ì²« ë²ˆì§¸ í° <ul> ì•ˆì˜ í•œêµ­ì–´ ë¬¸êµ¬ë“¤ì„ ì°¾ì•„ ì˜ì–´ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
      // ì´ë¯¸ ì˜ì–´ë¼ë©´ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤.
      const list = notice.querySelector("ul");
      if (list) {
        let html = list.innerHTML;
        html = html
          .replace(/ëª¨ë°”ì¼ì—ì„œ ì¡°ì‘:ì§§ê²Œ ëˆŒëŸ¬ ì¢Œí´ë¦­, ê¸¸ê²Œ ëˆŒëŸ¬ ìš°í´ë¦­, ì—´ë¦°ì¹¸ì„ ë”ë¸”í„°ì¹˜í•´ì„œ chording.<\/li>/,'Controls on mobile: Short press to left-click, long press to right-click, double-tap an open space to chord.</li>' )
          .replace(/ì²« í´ë¦­ ì§í›„ .*?ì¦ê°€\)<\/li>/, 'Right after the first click, <span class="warn">board generation</span> may take a while. (More mines & larger boards take longer.)</li>')
          .replace(/ì´ˆëŒ€í˜•ê³¼ íŠ¹ëŒ€í˜• íŒì€ ì´ˆê¸°í™”ì— ì•½ .*?<\/li>/, 'XLarge and XXLarge boards take about 5â€“10 seconds to initialize.</li>')
          .replace(/<li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš©ì˜ êµ¬ì œ ê¸°ëŠ¥ ê´€ë ¨<\/strong>/, '<li><strong>About the rescue feature when guesses are allowed</strong>')
          .replace(/ë³µìˆ˜í•´ê°€ .*?ìˆ˜ì •í•©ë‹ˆë‹¤<\/li>/, 'If multiple solutions exist and a guess situation occurs, and you click a mine cell without contradicting revealed info, the board will be modified so that there is no mine in that cell.</li>')
          .replace(/í•˜ì§€ë§Œ ë¬´ì œí•œ êµ¬ì œëŠ” ë‚œì´ë„ë¥¼ ì‹¬ê°í•˜ê²Œ ë‚®ì¶¥ë‹ˆë‹¤<\/li>/, 'However, unlimited rescues significantly reduce the difficulty.</li>')
          .replace(/<li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨<\/strong> ëª¨ë“œ ì„±ëŠ¥ ì£¼ì˜:/, '<li><strong>Strict no-guess</strong> mode performance caveats:')
          .replace(/ìŒìˆ˜ì§€ë¢°ê°€ ìˆìœ¼ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤.*?<\/li>/, 'Very slow when anti-mines are used (not recommended for â‰¥ Intermediate).</li>')
          .replace(/1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜ê°€ 4 ì´ìƒì´ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤\.<\/li>/, 'Very slow if max mines per cell â‰¥ 4.</li>')
          .replace(/ëŒ€í˜• ì´ìƒì˜ í° íŒì—ì„œëŠ” ë§¤ìš° ëŠë¦½ë‹ˆë‹¤\.<\/li>/, 'Very slow on large boards (â‰¥ Large).</li>')
          .replace(/í•´ë‹¹ ëª¨ë“œëŠ” â€œì°ê¸° ì—†ëŠ” í’€ì´ ìˆœì„œâ€ë¥¼ í•­ìƒ ë³´ì¥í•˜ë©°, ìë™ í’€ê¸°ì™€ íŒíŠ¸ ì œê³µ ê¸°ëŠ¥ì€ ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤\.<\/li>/,'This mode guarantees a guess-free solution order, and the auto-solving and hint features are only available in strict no-guess mode.</li>' )
          .replace(/ë„ì›€ë§/, 'Help')
          .replace(/ë‚œì´ë„ëŠ” ê²Œì„ì—ì„œ ì„ íƒí•˜ì„¸ìš”.\\n?í‘œì‹œëŠ” ì˜µì…˜ì—ì„œ í† ê¸€í•©ë‹ˆë‹¤./, 'Select difficulty in-game.\\nToggle question marks in options.');
        setHTML(list, html);
      }
      
    }
const form2 = document.querySelector("#customdial2");
if (form2) {
  // ë¼ë²¨ì€ ì •ì ì¸ í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì¹˜í™˜
  let html = form2.innerHTML;

  // â–¼ í•œâ€“ì˜ ì¹˜í™˜: #userctrl í¼ ì•ˆì—ì„œ ì“°ì´ëŠ” ëª¨ë“  í•œêµ­ì–´ ë¼ë²¨/ë²„íŠ¼ í…ìŠ¤íŠ¸ ì»¤ë²„
  html = html
    // "ì£¼ë¬¸ì œì‘:ê°€ë¡œ" ë° ê³µë°± ë³€í˜•
    // ê°€ë¡œ/ì„¸ë¡œ(í–‰) ë¼ë²¨(ê´„í˜¸ ìœ ë¬´ ëª¨ë‘)
    .replace(/ë„ˆë¹„\s*\(W\)*/g, "Width")
    .replace(/ë†’ì´\s*\(H\)*/g, "Height")
    // ì§€ë¢°/ìŒìˆ˜ì§€ë¢°(= anti-mine) í•­ëª©
    .replace(/ìµœëŒ€ì§€ë¢°\/1ì¹¸/g, "Max mines/cell")
    .replace(/ì§€ë¢°\s*ìˆ˜\s*\(M\)*/g, "Mines")
    .replace(/ìµœëŒ€ìŒìˆ˜ì§€ë¢°\/1ì¹¸/g, "Max antiMines/cell")
    .replace(/ìŒìˆ˜ì§€ë¢°\s*ìˆ˜/g, "antiMines")
    // ìƒì„± ëª¨ë“œ
    .replace(/ì§€ëŠ¥í˜•\s*ìƒì„±/g, "Generation mode")
    // ë²„íŠ¼ë“¤
    .replace(/í™•ì¸/g, "OK")
    .replace(/ì·¨ì†Œ/g, "Cancel");
    
  form2.innerHTML = html;

  // ì…€ë ‰íŠ¸ ì˜µì…˜(ì§€ëŠ¥í˜• ìƒì„±) ì˜ì–´í™”ëŠ” ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€
  const aiSel = document.getElementById('c-ai');
  if (aiSel) {
    const opt = aiSel.options;
    if (opt[0]) opt[0].text = "0: allow guesses + minimal rescue";
    if (opt[1]) opt[1].text = "1: allow guesses + guaranteed first click opening + unlimited rescue";
    if (opt[2]) opt[2].text = "2: strict no-guess + auto-solve (slow)";
  }
}
//custdialtitleì˜ í…ìŠ¤íŠ¸ë„ ì²˜ë¦¬
const custdialtitle = document.querySelector('#custdialtitle');
if (custdialtitle) {
  let html = custdialtitle.innerHTML;
  html = html.replace(/ì‚¬ìš©ì\s*ì§€ì •\s*ê²Œì„/g, 'Custom Field');
  custdialtitle.innerHTML = html;
}

    /* 5) Console panel í—¤ë”/ë²„íŠ¼ */
    const cp = document.getElementById("console-panel");
    if (cp) {
      const titleEl = cp.querySelector('.console-head .title');
      const pauseEl = document.getElementById('console-pause');
      const playEl  = document.getElementById('console-play');
      const hintEl  = document.getElementById('console-hint');   // â† ëˆ„ë½ëë˜ ë¶€ë¶„ ì¶”ê°€
      const clearEl = document.getElementById('console-clear');
      const copyEl  = document.getElementById('console-copy');
      const autoLbl = cp.querySelector('.console-head label');

      setText(titleEl, 'Live Log (Console mirror)');
      setText(playEl,  'Solve Minesweeper Automatically');
      setText(hintEl,  'Hint From Log');              // â† â€œíŒíŠ¸ ì œê³µâ€ ë²ˆì—­
      setText(pauseEl, 'Pause Console');
      setText(clearEl, 'Clear Console');
      setText(copyEl,  'Copy Console');
      if (autoLbl) setHTML(autoLbl, '<input type="checkbox" id="console-autoscroll" checked> Auto scroll');

      // ì¼ì‹œì •ì§€ ë²„íŠ¼ í† ê¸€ í…ìŠ¤íŠ¸ë„ ì˜ì–´ë¡œ
      pauseEl?.addEventListener('click', function(){
        const isResume = pauseEl.textContent.includes('Resume');
        pauseEl.textContent = isResume ? 'Pause' : 'Resume';
      });
    }
  }

  if (!isKorean()) {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", localizeToEnglish);
    } else {
      localizeToEnglish();
    }
  } else {
    // í•œêµ­ì–´ì¸ ê²½ìš°ì—ë„ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", updateWindowTitle);
    } else {
      updateWindowTitle();
    }
  }
})();


</script>
<div id="i18n-hint" style="display:none">
  <!-- ì˜ëª» ë§ˆí‚¹í•œ ì¹¸ ì•Œë¦¼ -->
  <span id="i18n-wrong-flag">ì˜ëª» ë§ˆí‚¹í•œ ì¹¸ì´ ìˆìŠµë‹ˆë‹¤: ({x}, {y}). ë¨¼ì € ì´ ì¹¸ì„ ìˆ˜ì •í•˜ì„¸ìš”.</span>
  <span id="i18n-wrong-flag-en">You mis-flagged a cell: ({x}, {y}). Please fix this first.</span>

  <!-- ë…¸í”½ íŒíŠ¸ê°€ ë¶ˆê°€í•œ ê²½ìš° -->
  <span id="i18n-not-nopick">ì´ ê¸°ëŠ¥ì€ â€˜ì°ê¸° ì—†ìŒâ€™ ë³´ë“œì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. â€˜ì°ê¸° ì—†ìŒâ€™ ëª¨ë“œë¼ë©´, ì ì–´ë„ í•œ ì¹¸ì„ ì—¬ì„¸ìš”. </span>
  <span id="i18n-not-nopick-en">Hints are available only on a â€œno-pickâ€ board. If itâ€™s already â€œno-pickâ€ mode, please open at least one cell. </span>

  <!-- ë” ì¤„ íŒíŠ¸ê°€ ì—†ì„ ë•Œ -->
  <span id="i18n-no-next">ë” ì´ìƒ ì œê³µí•  íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
  <span id="i18n-no-next-en">No further hints.</span>

  <!-- ë‹¤ìŒ ì•¡ì…˜ ì•ˆë‚´(ì—´ê¸°/ê¹ƒë°œ) -->
  <span id="i18n-next-open">ë‹¤ìŒìœ¼ë¡œ ì—´ì–´ì•¼ í•˜ëŠ” ì•ˆì „í•œ ì¹¸: ({x}, {y}). ê·¼ê±°: {reason}</span>
  <span id="i18n-next-open-en">Next safe cell to open: ({x}, {y}). Rationale: {reason}</span>

  <span id="i18n-next-flag-black">ë‹¤ìŒ ìœ„ì¹˜ì— ì§€ë¢° ê¹ƒë°œ {n}ê°œ: ({x}, {y}). ê·¼ê±°: {reason}</span>
  <span id="i18n-next-flag-black-en">Place {n} mine flag(s) at ({x}, {y}). Rationale: {reason}</span>

  <span id="i18n-next-flag-white">ë‹¤ìŒ ìœ„ì¹˜ì— ìŒìˆ˜ ì§€ë¢° ê¹ƒë°œ {n}ê°œ: ({x}, {y}). ê·¼ê±°: {reason}</span>
  <span id="i18n-next-flag-white-en">Place {n} anti-mine flag(s) at ({x}, {y}). Rationale: {reason}</span>

  <span id="i18n-dead">ì´ë¯¸ ì£½ì—ˆìŠµë‹ˆë‹¤</span>
<span id="i18n-dead-en">Already dead</span>
</div>
<script>
/* ===== ì‘ì€ i18n í—¬í¼ ===== */
const _isKO = () => (navigator.language||'').toLowerCase().startsWith('ko');
function _msg(idKo,idEn, map={}) {
  const root = document.getElementById('i18n-hint');
  const el = root?.querySelector('#'+(_isKO()?idKo:idEn));
  let s = el ? (el.textContent||'') : '';
  return s.replace(/\{(\w+)\}/g, (_,k)=> (map[k]??''));
}
const _deadMsg = () => _msg('i18n-dead','i18n-dead-en') || 'you already dead';

/* ===== ê³µí†µ ìœ í‹¸(ê¹ƒë°œ/ì—´ê¸°) ===== */
function _isFlagUI(mf,x,y){ const c=mf.get_class(x,y); return !!(c && /^flag-/.test(c)); }
function _removeFlagFully(mf,x,y){ let g=24; while(_isFlagUI(mf,x,y)&&g--) mf.on_rclick(x,y); }
function _ensureFlagExactly(mf,x,y,target){ if((mf.flags[x][y]||0)===target) return false; let g=24; while((mf.flags[x][y]||0)!==target&&g--) mf.on_rclick(x,y); return true; }
function _openWithUnflag(mf,x,y){ if (_isFlagUI(mf,x,y)) _removeFlagFully(mf,x,y); if (mf.is_opened(x,y)) return false; mf.on_click(x,y); return true; }

/* ===== trace ì§„í–‰ìƒíƒœ ìœ í‹¸ ===== */
function _done(mf,t){
  if(!t) return true;
  if(t.kind==='open') 
    return mf.is_opened(t.x,t.y);
  if(t.kind==='markMine') 
    return ((mf.flags[t.x][t.y]||0)===(mf.mines[t.x][t.y]|0));
  return true; // rule/subset/flood ë“±ì€ íŒíŠ¸/ë§¤í¬ë¡œ ê´€ì ì—ì„œ ì†Œë¹„ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
}
function _nextVisible(mf){
  const tr=mf._nopick_trace||[]; let i=0;
  while(i<tr.length &&
    _done(mf,tr[i])) 
   i++;
  for(; i<tr.length; i++){ 
    const t=tr[i]; if(t.kind==='open'||t.kind==='markMine') 
      return t; 
  }
  return null;
}
function humanizeReason(raw) {
  if (!raw) return "";
  const KO = (navigator.language||"").toLowerCase().startsWith("ko");

  // ê·œì¹™ë³„ ì •ê·œì‹ ë§¤í•‘ (ìœ„ì—ì„œë¶€í„° ìš°ì„ ì ìš©)
  const table = [
    // Rule A
    [/^RuleA N==0\b/i, () => KO
      ? "ìˆ«ìì¹¸ì˜ ë‚¨ì€ ì§€ë¢° ìˆ˜ Nì´ 0 â†’ ì£¼ë³€ ë‹«íŒ ì¹¸ì€ ëª¨ë‘ ì•ˆì „"
      : "Remaining mines N is 0 â†’ all adjacent closed cells are safe"],
    [/^RuleA N==F\b/i, () => KO
      ? "ì¸ì ‘ ê¹ƒë°œ ìˆ˜ Fê°€ ìš”êµ¬ ì§€ë¢° ìˆ˜ Nê³¼ ê°™ìŒ â†’ ë‚˜ë¨¸ì§€ ì¸ì ‘ ì¹¸ì€ ëª¨ë‘ ì•ˆì „"
      : "Flags F equals required mines N â†’ all other adjacent cells are safe"],

    // Rule B
    [/^RuleB U==1 exact count=(\d+)/i, (m) => KO
      ? `ì£¼ë³€ ë‹«íŒ ì¹¸ Uê°€ 1ê°œì´ê³  ë‚¨ì€ ì§€ë¢°ê°€ ${m[1]}ê°œ â†’ ê·¸ 1ì¹¸ì´ ì „ë¶€ ì§€ë¢°`
      : `Only 1 closed neighbor (U=1) and ${m[1]} mine(s) remaining â†’ that cell must be a mine`],
    [/^RuleB cap count=(\d+)/i, (m) => KO
      ? `ì¸ì ‘ ì œì•½(ìµœëŒ€ ìˆ˜ìš©)ìœ¼ë¡œ ì§€ë¢° ${m[1]}ê°œê°€ ê°•ì œ`
      : `Capacity bounds force ${m[1]} mine(s)`],

    // SUBSET
    [/^subset single exact count=(\d+)/i, (m) => KO
      ? `ë¶€ë¶„ì§‘í•© ì¶”ë¡ ìœ¼ë¡œ í•´ë‹¹ ì¹¸(ë¬¶ìŒ)ì— ì§€ë¢° ${m[1]}ê°œê°€ ì •í™•íˆ í•„ìš”`
      : `Subset logic forces exactly ${m[1]} mine(s) in the cell set`],
    [/^subset Î”=0\b/i, () => KO
      ? "ë¶€ë¶„ì§‘í•© ì¶”ë¡  ê²°ê³¼ Î”=0 â†’ ë¹„êµëœ ë‚˜ë¨¸ì§€ ì¹¸ì€ ëª¨ë‘ ì•ˆì „"
      : "Subset logic Î”=0 â†’ remaining compared cells are all safe"],
    [/^subset Î”=\|S\|\*cap\b/i, () => KO
      ? "ë¶€ë¶„ì§‘í•© Sì˜ í¬ê¸°Ã—ì¹¸ë‹¹ ìµœëŒ€ì§€ë¢°(cap)ë§Œí¼ ì±„ì›Œì•¼ í•¨ â†’ Sê°€ ëª¨ë‘ ì§€ë¢°"
      : "Subset size Ã— per-cell cap must be filled â†’ S is all mines"],

    // EXISTENCE
    [/^exist\(range==\{0\}\)/i, () => KO
      ? "ëª¨ë“  ê°€ëŠ¥í•œ ë°°ì¹˜ì—ì„œ ì£¼ë³€ ì§€ë¢° ìˆ˜ê°€ 0 â†’ í•­ìƒ ì•ˆì „"
      : "In all placements neighbors count is 0 â†’ always safe"],
    [/^exist\(range==\{(\d+)\}\)/i, (m) => KO
      ? `ê°€ëŠ¥í•œ ë°°ì¹˜ì—ì„œ ì£¼ë³€ ì§€ë¢° ìˆ˜ê°€ ${m[1]}ìœ¼ë¡œë§Œ ì¼ì¹˜`
      : `Across all placements the neighbor count is always ${m[1]}`],

    // BOUNDS
    [/^bounds exact count=(\d+)/i, (m) => KO
      ? `ìƒÂ·í•˜í•œ ê²½ê³„ ê³„ì‚°ìœ¼ë¡œ ì •í™•íˆ ì§€ë¢° ${m[1]}ê°œ í•„ìš”`
      : `Lower/upper bounds force exactly ${m[1]} mine(s)`],
    [/^bounds chord N==minSum\b/i, () => KO
      ? "ìµœì†Œ í•©ì´ ì´ë¯¸ ì±„ì›Œì ¸ ë” ì´ìƒ ì§€ë¢° ë¶ˆê°€ â†’ ë‚˜ë¨¸ì§€ëŠ” ì•ˆì „"
      : "Minimum sum already satisfied â†’ remaining cells are safe"],

    // ê¸°íƒ€ ìì£¼ ë³´ì´ëŠ” ë¡œê·¸ ê¼¬ë¦¬í‘œ
    [/^flood-neighbor\b/i, () => KO
      ? "0ì¹¸ ì—°ì‡„ ê³µê°œë¡œ ì¸ì ‘ ì•ˆì „ì¹¸ ìë™ ê³µê°œ"
      : "Auto-reveal from zero-cell flood"],
    [/^seed\b/i, () => KO
      ? "ì²« í´ë¦­ìœ¼ë¡œ ì‹œì‘í•œ ì•ˆì „ ì˜¤í”ˆ"
      : "Safe open triggered by the first click"],

    [/^RuleB\s+N==U\s+count=(\d+)/i, (m) => KO
      ? `ìˆ«ìì¹¸ì—ì„œ ë‚¨ì€ ì§€ë¢° ìˆ˜ Nì´ ë¯¸ì • ì¹¸ ìˆ˜ Uì™€ ê°™ìŒ â†’ ê·¸ Uì¹¸ì´ ëª¨ë‘ ì§€ë¢° (ì´ ${m[1]}ê°œ)`
      : `Remaining mines N equals number of unknown cells U â†’ all U cells are mines (total ${m[1]})`],

  ];

  for (const [re, make] of table) {
    const m = re.exec(raw);
    if (m) {
      const explain = make(m);
      // ì›ë¬¸ë„ í•¨ê»˜ ë³´ì—¬ ì£¼ë˜, ì‚¬ëŒì´ ì½ëŠ” ì„¤ëª…ì„ ë’¤ì— ë§ë¶™ì„
      return `${raw} â€” ${explain}`;
    }
  }
  // ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ì›ë¬¸ ê·¸ëŒ€ë¡œ
  return raw;
}
/* ===== íŒíŠ¸: wrong-flag ìš°ì„  ì•Œë¦¼+ì¦‰ì‹œìˆ˜ì • â†’ ë‹¤ìŒ ìŠ¤í… 1íšŒ ì‹¤í–‰+ê·¼ê±° alert ===== */
window.provide_nopick_hint = function(){
  const mf = window.minefield;
  if (!mf || !mf.use_nopick || !Array.isArray(mf._nopick_trace) || !mf._nopick_trace.length) {
    alert(_msg('i18n-not-nopick','i18n-not-nopick-en')); return;
  }
  if (mf.game_status === -1){ alert(_deadMsg()); console.warn('you already dead'); return; }

  const W=mf.columns|0,H=mf.rows|0, wrong=[];
  for(let y=0;y<H;y++) for(let x=0;x<W;x++){
    const f=mf.flags[x][y]||0; if(!f) continue;
    const ans=mf.mines[x][y]|0; if(f!==ans) wrong.push([x,y,ans]);
  }
  if (wrong.length){
    const [x,y,ans]=wrong[(Math.random()*wrong.length)|0];
    alert(_msg('i18n-wrong-flag','i18n-wrong-flag-en',{x,y}));
    if (ans===0) _removeFlagFully(mf,x,y); else _ensureFlagExactly(mf,x,y,ans);
    return;
  }

  const t = _nextVisible(mf); if(!t){ alert(_msg('i18n-no-next','i18n-no-next-en')); return; }
  const reason = (t.reason??(t.kind==='flood'?'ì¸ì ‘ ì¹¸ ìë™ ê³µê°œ':'auto'));
  if (t.kind==='open'){
    if (_openWithUnflag(mf,t.x,t.y)) {
      const nice = humanizeReason(reason);
      alert(_msg('i18n-next-open','i18n-next-open-en',{x:t.x,y:t.y,reason:nice}));
    }
    else alert(_msg('i18n-no-next','i18n-no-next-en'));
  } else {
    const want = mf.mines[t.x][t.y]|0; if (!want) { alert(_msg('i18n-no-next','i18n-no-next-en')); return; }
    if (_ensureFlagExactly(mf,t.x,t.y,want)){
      const nice = humanizeReason(reason);
      alert(_msg(want<0?'i18n-next-flag-white':'i18n-next-flag-black',
      want<0?'i18n-next-flag-white-en':'i18n-next-flag-black-en',
      {x:t.x,y:t.y,n:Math.abs(want),reason:nice}));
    }
      
    else alert(_msg('i18n-no-next','i18n-no-next-en'));
  }
};

/* ===== ë³´ë“œ UID: init_mines_nopick ì„±ê³µì‹œ ì¦ê°€ ===== */
(function(){
  const orig = window.Minefield?.prototype?.init_mines_nopick;
  if (orig && !window.Minefield.prototype.__uidWrapped){
    window.Minefield.prototype.__uidWrapped = true;
    window.Minefield.prototype.init_mines_nopick = function(fx,fy){
      const r = orig.call(this,fx,fy); if (r===1) this._nopick_board_uid=(this._nopick_board_uid||0)+1; return r;
    };
  }
})();

/* ===== ìë™ì¬ìƒ: 0.3s, ë³´ë“œêµì²´/ì‚¬ë§ ì •ì§€, ë²„íŠ¼ í† ê¸€(ì¼ì‹œì •ì§€/ì¬ê°œ) ===== */
(function(){
  const btn = document.getElementById('console-play');
  const labelPlay  = () => _isKO() ? 'ì§€ë¢° ìë™ìœ¼ë¡œ í’€ê¸°' : 'Solve Minesweeper Automatically';
  const labelPause = () => _isKO() ? 'ìë™ í’€ê¸° ì¼ì‹œ ì¤‘ì§€' : 'Pause Auto-solve';

  function startOrResume(mf){
  
    if (!mf.use_nopick || !Array.isArray(mf._nopick_trace) || !mf._nopick_trace.length) { alert(_msg('i18n-not-nopick','i18n-not-nopick-en')); console.warn('[macro] no-pick trace unavailable.'); return; }
    if (mf.game_status === -1){ alert(_deadMsg()); console.warn('you already dead'); return; }

    if (mf._macro_timer && mf._macro_running && mf._macro_paused){ mf._macro_paused=false; btn&&(btn.textContent=labelPause()); return; }
    if (mf._macro_timer && mf._macro_running && !mf._macro_paused){ mf._macro_paused=true;  btn&&(btn.textContent=labelPlay());  return; }

    if (mf._macro_timer) clearInterval(mf._macro_timer);
    mf._macro_running=true; mf._macro_paused=false;
    const startUID = mf._nopick_board_uid||0;

    mf._macro_timer = setInterval(function(){
      if (!mf._macro_running) { stop('manual'); return; }
      if (mf._macro_paused) return;
      if ((mf._nopick_board_uid||0)!==startUID){ stop('board changed'); return; }
      if (mf.game_status === -1){ stop('dead'); console.warn('you already dead'); alert(_deadMsg()); return; }

      const step = _nextVisible(mf); if (!step){ stop('done'); return; }
      if (step.kind==='open') _openWithUnflag(mf,step.x,step.y);
      else _ensureFlagExactly(mf,step.x,step.y,(mf.mines[step.x][step.y]|0));
      // 1í‹±ë‹¹ 1ê°œë§Œ ìˆ˜í–‰
    }, 40);

    function stop(reason){
      clearInterval(mf._macro_timer); mf._macro_timer=null;
      mf._macro_running=false; mf._macro_paused=false;
      btn&&(btn.textContent=labelPlay());
      if (reason) console.info('[macro] stopped:', reason);
    }
    btn&&(btn.textContent=labelPause());
  }

  // Minefield ë©”ì„œë“œë¡œë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ
  if (window.Minefield && !window.Minefield.prototype.nopick_debug_macro)
    window.Minefield.prototype.nopick_debug_macro = function(){ startOrResume(this); };

  // ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
  document.addEventListener('DOMContentLoaded', ()=>{
    if (!btn) return;
    btn.textContent = labelPlay();
    btn.addEventListener('click', ()=>{ const mf=window.minefield; if (mf) startOrResume(mf); });
    const hintBtn=document.getElementById('console-hint');
    hintBtn&&hintBtn.addEventListener('click', ()=>{ try{ window.provide_nopick_hint(); }catch(e){ console.error(e); } });
  });
})();
</script>
<script>
  function closeMenus() {
    const mb = $('.menu-bar');
    // 1) ìœ„ì ¯ APIë¡œ ì „ì²´ ì ‘ê¸° (ê°€ëŠ¥í•˜ë©´ ì´ê²Œ ê°€ì¥ ê¹”ë”)
    try { mb.menubar('collapseAll'); } catch (e) {}

    // 2) ìƒíƒœ í´ë˜ìŠ¤/ARIA ì •ë¦¬ + ì‹¤ì œ ìˆ¨ê¹€ (í´ë°±)
    mb.find('.ui-state-open').removeClass('ui-state-open');
    mb.find('> li').removeClass('ui-state-active ui-state-hover ui-state-focus');
    mb.find('.ui-state-active').removeClass('ui-state-active');
    mb.find('.menu')
      .hide()
      .attr({'aria-hidden':'true','aria-expanded':'false'});

    // 3) í¬ì»¤ìŠ¤ë„ ì‚´ì§ ë¹¼ì£¼ë©´ blur ì˜ì¡´ UIì—ì„œë„ ì•ˆì „
    mb.trigger('blur');
  }
</script>
<script>
  // ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸°: í˜„ì¬ ê°’ ë°˜ì˜ + í™”ë©´ ì¤‘ì•™ì— ë³´ì—¬ì£¼ê¸°
  function openCustomDialog() {
     
    


    // í˜„ì¬ í¼/ë³´ë“œ ìƒíƒœë¥¼ ê°€ì ¸ì™€ ê¸°ë³¸ê°’ ì±„ìš°ê¸°
    try {
      const cols = parseInt(document.getElementById('x')?.value || minefield?.columns || 30) || 30;
      const rows = parseInt(document.getElementById('y')?.value || minefield?.rows    || 16) || 16;
      const mpc  = parseInt(document.getElementById('m')?.value || 1) || 1;
      const tot  = parseInt(document.getElementById('t')?.value || 99) || 99;
      const wmpc = parseInt(document.getElementById('wm')?.value || 0) || 0;
      const wtot = parseInt(document.getElementById('wt')?.value || 0) || 0;
      const aiStr = document.getElementById('ai')?.value;
let ai = parseInt(aiStr, 10);
if (Number.isNaN(ai)) ai = 2;   // NaNì¼ ë•Œë§Œ 2ë¡œ ëŒ€ì²´ (0ì€ ì‚´ë¦¼)


      document.getElementById('c-cols').value   = cols;
      document.getElementById('c-rows').value   = rows;
      document.getElementById('c-max').value    = mpc;
      document.getElementById('c-total').value  = tot;
      document.getElementById('c-wmax').value   = wmpc;
      document.getElementById('c-wtotal').value = wtot;
      document.getElementById('c-ai').value     = String(ai);
      document.getElementById('c-qmark').checked = !!(window.minefield && window.minefield.question);
    } catch (_) {}

    const $w = $('#custom-win');
    if (!$w.data('mswin-window')) $w.window(); // ì•ˆì „: ìµœì´ˆ 1íšŒë§Œ
    $w.css({
       display: '' ,
      position: 'absolute',
      left: '10px',
      top: '10px',
      'z-index': 1100
      
      });
const dialog = document.getElementById('custom-win');
    if (dialog) {
      dialog.style.width = '225px';
      dialog.style.height = '200px';
      //ì´ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ê°€ì¥ ì•ìœ¼ë¡œ
      dialog.style.zIndex = 1000;
    }

  }

  function closeCustomDialog() {
    $('#custom-win').hide();
  }

  // í™•ì¸ â†’ ë³´ì • â†’ execute() â†’ ?í‘œì‹œ ë°˜ì˜ â†’ ëë‚´ê¸°
  function submitCustomDialog() {
    // ì…ë ¥
    let i = parseInt(document.getElementById('c-cols').value, 10);
    let j = parseInt(document.getElementById('c-rows').value, 10);
    let l = parseInt(document.getElementById('c-max').value, 10);       // mines per cell
    let k = parseInt(document.getElementById('c-total').value, 10);     // total mines
    let wm= parseInt(document.getElementById('c-wmax').value, 10);      // white mines per cell
    let wt= parseInt(document.getElementById('c-wtotal').value, 10);    // total white mines
    let ai= parseInt(document.getElementById('c-ai').value, 10);


    // ê¸°ë³¸/ë³´ì •
    i = Math.max(3, i|0);
    j = Math.max(1, j|0);
    l = Math.min(6, Math.max(1, l|0));
    wm= Math.min(6, Math.max(0, wm|0));
    k = Math.max(1, k|0);
    wt= Math.max(0, wt|0);
    ai= Math.max(0, Math.min(2, ai|0));

    // ìƒí•œ ë³´ì •(ìº¡) â€” ê¸°ì¡´ calcCaps() ì¬ì‚¬ìš©
    let caps = calcCaps(i, j, l, k, wm);
    if (k  > caps.capBlackTotal) k  = caps.capBlackTotal;
    caps = calcCaps(i, j, l, k, wm);
    if (wt > caps.capWhiteTotal) wt = caps.capWhiteTotal;

    // ì ìš©
    try {
      execute(i, j, k, l, wt, wm, ai);

    } catch(e) {
      console.error(e);
    }

    closeCustomDialog();
  }

  //customdialogì˜ display:none;ë¥¼ jsì½”ë“œë¡œ ë™ì ìœ¼ë¡œ ì§€ì •
  document.addEventListener('DOMContentLoaded', function() {
    const dialog = document.getElementById('custom-win');
    if (dialog) {
      dialog.style.display = 'none';
    }
  });
  
</script>

<script>
  // ===== Best Times Management =====
  // Difficulty level mapping: menu index -> level name
  const DIFFICULTY_LEVELS = {
    1: 'beginner',      // ì´ˆê¸‰
    2: 'intermediate',  // ì¤‘ê¸‰
    3: 'expert',        // ê³ ê¸‰
    4: 'ultra',         // ì´ˆê³ ê¸‰
    5: 'level5',        // ğŸ˜±
    6: 'level6',        // ğŸ’€
    7: 'level7',        // â˜ ï¸
    8: 'level8',        // â˜ ï¸â˜ ï¸
    9: 'level9',        // â˜ ï¸â˜ ï¸â˜ ï¸
    10: 'antimine',     // ìŒìˆ˜ì§€ë¢°
    11: 'large',        // ëŒ€í˜•
    12: 'xlarge',       // ì´ˆëŒ€í˜•
    13: 'xxlarge'       // íŠ¹ëŒ€í˜•
  };

  const DIFFICULTY_NAMES_KO = {
    beginner: 'ì´ˆê¸‰',
    intermediate: 'ì¤‘ê¸‰',
    expert: 'ê³ ê¸‰',
    ultra: 'ì´ˆê³ ê¸‰',
    level5: 'ğŸ˜±',
    level6: 'ğŸ’€',
    level7: 'â˜ ï¸',
    level8: 'â˜ ï¸â˜ ï¸',
    level9: 'â˜ ï¸â˜ ï¸â˜ ï¸',
    antimine: 'ìŒìˆ˜ì§€ë¢°',
    large: 'ëŒ€í˜•',
    xlarge: 'ì´ˆëŒ€í˜•',
    xxlarge: 'íŠ¹ëŒ€í˜•'
  };

  const DIFFICULTY_NAMES_EN = {
    beginner: 'Beginner',
    intermediate: 'Intermediate',
    expert: 'Expert',
    ultra: 'Ultra',
    level5: 'ğŸ˜±',
    level6: 'ğŸ’€',
    level7: 'â˜ ï¸',
    level8: 'â˜ ï¸â˜ ï¸',
    level9: 'â˜ ï¸â˜ ï¸â˜ ï¸',
    antimine: 'AntiMine',
    large: 'Large',
    xlarge: 'XLarge',
    xxlarge: 'XXLarge'
  };

  // Current active difficulty (set when user selects a difficulty)
  let currentDifficultyLevel = 3; // Default to Expert

  // Get best time for a difficulty level
  function getBestTime(level) {
    try {
      const stored = localStorage.getItem('minesweeper_best_' + level);
      return stored ? parseInt(stored, 10) : 999;
    } catch (e) {
      return 999;
    }
  }

  // Get best time record (time + name) for a difficulty level
  function getBestRecord(level) {
    try {
      const timeStored = localStorage.getItem('minesweeper_best_' + level);
      const nameStored = localStorage.getItem('minesweeper_name_' + level);
      const time = timeStored ? parseInt(timeStored, 10) : 999;
      const defaultName = isKorean() ? 'ìµëª…' : 'Anonymous';
      const name = nameStored || defaultName;
      return { time, name };
    } catch (e) {
      const defaultName = isKorean() ? 'ìµëª…' : 'Anonymous';
      return { time: 999, name: defaultName };
    }
  }

  // Set best time for a difficulty level
  function setBestTime(level, time, playerName = null) {
    try {
      localStorage.setItem('minesweeper_best_' + level, String(time));
      if (playerName) {
        localStorage.setItem('minesweeper_name_' + level, playerName);
      }
    } catch (e) {
      console.error('Failed to save best time:', e);
    }
  }

  // Reset all best times
  function resetAllBestTimes() {
    Object.values(DIFFICULTY_LEVELS).forEach(level => {
      try {
        localStorage.removeItem('minesweeper_best_' + level);
        localStorage.removeItem('minesweeper_name_' + level);
      } catch (e) {}
    });
  }

  // Open best times dialog
  function openBestTimes() {
    const $w = $('#besttimes-win');
    if (!$w.data('mswin-window')) $w.window();

    // Update dialog content
    const content = document.getElementById('besttimes-content');
    if (!content) return;

    const isKO = isKorean();
    const names = isKO ? DIFFICULTY_NAMES_KO : DIFFICULTY_NAMES_EN;
    const secondsText = isKO ? 'ì´ˆ' : ' seconds';

    // Build the content
    let html = '';
    Object.keys(DIFFICULTY_LEVELS).sort((a, b) => parseInt(a) - parseInt(b)).forEach(key => {
      const level = DIFFICULTY_LEVELS[key];
      const name = names[level]+':';
      const record = getBestRecord(level);
      const timeStr = record.time === 999 ? '999' : String(record.time);
      
      html += `<div style="display:flex; justify-content:space-between; align-items:center; padding:4px 8px; ">
        <span style="flex:0 0 70px;">${name}</span>
        <span style="flex:0 0 80px; ">${timeStr}${secondsText}</span>
        <span style="flex:1; ">${record.name}</span>
      </div>`;
    });
    
    content.innerHTML = html;

    // Update dialog title
    const title = document.getElementById('besttimestitle');
    if (title) {
      title.textContent = isKO ? 'ì§€ë¢° ì°¾ê¸° ìµœê³  ê¸°ë¡' : 'Fastest Mine Sweepers';
    }

    // Update button labels
    const buttons = $w.find('button');
    if (buttons.length >= 2) {
      buttons.eq(0).text(isKO ? 'ì›ë˜ëŒ€ë¡œ(R)' : 'Reset Scores');
      buttons.eq(1).text(isKO ? 'í™•ì¸' : 'OK');
    }

    // Position and show (best times dialog specific)
    $w.css({
      display: '',
      position: 'absolute',
      left: '10px',
      top: '10px',
      'z-index': 1100,
      width: '250px',
      height: 'auto'
    });
  }

  function closeBestTimes() {
    $('#besttimes-win').hide();
  }

  function resetBestTimes() {

     
      resetAllBestTimes();
      openBestTimes(); // Refresh the dialog
    
  }

  function printBestTimes() {
    openBestTimes();
  }

  // Initialize besttimes dialog on load
  document.addEventListener('DOMContentLoaded', function() {
    const dialog = document.getElementById('besttimes-win');
    if (dialog) {
      dialog.style.display = 'none';
    }
    
    // Initialize name input dialog
    const nameDialog = document.getElementById('nameinput-win');
    if (nameDialog) {
      nameDialog.style.display = 'none';
    }
  });

  // Variables to store current record info
  let currentRecordLevel = null;
  let currentRecordTime = null;

  // Show name input dialog for new record
  function showNameInputDialog(level, time) {
    currentRecordLevel = level;
    currentRecordTime = time;
    
    const dialog = document.getElementById('nameinput-win');
    const messageEl = document.getElementById('nameinput-message');
    const inputEl = document.getElementById('nameinput-field');
    
    if (!dialog || !messageEl || !inputEl) return;
    
    // Set language-appropriate message
    const isKO = isKorean();
    const levelNames = isKO ? DIFFICULTY_NAMES_KO : DIFFICULTY_NAMES_EN;
    const levelName = levelNames[level] || level;
    
    const message = isKO 
      ? `${levelName} ìˆ˜ì¤€ì—ì„œëŠ” ìµœê³  ê¸°ë¡ì…ë‹ˆë‹¤.\nì´ë¦„ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤.`
      : `You have the fastest time for ${levelName} level.\nPlease enter your name.`;
    
    messageEl.style.whiteSpace = 'pre-line';
    messageEl.textContent = message;
    
    // Set default name
    const defaultName = isKO ? 'ìµëª…' : 'Anonymous';
    inputEl.value = defaultName;
    
    // Update button text
    const button = dialog.querySelector('button');
    if (button) {
      button.textContent = isKO ? 'í™•ì¸' : 'OK';
    }
    
    // Position dialog at (10,10)
    dialog.style.display = 'block';
    dialog.style.left = '10px';
    dialog.style.top = '10px';
    dialog.style.transform = 'none';
    
    // Focus and select input text
    setTimeout(() => {
      inputEl.focus();
      inputEl.select();
    }, 100);
  }

  // Submit name input and save record
  function submitNameInput() {
    const inputEl = document.getElementById('nameinput-field');
    const dialog = document.getElementById('nameinput-win');
    
    if (!inputEl || !dialog || !currentRecordLevel || currentRecordTime === null) return;
    
    const playerName = inputEl.value.trim() || (isKorean() ? 'ìµëª…' : 'Anonymous');
    
    // Save the record with player name
    setBestTime(currentRecordLevel, currentRecordTime, playerName);
    
    // Hide dialog
    dialog.style.display = 'none';
    
    // Clear current record info
    currentRecordLevel = null;
    currentRecordTime = null;
  }

  // Handle Enter key in name input
  document.addEventListener('keydown', function(e) {
    const dialog = document.getElementById('nameinput-win');
    if (dialog && dialog.style.display === 'block' && e.key === 'Enter') {
      e.preventDefault();
      submitNameInput();
    }
  });
</script>

<script>
  function runMenu(fn) {
    // ë©”ë‰´ ì ‘ê¸°ëŠ” ë°”ë¡œ, ì‹¤í–‰ì€ ë‹¤ìŒ í‹±ì—
    closeMenus();
    
    // ì¶”ê°€: ë©”ë‰´ë°”ì˜ ëª¨ë“  í™œì„± ìƒíƒœë¥¼ ê°•ì œë¡œ ì œê±°
    $('.menu-bar > li').removeClass('ui-state-active ui-state-hover ui-state-focus ui-state-open');
    $('.menu-bar .menu').hide().attr('aria-hidden', 'true').attr('aria-expanded', 'false');
    $('.menu-bar .ui-state-active').removeClass('ui-state-active');
    
    setTimeout(fn, 0);   // ë˜ëŠ”: requestAnimationFrame(fn)
    
    return false;        // a# href="#" ê¸°ë³¸ ë‚´ë¹„ ë§‰ê¸°
  }
  function setActiveDifficulty(idx) {
  // Update current difficulty level for best times tracking
  if (typeof currentDifficultyLevel !== 'undefined') {
    currentDifficultyLevel = idx;
  }

  const KO = isKorean();

  // ë‚œì´ë„ ë©”ë‰´ ë²ˆí˜¸: Beginner~Custom (menu1~menu14)
  const menuLabelsKO = [
    "ìƒˆ ê²Œì„(N)ã€€ã€€ã€€ã€€ã€€F2", "ì´ˆê¸‰(B)", "ì¤‘ê¸‰(I)", "ê³ ê¸‰(E)", "ì´ˆê³ ê¸‰", "ğŸ˜±", "ğŸ’€", "â˜ ï¸", "â˜ ï¸â˜ ï¸",
    "â˜ ï¸â˜ ï¸â˜ ï¸", "ìŒìˆ˜ì§€ë¢°", "ëŒ€í˜•", "ì´ˆëŒ€í˜•", "íŠ¹ëŒ€í˜•", "ì‚¬ìš©ì ì§€ì •(C)..."
  ];
  const menuLabelsEN = [
    "Newã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€F2", "Beginner", "Intermediate", "Expert", "Ultra", "ğŸ˜±", "ğŸ’€", "â˜ ï¸", "â˜ ï¸â˜ ï¸",
    "â˜ ï¸â˜ ï¸â˜ ï¸", "AntiMine", "Large", "XLarge", "XXLarge", "Custom..."
  ];

  // ë©”ë‰´ í…ìŠ¤íŠ¸ë¥¼ ì „ë¶€ ì´ˆê¸°í™”
  for (let i = 0; i <= 14; i++) {
    const li = document.querySelector(`.menu${i}`);
    if (!li) continue;
    const a = li.querySelector("a");
    if (!a) continue;

    const label = KO ? menuLabelsKO[i] : menuLabelsEN[i];
    // "âœ“"ë¥¼ ì œì™¸í•˜ê³ , ì „ê° ê³µë°± 1ì¹¸ì„ ì•ì— ë¶™ì—¬ì„œ ì •ë ¬ ìœ ì§€
    a.textContent = "ã€€" + label;
  }

  // ì„ íƒí•œ í•­ëª©ì— ì²´í¬ í‘œì‹œ ì¶”ê°€
  const active = document.querySelector(`.menu${idx}`);
  if (active) {
    const a = active.querySelector("a");
    if (a) {
      let label = KO ? menuLabelsKO[idx] : menuLabelsEN[idx];
      a.textContent = "âœ“ " + label;
    }
  }
}
</script>

</body>
</html>
