<!DOCTYPE html>
<html>
<head>
  <title>Minesweeper</title>
  <meta charset="utf-8" />
  <link href="mine.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="win98.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="mine-win98.css" media="screen" rel="stylesheet" type="text/css" />
  <style>
    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
    html, body { overflow-x: auto; }

    .windows { position: relative; overflow: visible; width: max-content; min-width: 100%; }
    .mine-window { position: relative; display: inline-block; }

    /* ì´ì¤‘ ì¹´ìš´í„°ìš© ì»¨í…Œì´ë„ˆ(ì•„ì´ì½˜+ì„¸ê·¸ë¨¼íŠ¸ ë‘ ì¤„) */
    .mine-counters-dual { display: inline-flex; flex-direction: column; gap: 2px; }
    .counter-row { display: flex; align-items: center; gap: 6px; }

    /* ê¹ƒë°œ ì•„ì´ì½˜ (mine.pngëŠ” 160x256 ìŠ¤ì¼€ì¼ ê¸°ì¤€) */
    .counter-icon {
      width: 14px; height: 14px;
      background-image: url(mine.png);
      background-size: 160px 256px;
      image-rendering: pixelated;
      flex: 0 0 14px;
    }
    /* (ê²€ì€ì§€ë¢°ê¹ƒë°œ) ì›ë³¸(288,288~320,320) â†’ ì ˆë°˜ ì¢Œí‘œ(-144px,-144px) */
    .icon-flag-black { background-position: -145px -145px; }
    /* (í•˜ì–€ì§€ë¢°ê¹ƒë°œ) ì›ë³¸(0,288~32,320) â†’ ì ˆë°˜ ì¢Œí‘œ(0,-144px) */
    .icon-flag-white { background-position: -1px -145px; }
    .notice {
    margin: 10px 0 14px;
    padding: 10px 12px;
    border: 1px solid #b5b5b5;
    background: #fcfcfc;
    font-size: 13px;
    line-height: 1.55;
  }
  .notice h3 {
    margin: 0 0 6px;
    font-size: 14px;
  }
  .notice ul { margin: 6px 0 0 18px; padding: 0; }
  .notice li { margin: 2px 0; }
  .notice .warn {
    display: inline-block;
    padding: 0 6px;
    border-radius: 3px;
    background: #fff3cd;
    border: 1px solid #ffe69c;
  }

  /* --- Console ë¯¸ëŸ¬ íŒ¨ë„ --- */
  .console-panel {
    margin: 10px 0 18px;
    border: 1px solid #b5b5b5;
    background: #ffffff;
  }
  .console-panel .console-head {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    background: #f2f2f2;
    border-bottom: 1px solid #d0d0d0;
    font-size: 13px;
  }
  .console-panel .console-head .title { font-weight: 600; margin-right: auto; }
  .console-panel .console-head button,
  .console-panel .console-head label {
    font-size: 12px;
  }
  .console-panel .console-body {
    max-height: 220px;
    overflow: auto;
    background: #ffffff;
    font: 12px/1.5 monospace;
    padding: 8px;
    white-space: pre-wrap;
  }
  .console-line { padding: 1px 0; }
  .console-time { color: #888; }
  .console-lvl-log   { color: #222; }
  .console-lvl-info  { color: #146c94; }
  .console-lvl-warn  { color: #a46c00; }
  .console-lvl-error { color: #b00020; }

  </style>
</head>

<body>
  <div id="hscroll-guard" style="height:1px;width:0;overflow:hidden;"></div>

  <script>
    function updateHScrollGuard() {
      const win = document.querySelector('.mine-window');
      const guard = document.getElementById('hscroll-guard');
      if (win && guard) guard.style.width = (win.offsetWidth + 32) + 'px';
    }
    window.addEventListener('resize', updateHScrollGuard);

    /* ===== ê³µí†µ ìœ í‹¸: ìˆ«ì/í´ë¨í”„/ìƒí•œ ê³„ì‚° ===== */
    function toInt(v, d=0){ v=parseInt(v); return isNaN(v)?d:v; }
    function clamp(v, lo, hi){ return Math.min(hi, Math.max(lo, v)); }

    // capBlackTotal = (cells-1)*maxBlackPerCell
    // capWhiteTotal = capBlackTotal - blackTotal(ìµœì¢…ê°’), ìŒìˆ˜ë©´ 0
function calcCaps(cols, rows, maxBlackPerCell, blackTotalNow, maxWhitePerCell = 0) {
  // 1) ì „ì²´ ì¹¸ìˆ˜ ë° ê²€ì€ì§€ë¢° ì´ ìˆ˜ìš©ëŸ‰
  const C = Math.max(3, cols | 0);
  const R = Math.max(1, rows | 0);
  const cells = C * R;

  const capBlackPerCell = Math.max(1, maxBlackPerCell | 0);
  const capBlackTotal   = Math.max(0, (cells - 1) * capBlackPerCell);

  // 2) ê²€ì€ì§€ë¢°ê°€ ìµœì†Œë¡œ ì ìœ í•´ì•¼ í•˜ëŠ” ì¹¸ ìˆ˜
  const blackUsed = Math.min(Math.max(0, blackTotalNow | 0), capBlackTotal);
  const minBlackCells = Math.ceil(blackUsed / capBlackPerCell);

  // 3) í°ì§€ë¢°ë¥¼ ë„£ì„ ìˆ˜ ìˆëŠ” ì¹¸ ìˆ˜
  const whitePlaceableCells = Math.max(0, (cells - 1) - minBlackCells);

  // 4) ì¹¸ë‹¹ í°ì§€ë¢° ìˆ˜ìš©ëŸ‰ì„ ê³±í•´ ìµœëŒ€ í°ì§€ë¢° ì´ëŸ‰
  const capWhitePerCell = Math.max(0, maxWhitePerCell | 0);
  const capWhiteTotal   = whitePlaceableCells * capWhitePerCell;

  return { capBlackTotal, capWhiteTotal };
}

    // í¼ ì…ë ¥ì— ì‹¤ì‹œê°„ ì ìš©: ìƒí˜¸ ì˜ì¡´ ìƒí•œ ë³´ì •
     function applyFormCaps(){
    const cols = toInt(x.value, 3);
    const rows = toInt(y.value, 1);

    // 1) ì¹¸ë‹¹ ìµœëŒ€ ê²€ì€ì§€ë¢°ìˆ˜ (1~6)
    let maxBlackPerCell = clamp(toInt(m.value, 1), 1, 6);
    m.value = maxBlackPerCell;

    // 2) ì¹¸ë‹¹ ìµœëŒ€ í°ì§€ë¢°ìˆ˜ (0~6)  â† idëŠ” wm ì´ ë§ìŠµë‹ˆë‹¤.
    let maxWhitePerCell = clamp(toInt(wm.value, 0), 0, 6);
    wm.value = maxWhitePerCell;

    // 3) ê²€ì€ ì´ìˆ˜ ë³´ì •
    let k = Math.max(1, toInt(t.value, 1));
    let caps = calcCaps(cols, rows, maxBlackPerCell, k, maxWhitePerCell);
    if (k > caps.capBlackTotal) k = caps.capBlackTotal;
    t.value = k;

    // 4) í° ì´ìˆ˜ ë³´ì • (ê²€ì€ í™•ì •ì¹˜ ì‚¬ìš©)
    caps = calcCaps(cols, rows, maxBlackPerCell, k, maxWhitePerCell);
    let whiteTotal = Math.max(0, toInt(wt.value, 0));
    if (whiteTotal > caps.capWhiteTotal) whiteTotal = caps.capWhiteTotal;
    wt.value = whiteTotal;

    // 5) max íŒíŠ¸ ë™ê¸°í™”
    t.max  = String(caps.capBlackTotal);
    wt.max = String(caps.capWhiteTotal);
  }

    /* ---------- ì‹¤í–‰ í•¨ìˆ˜ (í°ìƒ‰ ì§€ë¢° ì§€ì›) ---------- */
var execute = function(i, j, k, l = 1, whiteTotal = 0, whiteMax = 0, aiLevel = null) {
  // 1) ì…ë ¥ ì •ê·œí™”
  i = Math.max(3,toInt(i, 3)); j = toInt(j, 1); k = toInt(k, 1); l = clamp(toInt(l, 1), 1, 6);
  whiteTotal = Math.max(0, toInt(whiteTotal, 0));
  whiteMax   = clamp(toInt(whiteMax, 0), 0, 6);

  // 1-1) ì§€ëŠ¥í˜• ìƒì„± ìˆ˜ì¤€ í™•ì • (ê¸°ë³¸ê°’ 0)
  if (aiLevel === null || typeof aiLevel === "undefined") {
    aiLevel = toInt(document.getElementById('ai')?.value, 0);
  } else {
    aiLevel = toInt(aiLevel, 0);
  }

      // 2) ìƒí•œ ë³´ì •(ëª¨ë“  ê²½ë¡œì—ì„œ ë™ì¼í•˜ê²Œ ê°•ì œ)
      //    2-1) ê²€ì€ì§€ë¢° ì´ìˆ˜ k ë³´ì •
      let caps = calcCaps(i, j, l, k,whiteMax);
      if (k > caps.capBlackTotal) k = caps.capBlackTotal;

      //    2-2) í°ì§€ë¢° ì´ìˆ˜ whiteTotal ë³´ì • (ê²€ì€ í™•ì •ì¹˜ ì‚¬ìš©)
      caps = calcCaps(i, j, l, k,whiteMax);
      if (whiteTotal > caps.capWhiteTotal) whiteTotal = caps.capWhiteTotal;
  // 3) í¼ ê°’ ë°˜ì˜ + í¼ max íŒíŠ¸ ë°˜ì˜
  x.value  = i; y.value  = j; m.value  = l; t.value  = k;
  wm.value = whiteMax; wt.value = whiteTotal;
  const aiSel = document.getElementById('ai');
  if (aiSel) aiSel.value = String(aiLevel);

      t.max  = String(caps.capBlackTotal);
      wt.max = String(caps.capWhiteTotal);

      /* ë©”ë‰´ í‘œì‹œ ë²”ìœ„ ì¡°ì ˆ */
      const toggleMenu = (sel, show) => show ? $(sel).removeAttr("style") : $(sel).css({"display":"none"});
      toggleMenu(".menu2",  i>=7);
      toggleMenu(".menu3",  i>=10);
      toggleMenu(".menu4",  i>=13);
      toggleMenu(".menu5",  i>=14);
      toggleMenu(".menu6",  i>=16);
      toggleMenu(".menu7",  i>=19);
      toggleMenu(".menu8",  i>=21);
      toggleMenu(".menu9",  i>=23);
      toggleMenu(".menu10", i>=26);
      toggleMenu(".menu11", i>=29);
      toggleMenu(".menu12", i>=32);
      toggleMenu(".menu13", i>=35);

      /* ë³´ë“œ ìƒì„± (mine.jsê°€ 6ì¸ì ì§€ì› ì‹œ ê·¸ëŒ€ë¡œ ì „ë‹¬) */

  if (aiLevel === 2) {
    // ì°ê¸° íŒ¨í„´ ì›ì²œ ì°¨ë‹¨
    minefield.init_board(i, j, k, l, whiteTotal, whiteMax, true);
  } else {
    // ì°ê¸° í—ˆìš©
    minefield.init_board(i, j, k, l, whiteTotal, whiteMax, false);
    if (aiLevel === 1) {
      // ë¬´ì œí•œ êµ¬ì œ
      minefield.bonus_reloc_count = 1000000;
    }
  }
      // â–¼ ë…¸í”½ ëª¨ë“œì¼ ë•Œë§Œ ì½˜ì†” ë¯¸ëŸ¬ í‘œì‹œ
const cp = document.getElementById('console-panel');
if (cp) {
  if (aiLevel === 2) {
    cp.style.display = '';
  } else {
    cp.style.display = 'none';
    // ì„ íƒ: ìˆ¨ê¸¸ ë•Œ ë¡œê·¸ë„ ê¹”ë”í•˜ê²Œ ë¹„ìš°ê¸°
    const bodyEl = document.getElementById('console-body');
    if (bodyEl) bodyEl.textContent = '';
  }
}


      /* ë ˆì´ì•„ì›ƒ: ì´ì¤‘ ì¹´ìš´í„°ë©´ í—¤ë” ë†’ì´/ì°½ ë†’ì´ë¥¼ í‚¤ì›€ */
      const hasWhite = whiteTotal > 0;
      const head = document.querySelector('.window-content .mine-head-area');
      if (head) head.style.height = hasWhite ? '58px' : '38px';

      const extraHead = hasWhite ? 20 : 0; // 58-38
      $(".mine-window").css({ "width": 22 + i*16, "height": (107 + extraHead) + j*16 });
      $(".window-content .mine-head-area ").css({ "width": 2 + i*16 });
      $(".window-content .mine-area").css({ "width": i*16, "height": j*16 });
      $(".inner").css({ "width": i*16, "height": j*16 });
      $(".window-content .mine-head-area .mine-reset-button").css({ "left": -8 + 8*i });
      $(".windows").css({ "height": (112 + extraHead) + j*16 });

      renderCounters(hasWhite);
      update_all_mine_counters();
      updateHScrollGuard();
    };
  </script>

  <div class="windows windows-98" style="height:365px;">
    <div class="window has-menu mine-window">
      <div class="title-bar">
        <div class="title-icon"></div>
        <div class="title">Minesweeper</div>
        <div class="title-button-group">
          <div class="title-button minimize"></div>
          <div class="title-button maximize disabled"></div>
          <div class="title-button close"></div>
        </div>
      </div>

      <ul class="menu-bar">
        <li class="menu1"  onclick="execute(9, 9, 10, 1, 0, 0,2)">ì´ˆê¸‰</li>
        <li class="menu2"  onclick="execute(16, 16, 40, 1, 0, 0,2)">ì¤‘ê¸‰</li>
        <li class="menu3"  onclick="execute(30, 16, 99, 1, 0, 0,2)">ê³ ê¸‰</li>
        <li class="menu4"  onclick="execute(30, 16, 120, 2, 0, 0,2)">ì´ˆê³ ê¸‰</li>
        <li class="menu5"  onclick="execute(30, 16, 160, 3, 0, 0,2)">ğŸ˜±</li>
        <li class="menu6"  onclick="execute(30, 16, 220, 4, 0, 0,2)">ğŸ’€</li>
        <li class="menu7"  onclick="execute(30, 16, 420, 4, 0, 0,0)">â˜ ï¸</li>
        <li class="menu8"  onclick="execute(30, 16, 530, 5, 0, 0,0)">â˜ ï¸â˜ ï¸</li>
        <li class="menu9"  onclick="execute(30, 16, 680, 6, 0, 0,0)">3â˜ ï¸</li>
        <li class="menu10" onclick="execute(30, 16, 70, 1, 30, 1,0)">ìŒìˆ˜ì§€ë¢°</li>
        <li class="menu11" onclick="execute(118, 58, 1412, 1, 0, 0,0)">ëŒ€í˜•</li>
        <li class="menu12" onclick="execute(640, 480, 63300, 1, 0, 0,0)" style="display:none">ì´ˆëŒ€í˜•</li>
        <li class="menu13" onclick="execute(1280, 720, 192000, 1, 0, 0,0)" style="display:none">íŠ¹ëŒ€í˜•</li>
      </ul>

      <div class="window-content">
        <div class="mine-head-area" style="height:38px;">
          <!-- ë‹¨ì¼ ì¹´ìš´í„°(ê¸°ë³¸) : ì ˆëŒ€ë°°ì¹˜ ê·¸ëŒ€ë¡œ ì‚¬ìš© -->
          <div id="counters-single" class="counters-single" style="">
            <div class="mine-counter" id="mine-counter-single">
              <div class="digit digit-0"></div>
              <div class="digit digit-0"></div>
              <div class="digit digit-0"></div>
            </div>
          </div>

          <!-- ì´ì¤‘ ì¹´ìš´í„°: ì»¨í…Œì´ë„ˆë§Œ ì ˆëŒ€ë°°ì¹˜, ë‚´ë¶€ ì¹´ìš´í„°ëŠ” flexë¡œ í­ ìë™ -->
          <div id="counters-dual" class="mine-counters-dual"
               style="display:none; position:absolute; top:4px; left:6px;">
            <div id="counter-row-black" class="counter-row" style="min-height:23px;">
              <div class="counter-icon icon-flag-black" title="ê²€ì€ ì§€ë¢°"></div>
              <div class="mine-counter" id="mine-counter-black"
                   style="position:static; width:auto; height:23px; display:flex;">
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
              </div>
            </div>
            <div id="counter-row-white" class="counter-row" style="min-height:23px;">
              <div class="counter-icon icon-flag-white" title="í•˜ì–€(ìŒìˆ˜) ì§€ë¢°"></div>
              <div class="mine-counter" id="mine-counter-white"
                   style="position:static; width:auto; height:23px; display:flex;">
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
              </div>
            </div>
          </div>

          <div class="mine-reset-button" onclick="minefield.reset_board()">
            <div class="mine-reset-button-inner"></div>
          </div>

          <div class="mine-timer">
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
          </div>
        </div>

        <div id="mine-area" class="mine-area"></div>
      </div>
    </div>
  </div>

  <div id="userctrl" class="userctrl" style="margin:0">
    <form oninput="applyFormCaps()">
      ì£¼ë¬¸ì œì‘:ê°€ë¡œ
      <input type="number" id="x"  min="3" max="9999" step="1" style="width:60px;" value="30">
      ì„¸ë¡œ
      <input type="number" id="y"  min="1" max="9999" step="1" style="width:60px;" value="16">
      1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜
      <input type="number" id="m"  min="1" max="6"    step="1" style="width:60px;" value="1">
      ì „ì²´ ì§€ë¢° ìˆ˜
      <input type="number" id="t"  min="1" step="1"   style="width:80px;" value="99">

      <!-- â–¼ ì¶”ê°€: í•˜ì–€ ì§€ë¢° ì…ë ¥(0 í—ˆìš©) -->
      1ì¹¸ë‹¹ ìµœëŒ€ ìŒìˆ˜ì§€ë¢° ìˆ˜
      <input type="number" id="wm" min="0" max="6" step="1" style="width:60px;" value="0">
      ì „ì²´ ìŒìˆ˜ì§€ë¢° ìˆ˜
      <input type="number" id="wt" min="0" step="1" style="width:80px;" value="0">
      ì§€ëŠ¥í˜• ìƒì„±
      <select id="ai" style="width:220px;" value="2">
        <option value="0">0: ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš© + ìµœì†Œ êµ¬ì œ</option>
        <option value="1">1: ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš© + ë¬´ì œí•œ êµ¬ì œ</option>
        <option value="2" selected>2: ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨ + ìë™ ì§€ë¢° í’€ì´(ë§¤ìš° ëŠë¦¼)</option>
      </select>
      <input type="button"
        onclick="execute(
          document.getElementById('x').value,
          document.getElementById('y').value,
          document.getElementById('t').value,
          document.getElementById('m').value,
          document.getElementById('wt').value,
          document.getElementById('wm').value,
          document.getElementById('ai').value
        )"
        value="ìƒì„±">
      <input type="button" onclick="hideViaURL()" value="ë¬¸êµ¬ ìˆ¨ê¸°ê¸°">
    </form>
  </div>
<div id="heavy-notice" class="notice">
  <h3>ì•ˆë‚´ / ì„±ëŠ¥ ì£¼ì˜</h3>
  <ul>
    <li>ì²« í´ë¦­ ì§í›„ <span class="warn">íŒ ìƒì„±</span>ì— ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì§€ë¢° ìˆ˜â†‘, íŒ í¬ê¸°â†‘ì¼ìˆ˜ë¡ ì¦ê°€)</li>
    <ul>
      <li>ì´ˆëŒ€í˜•ê³¼ íŠ¹ëŒ€í˜• íŒì€ ì´ˆê¸°í™”ì— ì•½ 5~10ì´ˆê°€ ì†Œìš”ë©ë‹ˆë‹¤</li>
    </ul>
    <li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš©ì˜ êµ¬ì œ ê¸°ëŠ¥ ê´€ë ¨</strong>
      <ul>
        <li>ë³µìˆ˜í•´ê°€ ì¡´ì¬í•˜ì—¬ ì°ê¸° ìƒí™©ì´ ë°œìƒí•˜ì˜€ê³ , ì‚¬ìš©ìê°€ ì§€ë¢°ì¹¸ì„ ì„ íƒí–ˆë”ë¼ë„ ì‚¬ìš©ìì˜ ì…ë ¥ì´ ì´ë¯¸ ê³µê°œëœ ì •ë³´ì— ëª¨ìˆœì„ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤ë©´ ê·¸ ì¹¸ì— ì§€ë¢°ê°€ ì—†ë„ë¡ íŒì„ ìˆ˜ì •í•©ë‹ˆë‹¤</li>
        <li>í•˜ì§€ë§Œ ë¬´ì œí•œ êµ¬ì œëŠ” ë‚œì´ë„ë¥¼ ì‹¬ê°í•˜ê²Œ ë‚®ì¶¥ë‹ˆë‹¤</li>
      </ul>
    </li>
    <li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨</strong> ëª¨ë“œ ì„±ëŠ¥ ì£¼ì˜:
      <ul>
        <li>ìŒìˆ˜ì§€ë¢°ê°€ ìˆìœ¼ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤. (ì¤‘ê¸‰ í¬ê¸°ì˜ íŒ ì´ìƒì—ì„œ ë¹„ê¶Œì¥)</li>
        <li>1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜ê°€ 4 ì´ìƒì´ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤.</li>
        <li>ëŒ€í˜• ì´ìƒì˜ í° íŒì—ì„œëŠ” ë§¤ìš° ëŠë¦½ë‹ˆë‹¤.</li>
        <li>í•´ë‹¹ ëª¨ë“œëŠ” â€œì°ê¸° ì—†ëŠ” í’€ì´ ìˆœì„œâ€ë¥¼ í•­ìƒ ë³´ì¥í•˜ë©°, ìë™ í’€ê¸°ì™€ íŒíŠ¸ ì œê³µ ê¸°ëŠ¥ì€ ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      </ul>
    </li>
    
  </ul>
  <div id="console-panel" class="console-panel" style="display:none">
  <div class="console-head">
    <span class="title">ì‹¤ì‹œê°„ ë¡œê·¸ (Console mirror)</span>
    <label><input type="checkbox" id="console-autoscroll" checked> ìë™ ìŠ¤í¬ë¡¤</label>
    <button type="button" id="console-play">ì§€ë¢° ìë™ìœ¼ë¡œ í’€ê¸°</button>
    <button type="button" id="console-hint">íŒíŠ¸ ì œê³µ</button>
    <button type="button" id="console-pause">ì½˜ì†” ì¼ì‹œì •ì§€</button>
    <button type="button" id="console-clear">ì½˜ì†” ë¹„ìš°ê¸°</button>
    <button type="button" id="console-copy">ì½˜ì†” ë‚´ìš© ë³µì‚¬</button>

  </div>
  <div class="console-body" id="console-body" aria-live="polite"></div>
</div>
</div>

  <script src="vendor/jquery.min.js"></script>
  <script src="vendor/jquery-ui.min.js"></script>
  <script src="jquery.mswin.js"></script>
  <script src="jquery.mswin.listview.js"></script>
  <script src="jquery.mswin.menu.js"></script>
  <script src="mine.js"></script>

  <script>
    /* GET íŒŒì„œ */
    function getQueryParams() {
      const p = new URLSearchParams(window.location.search);
      return {
        rows: p.get('rows'),
        cols: p.get('cols'),
        minespercell: p.get('minespercell'),
        mines: p.get('mines'),
        whiteminespercell: p.get('whiteminespercell'),
        whitemines: p.get('whitemines'),
        logic: p.get('logic'),
        hide: p.get('hide'),
      };
    }
    function hasCoreParams(q) {
      return q.rows !== null && q.cols !== null && q.minespercell !== null && q.mines !== null;
    }
    function getQueryDefault0(v){ const n = parseInt(v); return isNaN(n)?0:n; }

    /* í•˜ë‹¨ ì…ë ¥ ìˆ¨ê¸°ê¸° */
    function hideUserInputs() {
      const u = document.getElementById('userctrl');
      if (u) u.style.display = 'none';
      const n = document.getElementById('heavy-notice');
      if (n) n.style.display = 'none';
    }

    /* GET ë¦¬ë‹¤ì´ë ‰íŠ¸(ë³´ë‚´ê¸° ì „ì— ìƒí•œ ë³´ì •) */
    function hideViaURL() {
      let cols = clamp(toInt(x.value,3), 3, 999999);
      let rows = clamp(toInt(y.value,1), 1, 999999);
      let mpc  = clamp(toInt(m.value,1), 1, 6);
      let mines= Math.max(1, toInt(t.value,1));
      let wmpc = clamp(toInt(wm.value,0), 0, 6);
      let wmines = Math.max(0, toInt(wt.value,0));

      // ë³´ì • 1: ê²€ì€ ì´ìˆ˜
      let caps = calcCaps(cols, rows, mpc, mines,wmpc);
      if (mines > caps.capBlackTotal) mines = caps.capBlackTotal;

      // ë³´ì • 2: í° ì´ìˆ˜(ê²€ì€ í™•ì •ì¹˜ ë°˜ì˜)
      caps = calcCaps(cols, rows, mpc, mines,wmpc);
      if (wmines > caps.capWhiteTotal) wmines = caps.capWhiteTotal;

      // í¼ì—ë„ ë°˜ì˜(ì‹œê°ì  í”¼ë“œë°±)
      x.value=cols; y.value=rows; m.value=mpc; t.value=mines;
      wm.value=wmpc; wt.value=wmines;
      t.max  = String(caps.capBlackTotal);
      wt.max = String(caps.capWhiteTotal);

      const u = new URL(window.location.href);
      u.searchParams.set('cols', cols);
      u.searchParams.set('rows', rows);
      u.searchParams.set('minespercell', mpc);
      u.searchParams.set('mines', mines);
      u.searchParams.set('whiteminespercell', wmpc);
      u.searchParams.set('whitemines', wmines);
      // ì§€ëŠ¥í˜• ìƒì„± ìˆ˜ì¤€ í¬í•¨(ê¸°ë³¸ 0)
      let logic = toInt(document.getElementById('ai')?.value, 0);
      u.searchParams.set('logic', logic);
      // ìˆ¨ê¹€ í”Œë˜ê·¸ & ìºì‹œ ë°©ì§€ìš© íƒ€ì„ìŠ¤íƒ¬í”„
      u.searchParams.set('hide', '1');
      u.searchParams.set('ts', String(Date.now()));

      // ë’¤ë¡œê°€ê¸° íˆìŠ¤í† ë¦¬ë¥¼ ë‚¨ê¸°ì§€ ì•Šê³ , ê°•ì œ ìƒˆë¡œê³ ì¹¨ íš¨ê³¼
      window.location.replace(u.pathname + '?' + u.searchParams.toString());
    }

    /* ìœ í‹¸: digit DOM ìˆ˜ ë§ì¶”ê¸° */
    function ensure_digits(counter, count) {
      const cur = counter.children().length;
      if (cur < count) {
        for (let i = 0; i < count - cur; i++) counter.append('<div class="digit digit-0"></div>');
      } else if (cur > count) {
        for (let i = 0; i < cur - count; i++) $(counter.children()[0]).remove();
      }
    }
    /* íƒ€ì´ë¨¸(3ìë¦¬ ê³ ì •) */
    function update_counter_timer(val, counter) {
      if (val > 999) val = 999; if (val < 0) val = 0;
      ensure_digits(counter, 3);
      const digits = [ Math.floor(val/100), Math.floor(val/10)%10, val%10 ];
      for (let i=0;i<3;i++){
        const d = digits[i];
        const child = $(counter.children()[i]);
        child.removeClass(); child.addClass("digit digit-" + d);
      }
    }
    /* ìˆ«ì ì¹´ìš´í„°(ìë¦¿ìˆ˜ ê³ ì • ì§€ì›) */
    function update_counter_generic(val, counter, totalForWidth, fixedDigits) {
      let N = fixedDigits || Math.max(3, String(Math.abs(totalForWidth || val || 0)).length);
      ensure_digits(counter, N);
      const isNeg = val < 0;
      if (isNeg) {
        const slots = N - 1;
        const maxAbs = Math.pow(10, slots) - 1;
        let absVal = Math.abs(val);
        if (absVal > maxAbs) absVal = maxAbs;
        let child = $(counter.children()[0]);
        child.removeClass().addClass("digit digit-10");
        const padded = String(absVal).padStart(slots, "0");
        for (let i = 0; i < slots; i++) {
          const d = padded.charCodeAt(i) - 48;
          child = $(counter.children()[i + 1]);
          child.removeClass().addClass("digit digit-" + d);
        }
      } else {
        const padded = String(val).padStart(N, "0");
        for (let i = 0; i < N; i++) {
          const d = padded.charCodeAt(i) - 48;
          const child = $(counter.children()[i]);
          child.removeClass().addClass("digit digit-" + d);
        }
      }
      counter.css({ width: (N * 13) + "px", display: "flex", whiteSpace: "nowrap", height: "23px" });
    }

    /* ëª¨ë“ˆ ì „í™˜ */
    function renderCounters(hasWhite) {
      const single = document.getElementById('counters-single');
      const dual   = document.getElementById('counters-dual');
      if (!single || !dual) return;
      if (hasWhite) { single.style.display = 'none'; dual.style.display = ''; }
      else          { single.style.display = '';    dual.style.display   = 'none'; }
    }

    /* ëª¨ë“  ì¹´ìš´í„° ê°±ì‹  */
    function update_all_mine_counters() {
      const hasWhite = (minefield.white_total || minefield.num_mines_white || 0) > 0;
      if (hasWhite) {
        const bTotal = (minefield.num_mines || 0);
        const wTotal = (minefield.white_total || minefield.num_mines_white || 0);
        const maxTotalAbs = Math.max(Math.abs(bTotal), Math.abs(wTotal));
        const N = Math.max(3, String(maxTotalAbs).length);
        const blackRemain = bTotal - (minefield.num_flags || 0);
        const whiteRemain = wTotal - (minefield.num_flags_white || 0);
        update_counter_generic(blackRemain, $("#mine-counter-black"), bTotal, N);
        update_counter_generic(whiteRemain, $("#mine-counter-white"), wTotal, N);
      } else {
        const remain = (minefield.num_mines || 0) - (minefield.num_flags || 0);
        update_counter_generic(remain, $("#mine-counter-single"), minefield.num_mines || 0);
      }
    }

    /* ìœˆë„ìš°/ë©”ë‰´ ì´ˆê¸°í™” â€” ìš”ì†Œê°€ ìˆì„ ë•Œë§Œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ */
    if ($('.window').length) $('.window').window();
    if ($('.listview').length) $('.listview').listview();
    if ($('.desktop-listview').length) $('.desktop-listview').listview();
    if ($('.menu-bar').length) $('.menu-bar').menubar();
    if ($('.taskbar ul.start').length) {
      $('.taskbar ul.start').menubar({ position_toplevel: { my: "left bottom", at: "left top" } });
    }

    /* íƒ€ì´ë¨¸ */
    var timer_val = 0, timer_id = null;
    var update_timer = function(){ timer_val += 1; update_counter_timer(timer_val, $(".mine-timer")); };

    /* Minefield ì¸ìŠ¤í„´ìŠ¤ */
    var mine_area = document.getElementById("mine-area");
    var minefield = new window.Minefield(
      mine_area,
      function(status) {
        var smile = $(".mine-reset-button .mine-reset-button-inner");
        var bg = "0 0"; if (status === -1) bg = "-17px 0"; if (status === -2) bg = "-51px 0"; if (status === 2) bg = "-34px 0";
        smile.css({"background-position": bg});

        if (status === 0) timer_id = window.setInterval(update_timer, 1000);
        if (status < 0 || status === 1) {
          window.clearInterval(timer_id);
          if (status === 1) {
            const hasWhite = (minefield.white_total || minefield.num_mines_white || 0) > 0;
            renderCounters(hasWhite);
            const head = document.querySelector('.window-content .mine-head-area');
            if (head) head.style.height = hasWhite ? '58px' : '38px';
            update_all_mine_counters();
            timer_val = 0; timer_id = null; update_counter_timer(0, $(".mine-timer"));
          }
          if (status === -2) update_all_mine_counters();
        }
      },
      function(status) {
  // â˜… ê²Œì„ì´ ëë‚œ ìƒíƒœ(-1: íŒ¨ë°°, -2: í´ë¦¬ì–´)ì—ì„œëŠ” ë®ì–´ì“°ì§€ ì•ŠìŒ
  if (minefield.game_status < 0) return;

  var smile = $(".mine-reset-button .mine-reset-button-inner");

        smile.css({"background-position": (status === 1) ? "-34px 0" : "0 0"});
      }
    );

    /* ê¹ƒë°œ ìš°í´ë¦­ ì‹œ ì¹´ìš´í„° ê°±ì‹  */
    minefield.on_rclick_func = function(){ update_all_mine_counters(); };



    /* GET ì¸ì ìë™ ì ìš© (ë¡œë“œ ì‹œì—ë„ ìƒí•œ ë³´ì • ê°•ì œ) */
    document.addEventListener('DOMContentLoaded', function() {
      const q = getQueryParams();
      if (hasCoreParams(q)) {
        let cols = Math.max(3, toInt(q.cols, 30));
        let rows = toInt(q.rows, 16);
        let mpc  = clamp(toInt(q.minespercell, 1), 1, 6);
        let mines= Math.max(1, toInt(q.mines, 99));
        let wmpc = clamp(getQueryDefault0(q.whiteminespercell), 0, 6);
        let wmines = Math.max(0, getQueryDefault0(q.whitemines));
        let logic = (q.logic !== null) ? clamp(toInt(q.logic, 0), 0, 2) : 0;
        // ë³´ì • 1: ê²€ì€ ì´ìˆ˜
        let caps = calcCaps(cols, rows, mpc, mines,wmpc);
        if (mines > caps.capBlackTotal) mines = caps.capBlackTotal;

        // ë³´ì • 2: í° ì´ìˆ˜
        caps = calcCaps(cols, rows, mpc, mines,wmpc);
        if (wmines > caps.capWhiteTotal) wmines = caps.capWhiteTotal;

        execute(cols, rows, mines, mpc, wmines, wmpc, logic);

        // í¼ê³¼ max íŒíŠ¸ë„ ë™ê¸°í™”
        x.value=cols; y.value=rows; m.value=mpc; t.value=mines;
        wm.value=wmpc; wt.value=wmines;
        t.max  = String(caps.capBlackTotal);
        wt.max = String(caps.capWhiteTotal);
        const aiSel = document.getElementById('ai');
        if (aiSel) aiSel.value = String(logic);
        hideUserInputs();
      }
      else if (q.hide === '1') {
        // í•µì‹¬ íŒŒë¼ë¯¸í„°ê°€ ì—†ë”ë¼ë„, hide=1ì´ë©´ ì„¤ëª…/í¼ì„ ë¬´ì¡°ê±´ ìˆ¨ê¹€
        hideUserInputs();
      }
else execute(30, 16, 99, 1, 0, 0, 2);
    });
/* ===== Console Mirror ===== */
(function setupConsoleMirror(){
  const bodyEl   = document.getElementById('console-body');
const btnPlay  = document.getElementById('console-play');
  const btnPause = document.getElementById('console-pause');
  const btnClear = document.getElementById('console-clear');
  const btnCopy  = document.getElementById('console-copy');
  const cbAuto   = document.getElementById('console-autoscroll');

  if (!bodyEl) return; // ì•ˆì „ê°€ë“œ

  let paused = false;
  function ts() {
    const d = new Date();
    const pad = (n)=> String(n).padStart(2,'0');
    return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}.${String(d.getMilliseconds()).padStart(3,'0')}`;
  }
  function print(level, args) {
    if (paused) return;
    const line = document.createElement('div');
    line.className = `console-line console-lvl-${level}`;
    const t = document.createElement('span');
    t.className = 'console-time';
    t.textContent = `[${ts()}] `;
    line.appendChild(t);

    const content = Array.from(args).map(v => {
      try {
        if (typeof v === 'string') return v;
        return JSON.stringify(v);
      } catch(_) {
        return String(v);
      }
    }).join(' ');
    line.appendChild(document.createTextNode(content));
    bodyEl.appendChild(line);

    if (cbAuto && cbAuto.checked) {
      bodyEl.scrollTop = bodyEl.scrollHeight;
    }
  }

  // ì›ë³¸ ë³´ì¡´
  const orig = {
    log:   console.log.bind(console),
    info:  console.info?.bind(console)  || function(){},
    warn:  console.warn?.bind(console)  || function(){},
    error: console.error?.bind(console) || function(){},
  };

  // í›„í‚¹
  console.log  = function(){ print('log', arguments);  orig.log.apply(console, arguments); };
  console.info = function(){ print('info', arguments); orig.info.apply(console, arguments); };
  console.warn = function(){ print('warn', arguments); orig.warn.apply(console, arguments); };
  console.error= function(){ print('error', arguments);orig.error.apply(console, arguments); };
if (btnPlay) {
   btnPlay.addEventListener('click', function(){
     if (typeof window.minefield?.nopick_debug_macro === 'function') {
       window.minefield.nopick_debug_macro();
     } else {
       console.warn('[macro] nopick_debug_macroê°€ ì—†ìŠµë‹ˆë‹¤. init_mines_nopick ì„±ê³µ í›„ ì‹¤í–‰í•˜ê±°ë‚˜ mine.jsì— ë©”ì„œë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.');
     }
   });
 }
  // ì»¨íŠ¸ë¡¤
  if (btnPause) {
    btnPause.addEventListener('click', function(){
      paused = !paused;
      btnPause.textContent = paused ? 'ì¬ê°œ' : 'ì¼ì‹œì •ì§€';
    });
  }
  if (btnClear) {
    btnClear.addEventListener('click', function(){
      bodyEl.textContent = '';
    });
  }
  if (btnCopy) {
    btnCopy.addEventListener('click', async function(){
      const text = Array.from(bodyEl.querySelectorAll('.console-line'))
        .map(el => el.textContent).join('\n');
      try { await navigator.clipboard.writeText(text); } catch(_) {}
    });
  }

  // ì‹œì‘ ë©”ì‹œì§€
  console.info('[Console mirror started]');
})();

/* ===== Runtime i18n: if not Korean, switch UI texts to English ===== */
(function () {
  function isKorean() {
    var lang = (navigator.language || navigator.userLanguage || "").toLowerCase();
    return lang.startsWith("ko");
  }

  function setText(el, txt) { if (el) el.textContent = txt; }
  function setHTML(el, html){ if (el) el.innerHTML = html; }

  function localizeToEnglish() {
    document.documentElement.setAttribute("lang", "en");

    /* 1) Menu labels */
    const menuText = {
      ".menu1":  "Beginner",
      ".menu2":  "Intermediate",
      ".menu3":  "Expert",
      ".menu4":  "Ultra",
      ".menu5":  "ğŸ˜±",
      ".menu6":  "ğŸ’€",
      ".menu7":  "â˜ ï¸",
      ".menu8":  "â˜ ï¸â˜ ï¸",
      ".menu9":  "3â˜ ï¸",
      ".menu10": "AntiMine",
      ".menu11": "Large",
      ".menu12": "XLarge",
      ".menu13": "XXLarge"
    };
    Object.keys(menuText).forEach(sel => {
      const el = document.querySelector(sel);
      setText(el, menuText[sel]);
    });

    /* 2) Counter icon tooltips */
    const blackIcon = document.querySelector(".icon-flag-black");
    if (blackIcon) blackIcon.setAttribute("title", "Black mine");
    const whiteIcon = document.querySelector(".icon-flag-white");
    if (whiteIcon) whiteIcon.setAttribute("title", "Anti-mine");

    /* 3) Form labels / buttons */
    const form = document.querySelector("#userctrl form");
    if (form) {
      // ë¼ë²¨ì€ ì •ì ì¸ í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì¹˜í™˜
      let html = form.innerHTML;
      html = html.replace("ì£¼ë¬¸ì œì‘:ê°€ë¡œ", "Custom: cols")
                 .replace("ì„¸ë¡œ", "rows")
                 .replace("1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜", "Max mines / cell")
                 .replace("ì „ì²´ ì§€ë¢° ìˆ˜", "Total mines")
                 .replace("1ì¹¸ë‹¹ ìµœëŒ€ ìŒìˆ˜ì§€ë¢° ìˆ˜", "Max anti-mines / cell")
                 .replace("ì „ì²´ ìŒìˆ˜ì§€ë¢° ìˆ˜", "Total anti-mines")
                 .replace("ì§€ëŠ¥í˜• ìƒì„±", "Generation mode")
                 .replace("ìƒì„±", "Create")
                 .replace("ë¬¸êµ¬ ìˆ¨ê¸°ê¸°", "Hide controls");
      form.innerHTML = html;

      // ì…€ë ‰íŠ¸ ì˜µì…˜ë„ ì˜ë¬¸í™”
      const aiSel = document.getElementById('ai');
      if (aiSel) {
        const opt = aiSel.options;
        if (opt[0]) opt[0].text = "0: allow guesses + minimal rescue";
        if (opt[1]) opt[1].text = "1: allow guesses + unlimited rescue";
        if (opt[2]) opt[2].text = "2: strict no-guess + auto-solve (slow)";
      }
    }

    /* 4) Heavy notice(ì œëª©/ë¬¸êµ¬ë§Œ ë¶€ë¶„ ì¹˜í™˜, DOMì€ ë³´ì¡´) */
    const notice = document.getElementById("heavy-notice");
    if (notice) {
      const h3 = notice.querySelector("h3");
      setText(h3, "Notice / Performance Tips");

      // í•œêµ­ì–´ ë¦¬ìŠ¤íŠ¸ í•­ëª©ì„ ì•ˆì „í•˜ê²Œ êµì²´ (ìˆëŠ” ê²½ìš°ì—ë§Œ)
      // ì²« ë²ˆì§¸ í° <ul> ì•ˆì˜ í•œêµ­ì–´ ë¬¸êµ¬ë“¤ì„ ì°¾ì•„ ì˜ì–´ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
      // ì´ë¯¸ ì˜ì–´ë¼ë©´ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤.
      const list = notice.querySelector("ul");
      if (list) {
        let html = list.innerHTML;
        html = html
          .replace(/ì²« í´ë¦­ ì§í›„ .*?ì¦ê°€\)<\/li>/, 'Right after the first click, <span class="warn">board generation</span> may take a while. (More mines & larger boards take longer.)</li>')
          .replace(/ì´ˆëŒ€í˜•ê³¼ íŠ¹ëŒ€í˜• íŒì€ ì´ˆê¸°í™”ì— ì•½ .*?<\/li>/, 'XLarge and XXLarge boards take about 5â€“10 seconds to initialize.</li>')
          .replace(/<li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ í—ˆìš©ì˜ êµ¬ì œ ê¸°ëŠ¥ ê´€ë ¨<\/strong>/, '<li><strong>About the rescue feature when guesses are allowed</strong>')
          .replace(/ë³µìˆ˜í•´ê°€ .*?ìˆ˜ì •í•©ë‹ˆë‹¤<\/li>/, 'If multiple solutions exist and a guess situation occurs, and you click a mine cell without contradicting revealed info, the board will be modified so that there is no mine in that cell.</li>')
          .replace(/í•˜ì§€ë§Œ ë¬´ì œí•œ êµ¬ì œëŠ” ë‚œì´ë„ë¥¼ ì‹¬ê°í•˜ê²Œ ë‚®ì¶¥ë‹ˆë‹¤<\/li>/, 'However, unlimited rescues significantly reduce the difficulty.</li>')
          .replace(/<li><strong>ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨<\/strong> ëª¨ë“œ ì„±ëŠ¥ ì£¼ì˜:/, '<li><strong>Strict no-guess</strong> mode performance caveats:')
          .replace(/ìŒìˆ˜ì§€ë¢°ê°€ ìˆìœ¼ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤.*?<\/li>/, 'Very slow when anti-mines are used (not recommended for â‰¥ Intermediate).</li>')
          .replace(/1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜ê°€ 4 ì´ìƒì´ë©´ ë§¤ìš° ëŠë¦½ë‹ˆë‹¤\.<\/li>/, 'Very slow if max mines per cell â‰¥ 4.</li>')
          .replace(/ëŒ€í˜• ì´ìƒì˜ í° íŒì—ì„œëŠ” ë§¤ìš° ëŠë¦½ë‹ˆë‹¤\.<\/li>/, 'Very slow on large boards (â‰¥ Large).</li>')
          .replace(/í•´ë‹¹ ëª¨ë“œëŠ” â€œì°ê¸° ì—†ëŠ” í’€ì´ ìˆœì„œâ€ë¥¼ í•­ìƒ ë³´ì¥í•˜ë©°, ìë™ í’€ê¸°ì™€ íŒíŠ¸ ì œê³µ ê¸°ëŠ¥ì€ ì°ê¸° íŒ¨í„´ ë°œìƒ ì°¨ë‹¨ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤\.<\/li>/,'This mode guarantees a guess-free solution order, and the auto-solving and hint features are only available in strict no-guess mode.</li>' )


        setHTML(list, html);
      }
    }

    /* 5) Console panel í—¤ë”/ë²„íŠ¼ */
    const cp = document.getElementById("console-panel");
    if (cp) {
      const titleEl = cp.querySelector('.console-head .title');
      const pauseEl = document.getElementById('console-pause');
      const playEl  = document.getElementById('console-play');
      const hintEl  = document.getElementById('console-hint');   // â† ëˆ„ë½ëë˜ ë¶€ë¶„ ì¶”ê°€
      const clearEl = document.getElementById('console-clear');
      const copyEl  = document.getElementById('console-copy');
      const autoLbl = cp.querySelector('.console-head label');

      setText(titleEl, 'Live Log (Console mirror)');
      setText(playEl,  'Solve Minesweeper Automatically');
      setText(hintEl,  'Hint From Log');              // â† â€œíŒíŠ¸ ì œê³µâ€ ë²ˆì—­
      setText(pauseEl, 'Pause Console');
      setText(clearEl, 'Clear Console');
      setText(copyEl,  'Copy Console');
      if (autoLbl) setHTML(autoLbl, '<input type="checkbox" id="console-autoscroll" checked> Auto scroll');

      // ì¼ì‹œì •ì§€ ë²„íŠ¼ í† ê¸€ í…ìŠ¤íŠ¸ë„ ì˜ì–´ë¡œ
      pauseEl?.addEventListener('click', function(){
        const isResume = pauseEl.textContent.includes('Resume');
        pauseEl.textContent = isResume ? 'Pause' : 'Resume';
      });
    }
  }

  if (!isKorean()) {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", localizeToEnglish);
    } else {
      localizeToEnglish();
    }
  }
})();


</script>
<div id="i18n-hint" style="display:none">
  <!-- ì˜ëª» ë§ˆí‚¹í•œ ì¹¸ ì•Œë¦¼ -->
  <span id="i18n-wrong-flag">ì˜ëª» ë§ˆí‚¹í•œ ì¹¸ì´ ìˆìŠµë‹ˆë‹¤: ({x}, {y}). ë¨¼ì € ì´ ì¹¸ì„ ìˆ˜ì •í•˜ì„¸ìš”.</span>
  <span id="i18n-wrong-flag-en">You mis-flagged a cell: ({x}, {y}). Please fix this first.</span>

  <!-- ë…¸í”½ íŒíŠ¸ê°€ ë¶ˆê°€í•œ ê²½ìš° -->
  <span id="i18n-not-nopick">ì´ ê¸°ëŠ¥ì€ â€˜ì°ê¸° ì—†ìŒâ€™ ë³´ë“œì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
  <span id="i18n-not-nopick-en">Hints are available only on a â€œno-pickâ€ board.</span>

  <!-- ë” ì¤„ íŒíŠ¸ê°€ ì—†ì„ ë•Œ -->
  <span id="i18n-no-next">ë” ì´ìƒ ì œê³µí•  íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
  <span id="i18n-no-next-en">No further hints.</span>

  <!-- ë‹¤ìŒ ì•¡ì…˜ ì•ˆë‚´(ì—´ê¸°/ê¹ƒë°œ) -->
  <span id="i18n-next-open">ë‹¤ìŒìœ¼ë¡œ ì—´ì–´ì•¼ í•˜ëŠ” ì•ˆì „í•œ ì¹¸: ({x}, {y}). ê·¼ê±°: {reason}</span>
  <span id="i18n-next-open-en">Next safe cell to open: ({x}, {y}). Rationale: {reason}</span>

  <span id="i18n-next-flag-black">ë‹¤ìŒ ìœ„ì¹˜ì— ì§€ë¢° ê¹ƒë°œ {n}ê°œ: ({x}, {y}). ê·¼ê±°: {reason}</span>
  <span id="i18n-next-flag-black-en">Place {n} mine flag(s) at ({x}, {y}). Rationale: {reason}</span>

  <span id="i18n-next-flag-white">ë‹¤ìŒ ìœ„ì¹˜ì— ìŒìˆ˜ ì§€ë¢° ê¹ƒë°œ {n}ê°œ: ({x}, {y}). ê·¼ê±°: {reason}</span>
  <span id="i18n-next-flag-white-en">Place {n} anti-mine flag(s) at ({x}, {y}). Rationale: {reason}</span>

  <span id="i18n-dead">ì´ë¯¸ ì£½ì—ˆìŠµë‹ˆë‹¤</span>
<span id="i18n-dead-en">Already dead</span>
</div>
<script>
(function(){
  // ê°„ë‹¨ i18n í—¬í¼
  function isKorean() {
    var lang = (navigator.language || navigator.userLanguage || "").toLowerCase();
    return lang.startsWith("ko");
  }
  function i18nPick(idKo, idEn) {
    var root = document.getElementById('i18n-hint');
    if (!root) return '';
    var el = document.getElementById(isKorean() ? idKo : idEn);
    return el ? (el.textContent || el.innerText || '') : '';
  }
  function fill(tpl, map) {
    return tpl.replace(/\{(\w+)\}/g, (_, k) => (map[k] != null ? String(map[k]) : ''));
  }

  // ì¢Œí‘œë¥¼ í™”ë©´ìš©ìœ¼ë¡œ 1-baseë¡œ ë³´ì—¬ì£¼ê³  ì‹¶ë‹¤ë©´ +1 (ì—¬ê¸°ì„  0-base ìœ ì§€)
  function showAlertWrongFlag(x, y) {
    const msg = fill(i18nPick('i18n-wrong-flag', 'i18n-wrong-flag-en'), {x, y});
    alert(msg);
  }
  function showAlertNextOpen(x, y, reason) {
    const msg = fill(i18nPick('i18n-next-open', 'i18n-next-open-en'), {x, y, reason});
    alert(msg);
  }
  function showAlertNextFlag(x, y, n, isWhite, reason) {
    const idKo = isWhite ? 'i18n-next-flag-white' : 'i18n-next-flag-black';
    const idEn = isWhite ? 'i18n-next-flag-white-en' : 'i18n-next-flag-black-en';
    const msg = fill(i18nPick(idKo, idEn), {x, y, n, reason});
    alert(msg);
  }
  function alertNotNoPick(){ alert(i18nPick('i18n-not-nopick','i18n-not-nopick-en')); }
  function alertNoNext(){ alert(i18nPick('i18n-no-next','i18n-no-next-en')); }

  // ì•¡ì…˜ ì ìš© ìœ í‹¸
  function ensureFlagToTarget(self, x, y, target) {
    // target: ì •ë‹µ ë¶€í˜¸/ê°œìˆ˜ (ì–‘ìˆ˜=ê²€ì€ n, ìŒìˆ˜=í•˜ì–€ n)
    // í˜„ì¬ ê¹ƒë°œ ìƒíƒœ(self.flags[x][y])ë¥¼ targetì— "ì¦‰ì‹œ" ë§ì¶¥ë‹ˆë‹¤.
    if (!self || typeof self.on_rclick !== 'function') return false;

    const cur = self.flags[x][y] || 0;
    if (cur === target) return false; // ë³€í™” ì—†ìŒ

    // flag()ì˜ ì‚¬ì´í´ì„ ëª¨ë¥´ëŠ” ì‚¬ìš©ìê°€ ìš°í´ë¦­ në²ˆ í•´ì•¼ í•˜ëŠ” ì¼ì„ í•¨ìˆ˜ë¡œ ëŒ€ì²´
    // 1) ë¨¼ì € nullë¡œ ë§Œë“¤ê¸°
    self.set_class(x, y, null);
    self.flags[x][y] = 0;

    // 2) ëª©í‘œê¹Œì§€ ìš°í´ë¦­ì„ ì‹œë®¬ë ˆì´íŠ¸
    // flag()ëŠ” nullâ†’ê²€1â†’â€¦â†’ê²€maxâ†’(í° ì§€ì› ì‹œ)í°1â†’â€¦â†’í°maxâ†’?â†’null ìˆœí™˜
    // ì—¬ê¸°ì„œëŠ” ë°”ë¡œ ëª©í‘œê°’ì— ì„¸íŒ…(ë‚´ë¶€ ìƒíƒœ, ì¹´ìš´í„°, near_flags ê°±ì‹  í¬í•¨) í•˜ê² ìŠµë‹ˆë‹¤.
    // near_flagsë¥¼ ì •í™•íˆ ë°˜ì˜í•˜ë ¤ë©´ ê¸°ì¡´ flag ë¡œì§ê³¼ ë™ì¼í•œ near_flags ê°±ì‹ ì´ í•„ìš”
    // â†’ ê°„ë‹¨í•˜ê²Œ: í˜„ì¬ ì¹¸ì„ '?'ë¡œ ë‘ê³ , ëª©í‘œê°’ë§Œí¼ on_rclickì„ ë°˜ë³µ í˜¸ì¶œí•´ ë™ì¼ ê²½ë¡œë¡œ ë„ë‹¬

    // ë¨¼ì € '?'ë¡œ
    self.set_class(x, y, "flag-0");

    // ì•ˆì „í•˜ê²Œ ë£¨í”„(ìµœëŒ€ 20íšŒ)ë¡œ ëª©í‘œê¹Œì§€ ì§„í–‰
    let guard = 20;
    while ((self.flags[x][y] || 0) !== target && guard-- > 0) {
      self.on_rclick(x, y);
    }
    return true;
  }

  function applyOpen(self, x, y) {
    if (!self || typeof self.on_click !== 'function') return false;
    if (self.is_opened(x, y)) return false;
    self.on_click(x, y);
    return true;
  }

  // === ë©”ì¸: íŒíŠ¸ ì œê³µ ===
  window.provide_nopick_hint = function() {
    // minefield ì „ì—­ ì‚¬ìš©(í˜ì´ì§€ì—ì„œ ì´ë¯¸ ìƒì„±ë¨)
    var self = window.minefield;
    if (!self || !self.use_nopick || !Array.isArray(self._nopick_trace) || self._nopick_trace.length === 0) {
      alertNotNoPick();
      return;
    }

    const W = self.columns|0, H = self.rows|0;

    // 0) ì‚¬ìš©ìê°€ 'ì˜ëª» ë§ˆí‚¹í•œ' ì¹¸(ê¹ƒë°œê°’ != ì •ë‹µ)ì„ ì°¾ëŠ”ë‹¤
    const wrong = [];
    for (let y=0; y<H; y++) for (let x=0; x<W; x++) {
      const f = self.flags[x][y] || 0;          // ì‚¬ìš©ìê°€ ê½‚ì€ ê¹ƒë°œ(ë¶€í˜¸/ê°œìˆ˜)
      if (f === 0) continue;                    // ê¹ƒë°œ ì—†ìŒ
      const ans = self.mines[x][y] | 0;         // ì‹¤ì œ ì •ë‹µ
      if (f !== ans) wrong.push([x,y]);
    }
    if (wrong.length > 0) {
      const pick = wrong[(Math.random()*wrong.length)|0];
      showAlertWrongFlag(pick[0], pick[1]);
      return;
    }

    // 1) ì‚¬ìš©ìê°€ í˜„ì¬ 'ì—´ì—ˆê±°ë‚˜ ë§ˆí‚¹í•œ' ì¹¸ íŒŒì•…ì€ self APIë¡œ ì¶©ë¶„ (is_opened / flags)
    // 2) nopick_traceë¥¼ ì•ì—ì„œë¶€í„° ë³´ë©°, ì‚¬ìš©ìê°€ ê·¸ ì•¡ì…˜ì„ ìˆ˜í–‰í–ˆëŠ”ì§€ ëŒ€ì¡°
    const trace = self._nopick_trace;
    let pos = 0;
    function actionDone(t) {
      if (!t) return true;
      if (t.kind === 'open') {
        return self.is_opened(t.x, t.y);
      } else if (t.kind === 'markMine') {
        // ì •ë‹µ ê¸°ì¤€ìœ¼ë¡œ ëª©í‘œ ê¹ƒë°œ(ë¶€í˜¸/ê°œìˆ˜) ë„ë‹¬?
        const want = self.mines[t.x][t.y] | 0;
        if (want === 0) return true; // ì´ë¡ ìƒ markMineì´ 0ì„ ê°€ë¦¬í‚¤ì§„ ì•Šê² ì§€ë§Œ ë°©ì–´
        return (self.flags[t.x][t.y] || 0) === want;
      }
      // íŒíŠ¸ ê´€ì ì—ì„œ open/markMineë§Œ ì˜ë¯¸. ë‹¤ë¥¸ ë¡œê·¸ëŠ” 'ìˆ˜í–‰í•œ ê²ƒìœ¼ë¡œ' ê°„ì£¼
      return true;
    }
    while (pos < trace.length && actionDone(trace[pos])) pos++;

    if (pos >= trace.length) {
      // ë” ì´ìƒ ì§„í–‰í•  ìŠ¤í…ì´ ì—†ìŒ
      alertNoNext();
      return;
    }

    // 3) ë‹¤ìŒ ìŠ¤í… ìˆ˜í–‰ + ê·¼ê±° alert
    const t = trace[pos];
    // ê·¼ê±°(reason) ì •ë¦¬(ì—†ì„ ìˆ˜ë„ ìˆìŒ)
    const reason = (t && t.reason) ? String(t.reason) :
                   (t && t.kind === 'flood') ? 'ì¸ì ‘ ì¹¸ ìë™ ê³µê°œ' :
                   (t && t.kind) ? ('rule ' + t.kind) : 'auto';

    if (t.kind === 'open') {
      if (applyOpen(self, t.x, t.y)) {
        showAlertNextOpen(t.x, t.y, reason);
        return;
      } else {
        // ì—´ê¸° ì‹¤íŒ¨(ì´ë¯¸ ì—´ë¦¼ ë“±)ë©´ ë‹¤ìŒ ìœ íš¨í•œ ì•¡ì…˜ì„ ì°¾ì•„ í•œ ë²ˆ ë” ì‹œë„
        let moved = false;
        for (let i = pos+1; i < trace.length; i++) {
          const tt = trace[i];
          if (tt.kind === 'open' && applyOpen(self, tt.x, tt.y)) {
            showAlertNextOpen(tt.x, tt.y, (tt.reason||reason));
            moved = true; break;
          }
          if (tt.kind === 'markMine') {
            const want = self.mines[tt.x][tt.y] | 0;
            if (want !== 0 && ensureFlagToTarget(self, tt.x, tt.y, want)) {
              showAlertNextFlag(tt.x, tt.y, Math.abs(want), want<0, (tt.reason||reason));
              moved = true; break;
            }
          }
        }
        if (!moved) alertNoNext();
        return;
      }
    } else if (t.kind === 'markMine') {
      const want = self.mines[t.x][t.y] | 0;
      if (want !== 0 && ensureFlagToTarget(self, t.x, t.y, want)) {
        showAlertNextFlag(t.x, t.y, Math.abs(want), want<0, reason);
        return;
      } else {
        // ë‹¤ìŒ ìœ íš¨ ì•¡ì…˜ íƒìƒ‰
        let moved = false;
        for (let i = pos+1; i < trace.length; i++) {
          const tt = trace[i];
          if (tt.kind === 'open' && applyOpen(self, tt.x, tt.y)) {
            showAlertNextOpen(tt.x, tt.y, (tt.reason||reason));
            moved = true; break;
          }
          if (tt.kind === 'markMine') {
            const w2 = self.mines[tt.x][tt.y] | 0;
            if (w2 !== 0 && ensureFlagToTarget(self, tt.x, tt.y, w2)) {
              showAlertNextFlag(tt.x, tt.y, Math.abs(w2), w2<0, (tt.reason||reason));
              moved = true; break;
            }
          }
        }
        if (!moved) alertNoNext();
        return;
      }
    } else {
      // ë¡œê·¸ê°€ rule, subset ë“±ì´ë¼ë©´ ë‹¤ìŒ actionable(open/markMine)ë¡œ ê±´ë„ˆë›°ê¸°
      let moved = false;
      for (let i = pos+1; i < trace.length; i++) {
        const tt = trace[i];
        if (tt.kind === 'open' && applyOpen(self, tt.x, tt.y)) {
          showAlertNextOpen(tt.x, tt.y, (tt.reason||reason));
          moved = true; break;
        }
        if (tt.kind === 'markMine') {
          const w2 = self.mines[tt.x][tt.y] | 0;
          if (w2 !== 0 && ensureFlagToTarget(self, tt.x, tt.y, w2)) {
            showAlertNextFlag(tt.x, tt.y, Math.abs(w2), w2<0, (tt.reason||reason));
            moved = true; break;
          }
        }
      }
      if (!moved) alertNoNext();
      return;
    }
  };

  // ë²„íŠ¼ ì—°ê²°
  document.addEventListener('DOMContentLoaded', function(){
    const btn = document.getElementById('console-hint');
    if (btn) btn.addEventListener('click', function(){
      try { window.provide_nopick_hint(); } catch(e){ console.error(e); }
    });
  });
})();
(function(){
  /* ===== ê³µí†µ: ë³´ë“œ UID ====
     - init_mines_nopickê°€ ì„±ê³µí•  ë•Œ mine.jsì—ì„œ this._nopick_traceë¥¼ ì±„ì›Œë‘ .
     - ì—¬ê¸°ì„œëŠ” ë³´ë“œê°€ ë°”ë€Œì—ˆëŠ”ì§€ ê°ì§€í•˜ê¸° ìœ„í•´ UIDë¥¼ ë§Œë“¤ì–´ ë‘ê³ ,
       ìë™ì¬ìƒ ì‹œì‘ ì‹œì ì˜ UIDì™€ ë§¤ í‹±ë§ˆë‹¤ ë¹„êµí•´ íŒ êµì²´ë¥¼ ê°ì§€í•©ë‹ˆë‹¤. */
  const _orig_init_nopick = window.Minefield?.prototype?.init_mines_nopick;
  if (_orig_init_nopick && !window.Minefield.prototype._uid_wrapped_for_macro) {
    window.Minefield.prototype._uid_wrapped_for_macro = true;
    window.Minefield.prototype.init_mines_nopick = function(firstX, firstY){
      const r = _orig_init_nopick.call(this, firstX, firstY);
      // ì„±ê³µ(1) ì‹œì—ë§Œ UID ê°±ì‹ 
      if (r === 1) {
        this._nopick_board_uid = (this._nopick_board_uid || 0) + 1;
      }
      return r;
    };
  }

  /* ===== íŒíŠ¸: ì£½ì—ˆìœ¼ë©´ you already dead ===== */
  const _orig_provide_hint = window.provide_nopick_hint;
  window.provide_nopick_hint = function(){
    const mf = window.minefield;
    if (!mf) return;
    if (mf.game_status === -1) { // íŒ¨ë°°ë§Œ ì°¨ë‹¨ (ìš”ì²­ì‚¬í•­)
      alert('ì´ë¯¸ ì£½ì—ˆìŒ');
      return;
    }
    // ì›ë³¸ íŒíŠ¸ ì‹¤í–‰
    return _orig_provide_hint?.apply(this, arguments);
  };

  /* ===== ìë™ ì¬ìƒ ë§¤í¬ë¡œ: ê°€ë“œ + 0.3s ê°„ê²© + ê°€ì‹œ ì•¡ì…˜ë§Œ ===== */
  function _visibleOpen(mf, x, y){
    if (mf.is_opened(x,y)) return false;
    mf.on_click(x,y);
    return true;
  }
  function _visibleFlagToAnswer(mf, x, y){
    const want = mf.mines[x][y] | 0; // ì •ë‹µ(ì–‘=ê²€, ìŒ=í°, ê°œìˆ˜=ì ˆëŒ“ê°’)
    if (want === 0) return false;
    if ((mf.flags[x][y]||0) === want) return false; // ì´ë¯¸ ì •ë‹µê°’
    // ê¸°ì¡´ flag ì‚¬ì´í´ì„ ê·¸ëŒ€ë¡œ íƒœì›Œì„œ near_flags/ì¹´ìš´í„° ì •í•© ë³´ì¡´
    // nullë¶€í„° ì‹œì‘í•´ ëª©í‘œê°’ê¹Œì§€ on_rclick ë°˜ë³µ
    mf.set_class(x, y, "flag-0");
    let guard = 24;
    while((mf.flags[x][y]||0)!==want && guard-- > 0){
      mf.on_rclick(x,y);
    }
    return true;
  }
  function _nextActionFromTrace(mf){
    const tr = mf._nopick_trace || [];
    if (!tr.length) return null;
    // traceì—ì„œ í˜„ì¬ ìƒíƒœê¹Œì§€ ìˆ˜í–‰ëœ ë¶€ë¶„ì„ ê±´ë„ˆë›°ê³ 
    let i = 0;
    const done = (t)=>{
      if (!t) return true;
      if (t.kind === 'open')     return mf.is_opened(t.x, t.y);
      if (t.kind === 'markMine') return ((mf.flags[t.x][t.y]||0) === (mf.mines[t.x][t.y]|0));
      return true; // ê°€ì‹œ ì•¡ì…˜ì´ ì•„ë‹ˆë©´ ìˆ˜í–‰ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
    };
    while (i<tr.length && done(tr[i])) i++;
    // ì´í›„ë¶€í„° 'ê°€ì‹œì  ì•¡ì…˜'ë§Œ ì°¾ì•„ ë°˜í™˜
    for (; i<tr.length; i++){
      const t = tr[i];
      if (t.kind === 'open' || t.kind === 'markMine') return t;
    }
    return null;
  }

  window.Minefield.prototype.nopick_debug_macro = function(){
    const mf = this;
    // ì‹œì‘ ê°€ë“œ
    if (!mf.use_nopick || !Array.isArray(mf._nopick_trace) || !mf._nopick_trace.length) {
      console.warn('[macro] no-pick trace unavailable.');
      return;
    }
    if (mf.game_status === -1) { // ì£½ì€ íŒì€ ì‹œì‘ ê¸ˆì§€
      alert('ì´ë¯¸ ì£½ì—ˆìŒ');
      return;
    }
    // ì´ë¯¸ ëŒê³  ìˆìœ¼ë©´ ì¬ì‹œì‘ ì „ ì •ë¦¬
    if (mf._macro_timer) {
      clearInterval(mf._macro_timer);
      mf._macro_timer = null;
    }
    // ì´ ë§¤í¬ë¡œê°€ ì‹œì‘ëœ ë³´ë“œì˜ UIDë¥¼ ê¸°ì–µ
    const startUID = mf._nopick_board_uid || 0;
    mf._macro_running = true;

    mf._macro_timer = setInterval(function tick(){
      // ë³´ë“œ ë°”ë€œ/ì£½ìŒ/í´ë¦¬ì–´ ê°ì§€
      if (!mf._macro_running ||
          (mf._nopick_board_uid||0) !== startUID ||
          mf.game_status === -1) {
        clearInterval(mf._macro_timer);
        mf._macro_timer = null;
        mf._macro_running = false;
        if (mf.game_status === -1) {
          console.warn('already dead');
        } else if ((mf._nopick_board_uid||0) !== startUID) {
          console.info('[macro] stopped: board changed.');
        }
        return;
      }

      // ë‹¤ìŒ ê°€ì‹œì  ì•¡ì…˜ í•˜ë‚˜ë§Œ ìˆ˜í–‰
      const step = _nextActionFromTrace(mf);
      if (!step) {
        // ë” í•  ê²Œ ì—†ìœ¼ë©´ ì¢…ë£Œ
        clearInterval(mf._macro_timer);
        mf._macro_timer = null;
        mf._macro_running = false;
        console.info('[macro] finished');
        return;
      }

      let acted = false;
      if (step.kind === 'open') {
        acted = _visibleOpen(mf, step.x, step.y);
      } else if (step.kind === 'markMine') {
        acted = _visibleFlagToAnswer(mf, step.x, step.y);
      }

      // ê°€ì‹œ ì•¡ì…˜ì´ ë¶ˆë°œ(ì´ë¯¸ ì—´ë¦¼/ì´ë¯¸ ì •ë‹µ ê¹ƒë°œ)í•˜ë©´,
      // trace ë‹¤ìŒ ê°€ì‹œ ì•¡ì…˜ì„ ì¦‰ì‹œ ì°¾ì•„ 1íšŒ ë” ì‹œë„í•´
      // "ë§¤ í‹± í•˜ë‚˜ëŠ” ë³´ì´ê²Œ" ë³´ì¥.
      if (!acted) {
        const tr = mf._nopick_trace || [];
        // í˜„ì¬ step ë‹¤ìŒë¶€í„° ì¬íƒìƒ‰
        const idx = tr.indexOf(step);
        for (let i = Math.max(0, idx+1); i<tr.length; i++){
          const t = tr[i];
          if (t.kind === 'open')   { acted = _visibleOpen(mf, t.x, t.y); if (acted) break; }
          if (t.kind === 'markMine'){ acted = _visibleFlagToAnswer(mf, t.x, t.y); if (acted) break; }
        }
      }

      // ì—¬ì „íˆ ëª» í–ˆë‹¤ë©´(ì˜ˆ: ëª¨ë‘ ì´ë¯¸ ë°˜ì˜ë¨) ë‹¤ìŒ í‹±ì—ì„œ ë‹¤ì‹œ ì‹œë„
      // ì´ ê²½ìš°ë¼ë„ ë‹¤ìŒ í‹±ì—ëŠ” ë‹¤ë¥¸ ìŠ¤í…ì´ ë°œê²¬ë  ê°€ëŠ¥ì„±ì´ í¼.
    }, 300); // 0.3ì´ˆ ê°„ê²©
  };

  /* ===== í”Œë ˆì´ ë²„íŠ¼: ì´ë¯¸ ì •ì˜ëœ í•¸ë“¤ëŸ¬ëŠ” ê·¸ëŒ€ë¡œ, ë§¤í¬ë¡œ ë‚´ë¶€ ê°€ë“œê°€ ë§‰ì•„ì¤Œ ===== */
})();
(function(){
  // i18n helper (í˜ì´ì§€ì— ì´ë¯¸ ìˆìŒ)ê³¼ ë™ì¼ ê·œì¹™ ì‚¬ìš©
  function isKorean() {
    var lang = (navigator.language || navigator.userLanguage || "").toLowerCase();
    return lang.startsWith("ko");
  }
  function i18nPick(idKo, idEn) {
    var root = document.getElementById('i18n-hint');
    if (!root) return '';
    var el = document.getElementById(isKorean() ? idKo : idEn);
    return el ? (el.textContent || el.innerText || '') : '';
  }
  function deadMsg(){ return i18nPick('i18n-dead','i18n-dead-en') || 'you already dead'; }

  /* --- íŒíŠ¸ ì˜¤ë²„ë¼ì´ë“œ: ì£½ì€ íŒì´ë©´ ë²ˆì—­ëœ ê²½ê³  --- */
  if (typeof window.provide_nopick_hint === 'function') {
    const _orig = window.provide_nopick_hint;
    window.provide_nopick_hint = function(){
      const mf = window.minefield;
      if (mf && mf.game_status === -1) {
        const msg = deadMsg();
        console.warn(msg);
        alert(msg);
        return;
      }
      return _orig.apply(this, arguments);
    };
  }

  /* --- ìë™ì¬ìƒ: ì‹œì‘/ì§„í–‰ ê°€ë“œë„ ë²ˆì—­ ê²½ê³  ì‚¬ìš© --- */
  if (window.Minefield && window.Minefield.prototype && typeof window.Minefield.prototype.nopick_debug_macro === 'function') {
    const _origMacro = window.Minefield.prototype.nopick_debug_macro;
    window.Minefield.prototype.nopick_debug_macro = function(){
      if (this.game_status === -1) {
        const msg = deadMsg();
        console.warn(msg);
        alert(msg);
        return;
      }
      // ì‹¤í–‰ ì¤‘ì—ë„ ì£½ê±°ë‚˜ ë³´ë“œ ë°”ë€Œë©´ ë©ˆì¶œ ë•Œ ì½˜ì†” ë©”ì‹œì§€ ì¼ê´€í™”
      const _self = this;
      const oldSetInterval = window.setInterval;
      const oldClearInterval = window.clearInterval;
      const TIMER_KEY = '_macro_timer';

      // í•œ ë²ˆë§Œ ë˜í•‘: ë‚´ë¶€ tickì—ì„œ ë©ˆì¶œ ë•Œ ë©”ì‹œì§€ í†µì¼
      if (!_self._macro_stop_hooked) {
        _self._macro_stop_hooked = true;
        const stopIfNeeded = function(){
          if (_self.game_status === -1) {
            console.warn(deadMsg());
          }
        };
        const _origClear = function(id){ oldClearInterval(id); stopIfNeeded(); };
        window.clearInterval = function(id){
          // ìš°ë¦¬ê°€ ë§Œë“  íƒ€ì´ë¨¸ë§Œ í›„í‚¹
          if (id === _self[TIMER_KEY]) { _origClear(id); }
          else { oldClearInterval(id); }
        };
      }
      return _origMacro.apply(this, arguments);
    };
  }
})();
</script>

</body>
</html>
