<!DOCTYPE html>
<html>
<head>
  <title>Minesweeper</title>
  <meta charset="utf-8" />
  <link href="mine.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="win98.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="mine-win98.css" media="screen" rel="stylesheet" type="text/css" />
  <style>
    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
    html, body { overflow-x: auto; }

    .windows { position: relative; overflow: visible; width: max-content; min-width: 100%; }
    .mine-window { position: relative; display: inline-block; }

    /* ì´ì¤‘ ì¹´ìš´í„°ìš© ì»¨í…Œì´ë„ˆ(ì•„ì´ì½˜+ì„¸ê·¸ë¨¼íŠ¸ ë‘ ì¤„) */
    .mine-counters-dual { display: inline-flex; flex-direction: column; gap: 2px; }
    .counter-row { display: flex; align-items: center; gap: 6px; }

    /* ê¹ƒë°œ ì•„ì´ì½˜ (mine.pngëŠ” 160x256 ìŠ¤ì¼€ì¼ ê¸°ì¤€) */
    .counter-icon {
      width: 14px; height: 14px;
      background-image: url(mine.png);
      background-size: 160px 256px;
      image-rendering: pixelated;
      flex: 0 0 14px;
    }
    /* (ê²€ì€ì§€ë¢°ê¹ƒë°œ) ì›ë³¸(288,288~320,320) â†’ ì ˆë°˜ ì¢Œí‘œ(-144px,-144px) */
    .icon-flag-black { background-position: -145px -145px; }
    /* (í•˜ì–€ì§€ë¢°ê¹ƒë°œ) ì›ë³¸(0,288~32,320) â†’ ì ˆë°˜ ì¢Œí‘œ(0,-144px) */
    .icon-flag-white { background-position: -1px -145px; }
  </style>
</head>

<body>
  <div id="hscroll-guard" style="height:1px;width:0;overflow:hidden;"></div>

  <script>
    function updateHScrollGuard() {
      const win = document.querySelector('.mine-window');
      const guard = document.getElementById('hscroll-guard');
      if (win && guard) guard.style.width = (win.offsetWidth + 32) + 'px';
    }
    window.addEventListener('resize', updateHScrollGuard);

    /* ===== ê³µí†µ ìœ í‹¸: ìˆ«ì/í´ë¨í”„/ìƒí•œ ê³„ì‚° ===== */
    function toInt(v, d=0){ v=parseInt(v); return isNaN(v)?d:v; }
    function clamp(v, lo, hi){ return Math.min(hi, Math.max(lo, v)); }

    // capBlackTotal = (cells-1)*maxBlackPerCell
    // capWhiteTotal = capBlackTotal - blackTotal(ìµœì¢…ê°’), ìŒìˆ˜ë©´ 0
function calcCaps(cols, rows, maxBlackPerCell, blackTotalNow, maxWhitePerCell = 0) {
  // 1) ì „ì²´ ì¹¸ìˆ˜ ë° ê²€ì€ì§€ë¢° ì´ ìˆ˜ìš©ëŸ‰
  const C = Math.max(3, cols | 0);
  const R = Math.max(1, rows | 0);
  const cells = C * R;

  const capBlackPerCell = Math.max(1, maxBlackPerCell | 0);
  const capBlackTotal   = Math.max(0, (cells - 1) * capBlackPerCell);

  // 2) ê²€ì€ì§€ë¢°ê°€ ìµœì†Œë¡œ ì ìœ í•´ì•¼ í•˜ëŠ” ì¹¸ ìˆ˜
  const blackUsed = Math.min(Math.max(0, blackTotalNow | 0), capBlackTotal);
  const minBlackCells = Math.ceil(blackUsed / capBlackPerCell);

  // 3) í°ì§€ë¢°ë¥¼ ë„£ì„ ìˆ˜ ìˆëŠ” ì¹¸ ìˆ˜
  const whitePlaceableCells = Math.max(0, (cells - 1) - minBlackCells);

  // 4) ì¹¸ë‹¹ í°ì§€ë¢° ìˆ˜ìš©ëŸ‰ì„ ê³±í•´ ìµœëŒ€ í°ì§€ë¢° ì´ëŸ‰
  const capWhitePerCell = Math.max(0, maxWhitePerCell | 0);
  const capWhiteTotal   = whitePlaceableCells * capWhitePerCell;

  return { capBlackTotal, capWhiteTotal };
}

    // í¼ ì…ë ¥ì— ì‹¤ì‹œê°„ ì ìš©: ìƒí˜¸ ì˜ì¡´ ìƒí•œ ë³´ì •
     function applyFormCaps(){
    const cols = toInt(x.value, 3);
    const rows = toInt(y.value, 1);

    // 1) ì¹¸ë‹¹ ìµœëŒ€ ê²€ì€ì§€ë¢°ìˆ˜ (1~6)
    let maxBlackPerCell = clamp(toInt(m.value, 1), 1, 6);
    m.value = maxBlackPerCell;

    // 2) ì¹¸ë‹¹ ìµœëŒ€ í°ì§€ë¢°ìˆ˜ (0~6)  â† idëŠ” wm ì´ ë§ìŠµë‹ˆë‹¤.
    let maxWhitePerCell = clamp(toInt(wm.value, 0), 0, 6);
    wm.value = maxWhitePerCell;

    // 3) ê²€ì€ ì´ìˆ˜ ë³´ì •
    let k = Math.max(1, toInt(t.value, 1));
    let caps = calcCaps(cols, rows, maxBlackPerCell, k, maxWhitePerCell);
    if (k > caps.capBlackTotal) k = caps.capBlackTotal;
    t.value = k;

    // 4) í° ì´ìˆ˜ ë³´ì • (ê²€ì€ í™•ì •ì¹˜ ì‚¬ìš©)
    caps = calcCaps(cols, rows, maxBlackPerCell, k, maxWhitePerCell);
    let whiteTotal = Math.max(0, toInt(wt.value, 0));
    if (whiteTotal > caps.capWhiteTotal) whiteTotal = caps.capWhiteTotal;
    wt.value = whiteTotal;

    // 5) max íŒíŠ¸ ë™ê¸°í™”
    t.max  = String(caps.capBlackTotal);
    wt.max = String(caps.capWhiteTotal);
  }

    /* ---------- ì‹¤í–‰ í•¨ìˆ˜ (í°ìƒ‰ ì§€ë¢° ì§€ì›) ---------- */
    var execute = function(i, j, k, l = 1, whiteTotal = 0, whiteMax = 0) {
      // 1) ì…ë ¥ ì •ê·œí™”
      i = Math.max(3,toInt(i, 3)); j = toInt(j, 1); k = toInt(k, 1); l = clamp(toInt(l, 1), 1, 6);
      whiteTotal = Math.max(0, toInt(whiteTotal, 0));
      whiteMax   = clamp(toInt(whiteMax, 0), 0, 6);

      // 2) ìƒí•œ ë³´ì •(ëª¨ë“  ê²½ë¡œì—ì„œ ë™ì¼í•˜ê²Œ ê°•ì œ)
      //    2-1) ê²€ì€ì§€ë¢° ì´ìˆ˜ k ë³´ì •
      let caps = calcCaps(i, j, l, k,whiteMax);
      if (k > caps.capBlackTotal) k = caps.capBlackTotal;

      //    2-2) í°ì§€ë¢° ì´ìˆ˜ whiteTotal ë³´ì • (ê²€ì€ í™•ì •ì¹˜ ì‚¬ìš©)
      caps = calcCaps(i, j, l, k,whiteMax);
      if (whiteTotal > caps.capWhiteTotal) whiteTotal = caps.capWhiteTotal;

      // 3) í¼ ê°’ ë°˜ì˜ + í¼ max íŒíŠ¸ ë°˜ì˜
      x.value  = i; y.value  = j; m.value  = l; t.value  = k;
      wm.value = whiteMax; wt.value = whiteTotal;
      t.max  = String(caps.capBlackTotal);
      wt.max = String(caps.capWhiteTotal);

      /* ë©”ë‰´ í‘œì‹œ ë²”ìœ„ ì¡°ì ˆ */
      const toggleMenu = (sel, show) => show ? $(sel).removeAttr("style") : $(sel).css({"display":"none"});
      toggleMenu(".menu2",  i>=7);
      toggleMenu(".menu3",  i>=10);
      toggleMenu(".menu4",  i>=13);
      toggleMenu(".menu5",  i>=14);
      toggleMenu(".menu6",  i>=16);
      toggleMenu(".menu7",  i>=19);
      toggleMenu(".menu8",  i>=21);
      toggleMenu(".menu9",  i>=23);
      toggleMenu(".menu10", i>=26);
      toggleMenu(".menu11", i>=29);
      toggleMenu(".menu12", i>=32);
      toggleMenu(".menu13", i>=35);

      /* ë³´ë“œ ìƒì„± (mine.jsê°€ 6ì¸ì ì§€ì› ì‹œ ê·¸ëŒ€ë¡œ ì „ë‹¬) */
      if (typeof minefield.init_board === 'function' && minefield.init_board.length >= 6) {
        minefield.init_board(i, j, k, l, whiteTotal, whiteMax);
      } else {
        minefield.init_board(i, j, k, l);
        minefield.white_total = whiteTotal;
        minefield.white_max   = whiteMax;
        if (typeof minefield.set_white_config === 'function') minefield.set_white_config(whiteTotal, whiteMax);
      }

      /* ë ˆì´ì•„ì›ƒ: ì´ì¤‘ ì¹´ìš´í„°ë©´ í—¤ë” ë†’ì´/ì°½ ë†’ì´ë¥¼ í‚¤ì›€ */
      const hasWhite = whiteTotal > 0;
      const head = document.querySelector('.window-content .mine-head-area');
      if (head) head.style.height = hasWhite ? '58px' : '38px';

      const extraHead = hasWhite ? 20 : 0; // 58-38
      $(".mine-window").css({ "width": 22 + i*16, "height": (107 + extraHead) + j*16 });
      $(".window-content .mine-head-area ").css({ "width": 2 + i*16 });
      $(".window-content .mine-area").css({ "width": i*16, "height": j*16 });
      $(".inner").css({ "width": i*16, "height": j*16 });
      $(".window-content .mine-head-area .mine-reset-button").css({ "left": -8 + 8*i });
      $(".windows").css({ "height": (112 + extraHead) + j*16 });

      renderCounters(hasWhite);
      update_all_mine_counters();
      updateHScrollGuard();
    };
  </script>

  <div class="windows windows-98" style="height:365px;">
    <div class="window has-menu mine-window">
      <div class="title-bar">
        <div class="title-icon"></div>
        <div class="title">Minesweeper</div>
        <div class="title-button-group">
          <div class="title-button minimize"></div>
          <div class="title-button maximize disabled"></div>
          <div class="title-button close"></div>
        </div>
      </div>

      <ul class="menu-bar">
        <li class="menu1"  onclick="execute(9, 9, 10, 1, 0, 0)">ì´ˆê¸‰</li>
        <li class="menu2"  onclick="execute(16, 16, 40, 1, 0, 0)">ì¤‘ê¸‰</li>
        <li class="menu3"  onclick="execute(30, 16, 99, 1, 0, 0)">ê³ ê¸‰</li>
        <li class="menu4"  onclick="execute(30, 16, 120, 2, 0, 0)">ì´ˆê³ ê¸‰</li>
        <li class="menu5"  onclick="execute(30, 16, 160, 3, 0, 0)">ğŸ˜±</li>
        <li class="menu6"  onclick="execute(30, 16, 220, 4, 0, 0)">ğŸ’€</li>
        <li class="menu7"  onclick="execute(30, 16, 420, 4, 0, 0)">â˜ ï¸</li>
        <li class="menu8"  onclick="execute(30, 16, 530, 5, 0, 0)">â˜ ï¸â˜ ï¸</li>
        <li class="menu9"  onclick="execute(30, 16, 680, 6, 0, 0)">3â˜ ï¸</li>
        <li class="menu10" onclick="execute(30, 16, 70, 1, 30, 1)">ìŒìˆ˜ì§€ë¢°</li>
        <li class="menu11" onclick="execute(118, 58, 1412, 1, 0, 0)">ëŒ€í˜•</li>
        <li class="menu12" onclick="execute(640, 480, 63300, 1, 0, 0)" style="display:none">ì´ˆëŒ€í˜•</li>
        <li class="menu13" onclick="execute(1280, 720, 192000, 1, 0, 0)" style="display:none">íŠ¹ëŒ€í˜•</li>
      </ul>

      <div class="window-content">
        <div class="mine-head-area" style="height:38px;">
          <!-- ë‹¨ì¼ ì¹´ìš´í„°(ê¸°ë³¸) : ì ˆëŒ€ë°°ì¹˜ ê·¸ëŒ€ë¡œ ì‚¬ìš© -->
          <div id="counters-single" class="counters-single" style="">
            <div class="mine-counter" id="mine-counter-single">
              <div class="digit digit-0"></div>
              <div class="digit digit-0"></div>
              <div class="digit digit-0"></div>
            </div>
          </div>

          <!-- ì´ì¤‘ ì¹´ìš´í„°: ì»¨í…Œì´ë„ˆë§Œ ì ˆëŒ€ë°°ì¹˜, ë‚´ë¶€ ì¹´ìš´í„°ëŠ” flexë¡œ í­ ìë™ -->
          <div id="counters-dual" class="mine-counters-dual"
               style="display:none; position:absolute; top:4px; left:6px;">
            <div id="counter-row-black" class="counter-row" style="min-height:23px;">
              <div class="counter-icon icon-flag-black" title="ê²€ì€ ì§€ë¢°"></div>
              <div class="mine-counter" id="mine-counter-black"
                   style="position:static; width:auto; height:23px; display:flex;">
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
              </div>
            </div>
            <div id="counter-row-white" class="counter-row" style="min-height:23px;">
              <div class="counter-icon icon-flag-white" title="í•˜ì–€(ìŒìˆ˜) ì§€ë¢°"></div>
              <div class="mine-counter" id="mine-counter-white"
                   style="position:static; width:auto; height:23px; display:flex;">
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
                <div class="digit digit-0"></div>
              </div>
            </div>
          </div>

          <div class="mine-reset-button" onclick="minefield.reset_board()">
            <div class="mine-reset-button-inner"></div>
          </div>

          <div class="mine-timer">
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
            <div class="digit digit-0"></div>
          </div>
        </div>

        <div id="mine-area" class="mine-area"></div>
      </div>
    </div>
  </div>

  <div id="userctrl" class="userctrl" style="margin:0">
    <form oninput="applyFormCaps()">
      ì£¼ë¬¸ì œì‘:ê°€ë¡œ
      <input type="number" id="x"  min="3" max="9999" step="1" style="width:60px;" value="30">
      ì„¸ë¡œ
      <input type="number" id="y"  min="1" max="9999" step="1" style="width:60px;" value="16">
      1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜
      <input type="number" id="m"  min="1" max="6"    step="1" style="width:60px;" value="1">
      ì „ì²´ ì§€ë¢° ìˆ˜
      <input type="number" id="t"  min="1" step="1"   style="width:80px;" value="99">

      <!-- â–¼ ì¶”ê°€: í•˜ì–€ ì§€ë¢° ì…ë ¥(0 í—ˆìš©) -->
      1ì¹¸ë‹¹ ìµœëŒ€ ìŒìˆ˜ì§€ë¢° ìˆ˜
      <input type="number" id="wm" min="0" max="6" step="1" style="width:60px;" value="0">
      ì „ì²´ ìŒìˆ˜ì§€ë¢° ìˆ˜
      <input type="number" id="wt" min="0" step="1" style="width:80px;" value="0">

      <input type="button"
        onclick="execute(
          document.getElementById('x').value,
          document.getElementById('y').value,
          document.getElementById('t').value,
          document.getElementById('m').value,
          document.getElementById('wt').value,
          document.getElementById('wm').value
        )"
        value="ìƒì„±">
      <input type="button" onclick="hideViaURL()" value="ë¬¸êµ¬ ìˆ¨ê¸°ê¸°">
    </form>
  </div>
  <div id="heavy-notice">ì§€ë¢° ìˆ˜ê°€ ë§ìœ¼ë©´ ì²« ë²„íŠ¼ ëˆ„ë¥¸ ë’¤ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ë‹ˆ ê¸°ë‹¤ë¦¬ê¸° ë°”ëë‹ˆë‹¤</div>

  <script src="vendor/jquery.min.js"></script>
  <script src="vendor/jquery-ui.min.js"></script>
  <script src="jquery.mswin.js"></script>
  <script src="jquery.mswin.listview.js"></script>
  <script src="jquery.mswin.menu.js"></script>
  <script src="mine.js"></script>

  <script>
    /* GET íŒŒì„œ */
    function getQueryParams() {
      const p = new URLSearchParams(window.location.search);
      return {
        rows: p.get('rows'),
        cols: p.get('cols'),
        minespercell: p.get('minespercell'),
        mines: p.get('mines'),
        whiteminespercell: p.get('whiteminespercell'),
        whitemines: p.get('whitemines'),
      };
    }
    function hasCoreParams(q) {
      return q.rows !== null && q.cols !== null && q.minespercell !== null && q.mines !== null;
    }
    function getQueryDefault0(v){ const n = parseInt(v); return isNaN(n)?0:n; }

    /* í•˜ë‹¨ ì…ë ¥ ìˆ¨ê¸°ê¸° */
    function hideUserInputs() {
      const u = document.getElementById('userctrl');
      if (u) u.style.display = 'none';
      const n = document.getElementById('heavy-notice');
      if (n) n.style.display = 'none';
    }

    /* GET ë¦¬ë‹¤ì´ë ‰íŠ¸(ë³´ë‚´ê¸° ì „ì— ìƒí•œ ë³´ì •) */
    function hideViaURL() {
      let cols = clamp(toInt(x.value,3), 3, 999999);
      let rows = clamp(toInt(y.value,1), 1, 999999);
      let mpc  = clamp(toInt(m.value,1), 1, 6);
      let mines= Math.max(1, toInt(t.value,1));
      let wmpc = clamp(toInt(wm.value,0), 0, 6);
      let wmines = Math.max(0, toInt(wt.value,0));

      // ë³´ì • 1: ê²€ì€ ì´ìˆ˜
      let caps = calcCaps(cols, rows, mpc, mines,wmpc);
      if (mines > caps.capBlackTotal) mines = caps.capBlackTotal;

      // ë³´ì • 2: í° ì´ìˆ˜(ê²€ì€ í™•ì •ì¹˜ ë°˜ì˜)
      caps = calcCaps(cols, rows, mpc, mines,wmpc);
      if (wmines > caps.capWhiteTotal) wmines = caps.capWhiteTotal;

      // í¼ì—ë„ ë°˜ì˜(ì‹œê°ì  í”¼ë“œë°±)
      x.value=cols; y.value=rows; m.value=mpc; t.value=mines;
      wm.value=wmpc; wt.value=wmines;
      t.max  = String(caps.capBlackTotal);
      wt.max = String(caps.capWhiteTotal);

      const u = new URL(window.location.href);
      u.searchParams.set('cols', cols);
      u.searchParams.set('rows', rows);
      u.searchParams.set('minespercell', mpc);
      u.searchParams.set('mines', mines);
      u.searchParams.set('whiteminespercell', wmpc);
      u.searchParams.set('whitemines', wmines);
      window.location.href = u.pathname + '?' + u.searchParams.toString();
    }

    /* ìœ í‹¸: digit DOM ìˆ˜ ë§ì¶”ê¸° */
    function ensure_digits(counter, count) {
      const cur = counter.children().length;
      if (cur < count) {
        for (let i = 0; i < count - cur; i++) counter.append('<div class="digit digit-0"></div>');
      } else if (cur > count) {
        for (let i = 0; i < cur - count; i++) $(counter.children()[0]).remove();
      }
    }
    /* íƒ€ì´ë¨¸(3ìë¦¬ ê³ ì •) */
    function update_counter_timer(val, counter) {
      if (val > 999) val = 999; if (val < 0) val = 0;
      ensure_digits(counter, 3);
      const digits = [ Math.floor(val/100), Math.floor(val/10)%10, val%10 ];
      for (let i=0;i<3;i++){
        const d = digits[i];
        const child = $(counter.children()[i]);
        child.removeClass(); child.addClass("digit digit-" + d);
      }
    }
    /* ìˆ«ì ì¹´ìš´í„°(ìë¦¿ìˆ˜ ê³ ì • ì§€ì›) */
    function update_counter_generic(val, counter, totalForWidth, fixedDigits) {
      let N = fixedDigits || Math.max(3, String(Math.abs(totalForWidth || val || 0)).length);
      ensure_digits(counter, N);
      const isNeg = val < 0;
      if (isNeg) {
        const slots = N - 1;
        const maxAbs = Math.pow(10, slots) - 1;
        let absVal = Math.abs(val);
        if (absVal > maxAbs) absVal = maxAbs;
        let child = $(counter.children()[0]);
        child.removeClass().addClass("digit digit-10");
        const padded = String(absVal).padStart(slots, "0");
        for (let i = 0; i < slots; i++) {
          const d = padded.charCodeAt(i) - 48;
          child = $(counter.children()[i + 1]);
          child.removeClass().addClass("digit digit-" + d);
        }
      } else {
        const padded = String(val).padStart(N, "0");
        for (let i = 0; i < N; i++) {
          const d = padded.charCodeAt(i) - 48;
          const child = $(counter.children()[i]);
          child.removeClass().addClass("digit digit-" + d);
        }
      }
      counter.css({ width: (N * 13) + "px", display: "flex", whiteSpace: "nowrap", height: "23px" });
    }

    /* ëª¨ë“ˆ ì „í™˜ */
    function renderCounters(hasWhite) {
      const single = document.getElementById('counters-single');
      const dual   = document.getElementById('counters-dual');
      if (!single || !dual) return;
      if (hasWhite) { single.style.display = 'none'; dual.style.display = ''; }
      else          { single.style.display = '';    dual.style.display   = 'none'; }
    }

    /* ëª¨ë“  ì¹´ìš´í„° ê°±ì‹  */
    function update_all_mine_counters() {
      const hasWhite = (minefield.white_total || minefield.num_mines_white || 0) > 0;
      if (hasWhite) {
        const bTotal = (minefield.num_mines || 0);
        const wTotal = (minefield.white_total || minefield.num_mines_white || 0);
        const maxTotalAbs = Math.max(Math.abs(bTotal), Math.abs(wTotal));
        const N = Math.max(3, String(maxTotalAbs).length);
        const blackRemain = bTotal - (minefield.num_flags || 0);
        const whiteRemain = wTotal - (minefield.num_flags_white || 0);
        update_counter_generic(blackRemain, $("#mine-counter-black"), bTotal, N);
        update_counter_generic(whiteRemain, $("#mine-counter-white"), wTotal, N);
      } else {
        const remain = (minefield.num_mines || 0) - (minefield.num_flags || 0);
        update_counter_generic(remain, $("#mine-counter-single"), minefield.num_mines || 0);
      }
    }

    /* ìœˆë„ìš°/ë©”ë‰´ ì´ˆê¸°í™” â€” ìš”ì†Œê°€ ìˆì„ ë•Œë§Œ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ */
    if ($('.window').length) $('.window').window();
    if ($('.listview').length) $('.listview').listview();
    if ($('.desktop-listview').length) $('.desktop-listview').listview();
    if ($('.menu-bar').length) $('.menu-bar').menubar();
    if ($('.taskbar ul.start').length) {
      $('.taskbar ul.start').menubar({ position_toplevel: { my: "left bottom", at: "left top" } });
    }

    /* íƒ€ì´ë¨¸ */
    var timer_val = 0, timer_id = null;
    var update_timer = function(){ timer_val += 1; update_counter_timer(timer_val, $(".mine-timer")); };

    /* Minefield ì¸ìŠ¤í„´ìŠ¤ */
    var mine_area = document.getElementById("mine-area");
    var minefield = new window.Minefield(
      mine_area,
      function(status) {
        var smile = $(".mine-reset-button .mine-reset-button-inner");
        var bg = "0 0"; if (status === -1) bg = "-17px 0"; if (status === -2) bg = "-51px 0"; if (status === 2) bg = "-34px 0";
        smile.css({"background-position": bg});

        if (status === 0) timer_id = window.setInterval(update_timer, 1000);
        if (status < 0 || status === 1) {
          window.clearInterval(timer_id);
          if (status === 1) {
            const hasWhite = (minefield.white_total || minefield.num_mines_white || 0) > 0;
            renderCounters(hasWhite);
            const head = document.querySelector('.window-content .mine-head-area');
            if (head) head.style.height = hasWhite ? '58px' : '38px';
            update_all_mine_counters();
            timer_val = 0; timer_id = null; update_counter_timer(0, $(".mine-timer"));
          }
          if (status === -2) update_all_mine_counters();
        }
      },
      function(status) {
  // â˜… ê²Œì„ì´ ëë‚œ ìƒíƒœ(-1: íŒ¨ë°°, -2: í´ë¦¬ì–´)ì—ì„œëŠ” ë®ì–´ì“°ì§€ ì•ŠìŒ
  if (minefield.game_status < 0) return;

  var smile = $(".mine-reset-button .mine-reset-button-inner");

        smile.css({"background-position": (status === 1) ? "-34px 0" : "0 0"});
      }
    );

    /* ê¹ƒë°œ ìš°í´ë¦­ ì‹œ ì¹´ìš´í„° ê°±ì‹  */
    minefield.on_rclick_func = function(){ update_all_mine_counters(); };

    /* ì´ˆê¸° ì‹œì‘: ê¸°ë³¸(í° ì§€ë¢° ì—†ìŒ) + í¼ ìƒí•œ ì´ˆê¸°í™” */
    minefield.init_board(30, 16, 99, 1);
    renderCounters(false);
    applyFormCaps();
    updateHScrollGuard();
    update_all_mine_counters();

    /* GET ì¸ì ìë™ ì ìš© (ë¡œë“œ ì‹œì—ë„ ìƒí•œ ë³´ì • ê°•ì œ) */
    document.addEventListener('DOMContentLoaded', function() {
      const q = getQueryParams();
      if (hasCoreParams(q)) {
        let cols = Math.max(3, toInt(q.cols, 30));
        let rows = toInt(q.rows, 16);
        let mpc  = clamp(toInt(q.minespercell, 1), 1, 6);
        let mines= Math.max(1, toInt(q.mines, 99));
        let wmpc = clamp(getQueryDefault0(q.whiteminespercell), 0, 6);
        let wmines = Math.max(0, getQueryDefault0(q.whitemines));

        // ë³´ì • 1: ê²€ì€ ì´ìˆ˜
        let caps = calcCaps(cols, rows, mpc, mines,wmpc);
        if (mines > caps.capBlackTotal) mines = caps.capBlackTotal;

        // ë³´ì • 2: í° ì´ìˆ˜
        caps = calcCaps(cols, rows, mpc, mines,wmpc);
        if (wmines > caps.capWhiteTotal) wmines = caps.capWhiteTotal;

        execute(cols, rows, mines, mpc, wmines, wmpc);

        // í¼ê³¼ max íŒíŠ¸ë„ ë™ê¸°í™”
        x.value=cols; y.value=rows; m.value=mpc; t.value=mines;
        wm.value=wmpc; wt.value=wmines;
        t.max  = String(caps.capBlackTotal);
        wt.max = String(caps.capWhiteTotal);

        hideUserInputs();
      }
    });

/* ===== Runtime i18n: if not Korean, switch UI texts to English ===== */
(function () {
  function isKorean() {
    var lang = (navigator.language || navigator.userLanguage || "").toLowerCase();
    return lang.startsWith("ko");
  }

  function localizeToEnglish() {
    // Document language
    document.documentElement.setAttribute("lang", "en");

    // 1) Menu labels
    var menuText = {
      ".menu1":  "Beginner",
      ".menu2":  "Intermediate",
      ".menu3":  "Expert",
      ".menu4":  "Ultra",
      ".menu5":  "ğŸ˜±",
      ".menu6":  "ğŸ’€",
      ".menu7":  "â˜ ï¸",
      ".menu8":  "â˜ ï¸â˜ ï¸",
      ".menu9":  "3â˜ ï¸",
      ".menu10": "AntiMine",
      ".menu11": "Large",
      ".menu12": "XLarge",
      ".menu13": "XXLarge"
    };
    Object.keys(menuText).forEach(function (sel) {
      var el = document.querySelector(sel);
      if (el) el.textContent = menuText[sel];
    });

    // 2) Counter icon tooltips
    var blackIcon = document.querySelector(".icon-flag-black");
    if (blackIcon) blackIcon.setAttribute("title", "Black mine");
    var whiteIcon = document.querySelector(".icon-flag-white");
    if (whiteIcon) whiteIcon.setAttribute("title", "Anti-mine");

    // 3) Form labels / buttons (safe innerHTML replacements on static markup)
    var form = document.querySelector("#userctrl form");
    if (form) {
      var html = form.innerHTML;
      html = html.replace("ì£¼ë¬¸ì œì‘:ê°€ë¡œ", "Custom: cols")
                 .replace("ì„¸ë¡œ", "rows")
                 .replace("1ì¹¸ë‹¹ ìµœëŒ€ ì§€ë¢° ìˆ˜", "Max mines / cell")
                 .replace("ì „ì²´ ì§€ë¢° ìˆ˜", "Total mines")
                 .replace("1ì¹¸ë‹¹ ìµœëŒ€ ìŒìˆ˜ì§€ë¢° ìˆ˜", "Max anti-mines / cell")
                 .replace("ì „ì²´ ìŒìˆ˜ì§€ë¢° ìˆ˜", "Total anti-mines")
                 .replace("ìƒì„±", "Create")
                 .replace("ë¬¸êµ¬ ìˆ¨ê¸°ê¸°", "Hide controls");
      form.innerHTML = html;
    }

    // 4) Heavy notice
    var notice = document.getElementById("heavy-notice");
    if (notice) {
      notice.textContent =
        "If there are many mines, the first click can take a while. Please wait.";
    }

    // 5) Window title bar (already 'Minesweeper', but keep consistent if needed)
    // const titleEl = document.querySelector(".title-bar .title");
    // if (titleEl) titleEl.textContent = "Minesweeper";
  }

  // Run after DOM is ready
  if (!isKorean()) {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", localizeToEnglish);
    } else {
      localizeToEnglish();
    }
  }
})();
</script>

</body>
</html>
